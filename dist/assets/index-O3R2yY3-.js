const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor-_JZ7sh_e.js","assets/vendor-h0EPuWW_.css"])))=>i.map(i=>d[i]);
import{j as e,L as G,F as ea,a as ms,b as xs,c as ta,d as sa,r as x,M as Bt,S as Dt,e as he,f as pe,u as Ft,g as dt,h as W,i as hs,H as st,I as jt,C as at,P as Nt,U as Wt,k as Jt,l as ps,m as aa,n as ot,o as Rt,p as oe,q as ge,s as gs,B as na,t as fs,v as bs,T as ys,w as ct,x as vs,y as ke,$ as ra,z as Zt,A as es,V as xe,D as ts,E as ia,G as la,J as Ut,K as js,N as Ns,O as ws,Q as Ie,R as oa,W as ca,X as ks,Y as da,Z as Ts,_ as Ss,a0 as ua,a1 as Es,a2 as Lt,a3 as ma,a4 as xa,a5 as ha,a6 as pa,a7 as ga,a8 as Cs,a9 as _,aa as Mt,ab as fa,ac as ss,ad as wt,ae as Fe,af as Is,ag as As,ah as It,ai as $e,aj as nt,ak as Ze,al as Ye,am as He,an as rt,ao as ba,ap as ya,aq as ut,ar as mt,as as xt,at as le,au as qt,av as $t,aw as va,ax as Ps,ay as ja,az as Na,aA as wa,aB as ka,aC as _t,aD as Bs,aE as At,aF as Ta,aG as Ne,aH as Sa,aI as Ea,aJ as Ca,aK as Ia,aL as Aa,aM as Pa,aN as as,aO as Ba,aP as Da,aQ as Fa,aR as Ra,aS as Ua,aT as kt,aU as La,aV as Ma,aW as qa,aX as $a,aY as K,aZ as Ee,a_ as _a,a$ as za,b0 as Oa,b1 as Ga,b2 as Va,b3 as Qa,b4 as Ya,b5 as Ha,b6 as Xa,b7 as Ka,b8 as Wa,b9 as Ja,ba as Za,bb as en}from"./vendor-_JZ7sh_e.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))l(h);new MutationObserver(h=>{for(const d of h)if(d.type==="childList")for(const T of d.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&l(T)}).observe(document,{childList:!0,subtree:!0});function r(h){const d={};return h.integrity&&(d.integrity=h.integrity),h.referrerPolicy&&(d.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?d.credentials="include":h.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function l(h){if(h.ep)return;h.ep=!0;const d=r(h);fetch(h.href,d)}})();const Ke=()=>e.jsxs("footer",{className:"bg-base-200 text-base-content py-12 px-6 border-t border-base-300 transition-colors duration-300",children:[e.jsxs("div",{className:"max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-4 gap-10",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-primary mb-3",children:"TicketStream"}),e.jsx("p",{className:"text-sm text-base-content/70",children:"Discover top venues, host unforgettable events, and experience Kenyaâ€™s vibrant culture through spaces that inspire."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Quick Links"}),e.jsxs("ul",{className:"space-y-2 text-sm",children:[e.jsx("li",{children:e.jsx(G,{to:"/",className:"link-hover link text-base-content/80",children:"Home"})}),e.jsx("li",{children:e.jsx(G,{to:"/venues",className:"link-hover link text-base-content/80",children:"Venues"})}),e.jsx("li",{children:e.jsx(G,{to:"/events",className:"link-hover link text-base-content/80",children:"Events"})}),e.jsx("li",{children:e.jsx(G,{to:"/about",className:"link-hover link text-base-content/80",children:"About Us"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Contact Us"}),e.jsxs("ul",{className:"text-sm space-y-2 text-base-content/70",children:[e.jsxs("li",{children:["Email: ",e.jsx("a",{href:"mailto:ticketeStream@gmail.com",className:"link link-hover",children:"ticketeStream@gmail.com"})]}),e.jsx("li",{children:"Phone: +254 712 345 678"}),e.jsx("li",{children:"Location: Nairobi, Kenya"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-3",children:"Follow Us"}),e.jsxs("div",{className:"flex gap-4 text-lg text-base-content/80",children:[e.jsx("a",{href:"#",className:"hover:text-primary transition",children:e.jsx(ea,{})}),e.jsx("a",{href:"#",className:"hover:text-primary transition",children:e.jsx(ms,{})}),e.jsx("a",{href:"#",className:"hover:text-primary transition",children:e.jsx(xs,{})}),e.jsx("a",{href:"#",className:"hover:text-primary transition",children:e.jsx(ta,{})})]})]})]}),e.jsxs("div",{className:"mt-10 pt-6 border-t border-base-300 text-center text-xs text-base-content/60",children:["Â© ",new Date().getFullYear()," TicketStream. All rights reserved."]})]}),tn={user:null,token:null,isAuthenticated:!1,role:null},Ds=sa({name:"auth",initialState:tn,reducers:{setCredentials:(t,s)=>{t.user=s.payload,t.token=s.payload.token,t.role=s.payload.role,t.isAuthenticated=!0},clearCredentials:t=>{t.user=null,t.token=null,t.role=null,t.isAuthenticated=!1},updateUserData:(t,s)=>{t.user={...t.user,...s.payload}}}}),{setCredentials:sn,clearCredentials:zt,updateUserData:Vr}=Ds.actions,an=Ds.reducer,ns=()=>{const[t,s]=x.useState(()=>localStorage.getItem("theme")||"light");x.useEffect(()=>{document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t)},[t]);const r=()=>s(t==="light"?"dark":"light");return e.jsx("button",{onClick:r,className:"btn btn-circle btn-ghost text-xl","aria-label":"Toggle Theme",children:t==="light"?e.jsx(Bt,{className:"h-5 w-5"}):e.jsx(Dt,{className:"h-5 w-5"})})},me=he({reducerPath:"userApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/"}),tagTypes:["users","user"],endpoints:t=>({loginUser:t.mutation({query:s=>({url:"auth/login",method:"POST",body:s})}),registerUser:t.mutation({query:s=>({url:"auth/register",method:"POST",body:s})}),requestPasswordReset:t.mutation({query:s=>({url:"auth/password-reset",method:"POST",body:s})}),resetPassword:t.mutation({query:({token:s,newPasswordPayload:r})=>({url:`auth/reset/${s}`,method:"PUT",body:r})}),verifyEmail:t.mutation({query:s=>({url:"auth/verify-email",method:"PUT",body:s})}),getAllUsersProfiles:t.query({query:()=>"users",providesTags:["users"]}),getUserByNationalId:t.query({query:s=>`users/${s}`,providesTags:["user"]}),getUserDetails:t.query({query:s=>`users/${s}/details`,providesTags:["user"]}),updateUser:t.mutation({query:({nationalId:s,...r})=>({url:`users/${s}`,method:"PUT",body:r}),invalidatesTags:["user","users"]}),updateAdminUser:t.mutation({query:({nationalId:s,...r})=>({url:`admin/users/${s}`,method:"PUT",body:r}),invalidatesTags:["user","users"]}),updateUserProfileImage:t.mutation({query:({nationalId:s,profile_picture:r})=>({url:`users/${s}`,method:"PUT",body:{profile_picture:r}}),invalidatesTags:["user","users"]}),deleteUser:t.mutation({query:s=>({url:`users/${s}`,method:"DELETE"}),invalidatesTags:["user","users"]}),searchUsersByLastName:t.query({query:s=>`users-search?lastName=${s}`}),searchUsersWithDetails:t.query({query:s=>`details/users-search?lastName=${s}`})})}),{useLoginUserMutation:Qr,useRegisterUserMutation:nn,useRequestPasswordResetMutation:Yr,useResetPasswordMutation:Hr,useVerifyEmailMutation:Xr,useGetAllUsersProfilesQuery:rn,useGetUserByNationalIdQuery:Ot,useGetUserDetailsQuery:Kr,useUpdateUserMutation:Fs,useUpdateAdminUserMutation:ln,useUpdateUserProfileImageMutation:Wr,useDeleteUserMutation:on,useSearchUsersByLastNameQuery:Jr,useSearchUsersWithDetailsQuery:Zr}=me,fe=()=>{const t=Ft(),[s,r]=x.useState(!1),[l,h]=x.useState(!1),d=x.useRef(null),T=dt(),N=W(c=>c.auth.isAuthenticated),b=W(c=>c.auth.user?.firstName),k=W(c=>c.auth.user?.nationalId),C=W(c=>c.auth.role),{data:E}=Ot(k,{skip:!k}),P=E?.profileImageUrl,v=c=>t.pathname===c?"text-primary font-bold":"";x.useEffect(()=>{const c=()=>h(window.scrollY>20);return window.addEventListener("scroll",c),()=>window.removeEventListener("scroll",c)},[]),x.useEffect(()=>(document.body.style.overflow=s?"hidden":"auto",()=>{document.body.style.overflow="auto"}),[s]),x.useEffect(()=>{const c=new hs(d.current,{strings:["TicketStream ","Book. Enjoy.  ","Repeat."],typeSpeed:100,backSpeed:30,showCursor:!0,cursorChar:"ðŸŽ¤",loop:!0});return()=>{c.destroy()}},[]);const I=()=>{T(zt()),r(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`fixed top-0 left-0 w-full z-50 transition-all duration-300 border-b border-base-300 ${l?"backdrop-blur bg-base-100/70 shadow-md":"bg-base-100"}`,children:e.jsxs("div",{className:"navbar",children:[e.jsxs("div",{className:"navbar-start",children:[e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"btn btn-ghost lg:hidden",onClick:()=>r(!s),"aria-label":"Toggle menu",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h8m-8 6h16"})})}),e.jsxs("ul",{className:"menu menu-sm dropdown-content bg-base-100 rounded-box z-10 mt-3 w-52 p-2 shadow font-chewy text-lg",children:[e.jsx("li",{children:e.jsxs(G,{className:v("/"),to:"/",onClick:()=>r(!1),children:[e.jsx(st,{className:"inline mr-2 h-4 w-4"})," Home"]})}),e.jsx("li",{children:e.jsxs(G,{className:v("/about"),to:"/about",onClick:()=>r(!1),children:[e.jsx(jt,{className:"inline mr-2 h-4 w-4"})," About"]})}),e.jsx("li",{children:e.jsxs(G,{className:v("/events"),to:"/events",onClick:()=>r(!1),children:[e.jsx(at,{className:"inline mr-2 h-4 w-4"})," Events"]})}),e.jsx("li",{children:e.jsxs(G,{className:v("/contact"),to:"/contact",onClick:()=>r(!1),children:[e.jsx(Nt,{className:"inline mr-2 h-4 w-4"})," Contact"]})}),e.jsx("li",{children:e.jsx(ns,{})}),!N&&e.jsxs(e.Fragment,{children:[e.jsx("li",{children:e.jsxs(G,{className:v("/register"),to:"/register",onClick:()=>r(!1),children:[e.jsx(Wt,{className:"inline mr-2 h-4 w-4"})," Register"]})}),e.jsx("li",{children:e.jsxs(G,{className:v("/login"),to:"/login",onClick:()=>r(!1),children:[e.jsx(Jt,{className:"inline mr-2 h-4 w-4"})," Login"]})})]})]})]}),e.jsx(G,{to:"/",className:"btn btn-ghost text-xl font-bold flex items-center gap-1",children:e.jsx("span",{ref:d,className:"tracking-wide text-primary font-updock text-3xl"})})]}),e.jsx("div",{className:"navbar-center hidden lg:flex",children:e.jsxs("ul",{className:"menu menu-horizontal px-1 font-chewy text-lg",children:[e.jsx("li",{children:e.jsxs(G,{className:v("/"),to:"/",children:[e.jsx(st,{className:"inline mr-2 h-4 w-4"})," Home"]})}),e.jsx("li",{children:e.jsxs(G,{className:v("/about"),to:"/about",children:[e.jsx(jt,{className:"inline mr-2 h-4 w-4"})," About"]})}),e.jsx("li",{children:e.jsxs(G,{className:v("/events"),to:"/events",children:[e.jsx(at,{className:"inline mr-2 h-4 w-4"})," Events"]})}),e.jsx("li",{children:e.jsxs(G,{className:v("/contact"),to:"/contact",children:[e.jsx(Nt,{className:"inline mr-2 h-4 w-4"})," Contact"]})})]})}),e.jsxs("div",{className:"navbar-end flex gap-2 items-center",children:[e.jsx(ns,{}),N?e.jsxs("div",{className:"dropdown dropdown-end group",children:[e.jsx("label",{tabIndex:0,className:"flex items-center cursor-pointer",children:e.jsxs("div",{className:"btn btn-outline btn-primary capitalize flex items-center gap-2",children:[e.jsx("img",{src:P||"/default-avatar.png",alt:"Profile",className:"w-6 h-6 rounded-full object-cover border"}),"Hey ",b,e.jsx(ps,{className:"h-4 w-4 transition-transform duration-200 group-hover:rotate-180"})]})}),e.jsxs("ul",{tabIndex:0,className:"menu dropdown-content bg-base-100 shadow rounded-box w-52 mt-2 z-20",children:[e.jsx("li",{children:C==="admin"?e.jsxs(G,{to:"/AdminDashBoard/analytics",className:"font-bold flex items-center gap-2",children:[e.jsx(aa,{className:"h-5 w-5"})," Admin Dashboard"]}):e.jsxs(G,{to:"/dashboard",className:"font-bold flex items-center gap-2",children:[e.jsx(ot,{className:"h-5 w-5"})," User Dashboard"]})}),e.jsx("li",{children:e.jsxs("button",{onClick:I,className:"flex items-center gap-2",children:[e.jsx(Rt,{className:"h-5 w-5"})," Logout"]})})]})]}):e.jsxs("div",{className:"hidden lg:flex gap-2 font-chewy text-lg",children:[e.jsxs(G,{to:"/register",className:`btn btn-ghost ${v("/register")}`,children:[e.jsx(Wt,{className:"inline mr-2 h-4 w-4"})," Register"]}),e.jsxs(G,{to:"/login",className:`btn ${v("/login")}`,children:[e.jsx(Jt,{className:"inline mr-2 h-4 w-4"})," Login"]})]})]})]})}),e.jsx("div",{className:"lg:hidden fixed bottom-0 left-0 w-full z-50 backdrop-blur bg-base-100/40 shadow-md border-t animate-glow",children:e.jsxs("ul",{className:"flex justify-around items-center py-2 font-chewy text-base",children:[e.jsx("li",{children:e.jsxs(G,{to:"/",className:`flex flex-col items-center ${v("/")}`,children:[e.jsx(st,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Home"})]})}),e.jsx("li",{children:e.jsxs(G,{to:"/about",className:`flex flex-col items-center ${v("/about")}`,children:[e.jsx(jt,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"About"})]})}),e.jsx("li",{children:e.jsxs(G,{to:"/events",className:`flex flex-col items-center ${v("/events")}`,children:[e.jsx(at,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Events"})]})}),e.jsx("li",{children:e.jsxs(G,{to:"/contact",className:`flex flex-col items-center ${v("/contact")}`,children:[e.jsx(Nt,{className:"h-5 w-5"}),e.jsx("span",{className:"text-xs",children:"Contact"})]})})]})})]})},Z=he({reducerPath:"eventApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/",prepareHeaders:(t,{getState:s})=>{const r=s().auth.token;return r&&t.set("Authorization",`${r}`),t.set("Content-Type","application/json"),t}}),refetchOnReconnect:!0,refetchOnMountOrArgChange:!0,tagTypes:["events","event"],endpoints:t=>({createEvent:t.mutation({query:s=>({url:"events",method:"POST",body:s}),invalidatesTags:["events"]}),updateEvent:t.mutation({query:({eventId:s,...r})=>({url:`events/${s}`,method:"PUT",body:r}),invalidatesTags:["events"]}),getAllEvents:t.query({query:()=>"events",providesTags:["events"]}),getEventById:t.query({query:s=>`events/${s}`}),getEventsByTitle:t.query({query:s=>`events-search-title?title=${s}`,providesTags:["events"]}),getEventsByCategory:t.query({query:s=>`events-search-category?category=${s}`,providesTags:["events"]}),deleteEvent:t.mutation({query:s=>({url:`events/${s}`,method:"DELETE"}),invalidatesTags:["events"]})})}),Re=he({reducerPath:"mediaApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/",prepareHeaders:(t,{getState:s})=>{const r=s().auth.token;return r&&t.set("Authorization",`${r}`),t}}),tagTypes:["media","mediaByEvent","mediaByType"],endpoints:t=>({createMedia:t.mutation({query:s=>({url:"media",method:"POST",body:s}),invalidatesTags:["media"]}),updateMedia:t.mutation({query:({mediaId:s,...r})=>({url:`media/${s}`,method:"PUT",body:r}),invalidatesTags:["media"]}),getAllMedia:t.query({query:()=>"media",providesTags:["media"]}),getMediaByEventId:t.query({query:s=>`media/event/${s}`,providesTags:["mediaByEvent"]}),getMediaByType:t.query({query:s=>`media/type/${s}`,providesTags:["mediaByType"]}),deleteMedia:t.mutation({query:s=>({url:`media/${s}`,method:"DELETE"}),invalidatesTags:["media"]})})}),{useCreateMediaMutation:cn,useUpdateMediaMutation:ei,useGetAllMediaQuery:dn,useGetMediaByEventIdQuery:ti,useGetMediaByTypeQuery:si,useDeleteMediaMutation:un}=Re,Te=he({reducerPath:"ticketApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/",prepareHeaders:(t,{getState:s})=>{const r=s().auth.token;return r&&t.set("Authorization",`Bearer ${r}`),t.set("Content-Type","application/json"),t}}),refetchOnReconnect:!0,refetchOnMountOrArgChange:!0,tagTypes:["ticketTypes","ticketType"],endpoints:t=>({getAllTicketTypes:t.query({query:()=>"ticket-types",providesTags:["ticketTypes"]}),getTicketTypeById:t.query({query:s=>`ticket-types/${s}`}),getTicketTypesByEventId:t.query({query:s=>`ticket-types/event/${s}`,providesTags:["ticketTypes"]}),createTicketType:t.mutation({query:s=>({url:"ticket-types",method:"POST",body:s}),invalidatesTags:["ticketTypes"]}),updateTicketType:t.mutation({query:({id:s,...r})=>({url:`ticket-types/${s}`,method:"PUT",body:r}),invalidatesTags:["ticketTypes"]}),deleteTicketType:t.mutation({query:s=>({url:`ticket-types/${s}`,method:"DELETE"}),invalidatesTags:["ticketTypes"]})})}),{useGetAllTicketTypesQuery:mn,useGetTicketTypeByIdQuery:ai,useGetTicketTypesByEventIdQuery:xn,useCreateTicketTypeMutation:hn,useUpdateTicketTypeMutation:pn,useDeleteTicketTypeMutation:gn}=Te,fn=()=>{const t=oe(),{data:s=[],isLoading:r,error:l}=Z.useGetAllEventsQuery({pollingInterval:3e3}),h=s.slice(0,3);return e.jsx("section",{className:"min-h-screen py-16 px-6 bg-base-100 text-base-content",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h2",{className:"text-4xl font-extrabold text-center text-primary mb-6",children:"Upcoming Events"}),e.jsxs("p",{className:"text-lg text-base-content/70 max-w-3xl mx-auto text-center mb-10",children:["At ",e.jsx("span",{className:"text-primary font-semibold",children:"TicketStream"}),", we bring you the best live entertainment experiences."]}),l?e.jsx("div",{className:"text-error text-center",children:"Something went wrong."}):r?e.jsx("div",{className:"flex justify-center h-64 items-center",children:e.jsx(ge,{color:"#06b6d4"})}):h.length===0?e.jsx("div",{className:"text-center text-primary text-lg",children:"No events found."}):e.jsx("div",{className:"grid gap-10 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:h.map(d=>e.jsx(bn,{event:d,navigate:t},d.eventId))}),s.length>3&&e.jsx("div",{className:"mt-12 text-center",children:e.jsx("button",{onClick:()=>t("/events"),className:"btn btn-primary btn-wide",children:"See More Events"})})]})})},bn=({event:t,navigate:s})=>{const{data:r=[]}=Re.useGetMediaByEventIdQuery(t.eventId),{data:l=[]}=Te.useGetTicketTypesByEventIdQuery(t.eventId),h=Array.isArray(r)?r.find(k=>k.type==="image"):null,d=parseFloat(t.ticketPrice),T=Number(t.ticketsSold)||0,b=(Number(t.ticketsTotal)||0)-T;return e.jsxs("div",{className:"card bg-base-200 shadow-xl hover:shadow-2xl transition-all duration-300",children:[h?e.jsx("figure",{children:e.jsx("img",{src:h.url,alt:t.title,className:"w-full h-48 object-cover"})}):e.jsx("div",{className:"w-full h-48 flex items-center justify-center text-primary-content bg-primary/10",children:"No Image Available"}),e.jsxs("div",{className:"card-body",children:[e.jsx("h3",{className:"card-title text-primary",children:t.title}),e.jsxs("p",{className:"text-success font-bold text-lg",children:["Ksh",isNaN(d)?"0.00":d.toFixed(2)]}),e.jsx("p",{className:"text-base-content/70 line-clamp-3",children:t.description||"No description available."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-base-content/80 border border-base-300 rounded-lg p-4 mt-4 bg-base-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:t.date})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(gs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:t.time})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(na,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:t.venue?.name||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:t.venue?.address||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(bs,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:t.venue?.capacity??"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ys,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:t.category||"Uncategorized"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{children:["Sold: ",T]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{children:["Available: ",b]})]})]}),l.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-base font-semibold mb-2 text-primary",children:"Ticket Types"}),e.jsx("ul",{className:"space-y-1 text-sm",children:l.map(k=>{const C=Number(k.sold)||0,E=Number(k.quantity)-C;return e.jsxs("li",{className:"flex justify-between",children:[e.jsx("span",{children:k.name}),e.jsxs("span",{children:["Sold: ",C]}),e.jsxs("span",{children:["Available: ",E]})]},k.ticketTypeId)})})]}),e.jsx("div",{className:"card-actions mt-4",children:e.jsxs("button",{onClick:()=>s(`/events/${t.eventId}`),className:"btn btn-primary w-full",disabled:b<=0,children:[e.jsx(vs,{className:"w-5 h-5"}),b<=0?"Sold Out":"Book Now"]})})]})]})},yn=({sentence:t="True Focus",manualMode:s=!1,blurAmount:r=5,borderColor:l="green",glowColor:h="rgba(0, 255, 0, 0.6)",animationDuration:d=.5,pauseBetweenAnimations:T=1})=>{const N=t.split(" "),[b,k]=x.useState(0),[C,E]=x.useState(null),P=x.useRef(null),v=x.useRef([]),[I,c]=x.useState({x:0,y:0,width:0,height:0});x.useEffect(()=>{if(!s){const a=setInterval(()=>{k(y=>(y+1)%N.length)},(d+T)*1e3);return()=>clearInterval(a)}},[s,d,T,N.length]),x.useEffect(()=>{if(b===null||b===-1||!v.current[b]||!P.current)return;const a=P.current.getBoundingClientRect(),y=v.current[b].getBoundingClientRect();c({x:y.left-a.left,y:y.top-a.top,width:y.width,height:y.height})},[b,N.length]);const w=a=>{s&&(E(a),k(a))},o=()=>{s&&k(C??0)};return e.jsxs("div",{className:"focus-container",ref:P,children:[N.map((a,y)=>{const R=y===b;return e.jsx("span",{ref:U=>{U&&(v.current[y]=U)},className:`focus-word ${s?"manual":""} ${R&&!s?"active":""}`,style:{filter:s?R?"blur(0px)":`blur(${r}px)`:R?"blur(0px)":`blur(${r}px)`,transition:`filter ${d}s ease`,"--border-color":l,"--glow-color":h},onMouseEnter:()=>w(y),onMouseLeave:o,children:a},y)}),e.jsxs(ke.div,{className:"focus-frame",animate:{x:I.x,y:I.y,width:I.width,height:I.height,opacity:b>=0?1:0},transition:{duration:d},style:{"--border-color":l,"--glow-color":h},children:[e.jsx("span",{className:"corner top-left"}),e.jsx("span",{className:"corner top-right"}),e.jsx("span",{className:"corner bottom-left"}),e.jsx("span",{className:"corner bottom-right"})]})]})},vn="https://images.unsplash.com/photo-1549924231-f129b911e442?auto=format&fit=crop&w=1920&q=80";function jn(){const s=W(I=>I.auth.user)?.firstName??"Unknown User",r=(()=>{const I=new Date().getHours();return I<12?"Good Morning":I<15?"Good Afternoon":I<18?"Good Evening":"Hey"})(),[l,h]=x.useState(""),{data:d=[],isLoading:T,isError:N,error:b}=Z.useGetAllEventsQuery(void 0),k=I=>{const c=I.date??I.startDate??I.eventDate??I.event_date??I.start_date,w=new Date(c??0);return isNaN(w.valueOf())?new Date(0):w},C=x.useMemo(()=>{const I=new Date;return d.filter(c=>k(c)>=I).filter(c=>l.trim()?c.title?.toLowerCase().includes(l.toLowerCase()):!0).sort((c,w)=>k(c).getTime()-k(w).getTime()).slice(0,5)},[d,l]),E=l.trim().length>0,P=I=>I.eventId??I.id??I._id,v=x.useRef(null);return x.useEffect(()=>{if(!v.current)return;const I=new hs(v.current,{strings:[s],typeSpeed:100,backSpeed:1e3,showCursor:!0,cursorChar:"ðŸ‘‹",loop:!1});return()=>I.destroy()},[s]),e.jsxs("div",{className:"relative min-h-screen flex items-center justify-center bg-base-100 text-base-content overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-cover bg-center opacity-10 dark:opacity-20",style:{backgroundImage:`url(${vn})`}}),e.jsx("div",{className:"absolute inset-0 bg-base-100/60 backdrop-blur z-10"}),e.jsxs("div",{className:"relative z-20 text-center px-6 animate-fadeIn",children:[e.jsx(yn,{sentence:"TicketStream ðŸŽ« Events And Ticketing Management System",manualMode:!1,blurAmount:2,borderColor:"cyan",animationDuration:2,pauseBetweenAnimations:2}),e.jsxs("div",{className:"mt-12 bg-base-200/80 backdrop-blur-xl rounded-2xl p-8 shadow-xl border border-base-300 max-w-6xl mx-auto flex flex-col md:flex-row gap-8 animate-fadeInUp",children:[e.jsxs("div",{className:"flex-1 text-left space-y-4",children:[e.jsxs("h1",{className:"text-4xl md:text-5xl font-extrabold text-primary animate-fadeInUp",children:[r,","," ",e.jsx("span",{ref:v,className:"text-secondary"})]}),e.jsxs("p",{className:"leading-relaxed animate-fadeInUp",children:["Welcome to ",e.jsx("span",{className:"text-accent font-semibold",children:"TicketStream ðŸŽ«"})," â€” your ultimate platform for effortless event and ticketing management.",e.jsx("br",{}),e.jsx("br",{}),"Whether itâ€™s a festival or a meetup, our tools help you sell tickets and promote your events like a pro."]}),e.jsx(G,{to:"/events",className:"btn btn-primary font-bold py-2 px-6 rounded-xl shadow transition animate-fadeInUp",children:"Get Started"})]}),e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx("input",{type:"text",placeholder:"Search events by title...",value:l,onChange:I=>h(I.target.value),className:"input input-bordered w-full text-base-content animate-fadeInUp"}),T&&e.jsx("div",{className:"flex justify-center items-center py-10 animate-fadeIn",children:e.jsx(ra,{height:60,width:60,radius:1,color:"#06b6d4",ariaLabel:"loading-events",visible:!0})}),N&&e.jsx("p",{className:"text-error animate-fadeIn",children:b?.status||"Failed to load events"}),!T&&E&&C.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-success mb-2 animate-fadeInUp",children:["Showing ",C.length," matching upcoming event",C.length>1?"s":""," for â€œ",l,"â€."]}),e.jsx(G,{to:"/events",className:"btn btn-accent mb-4 animate-fadeInUp",children:"View All Events"})]}),!T&&E&&C.length===0&&e.jsx("p",{className:"text-error animate-fadeInUp",children:"No matching upcoming events found."}),!T&&C.length>0&&e.jsx("ul",{className:"space-y-2 max-h-60 overflow-y-auto pr-2 animate-fadeInUp",children:C.map((I,c)=>e.jsx("li",{className:"bg-base-300/50 px-4 py-2 rounded hover:bg-base-300 transition",style:{animationDelay:`${c*100}ms`},children:e.jsxs(G,{to:`/events/${P(I)}`,className:"flex justify-between items-center group transition duration-300",children:[e.jsx("span",{children:I.title}),e.jsx("span",{className:"text-xl text-primary transform transition-transform duration-300 group-hover:translate-x-2 group-hover:scale-110",children:"â†’"})]})},P(I)))})]})]})]})]})}const Nn="/assets/event1-pNSwdocT.png",wn="/assets/event1-BbOrUT2y.jpg",kn="/assets/wine-D0O_pnGr.jpg",Tn="/assets/cake-llLS3Lgh.jpg",Sn="/assets/event3-DdrMyhy7.jpg",En="/assets/street-BJVYPb2F.jpeg",Cn=[{id:"1",title:"Koroga Festival",location:"Nairobi Arboretum",date:"July 2024",image:Nn},{id:"2",title:"Nairobi Jazz Festival",location:"Uhuru Park, Nairobi",date:"May 2024",image:wn},{id:"3",title:"Blankets & Wine",location:"Loresho Gardens, Nairobi",date:"June 2025",image:kn},{id:"4",title:"Cake Festival",location:"Nairobi Arboretum",date:"October 2025",image:Tn},{id:"5",title:"Nairobi Restaurant Week",location:"Various Restaurants, Nairobi",date:"February 2025",image:Sn},{id:"6",title:"Street Food Festival",location:"Jamhuri Showgrounds",date:"March 2025",image:En}],In=()=>e.jsx("section",{className:"py-20 px-6 bg-base-100 text-base-content transition-colors duration-300",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h2",{className:"text-4xl font-extrabold text-center text-primary mb-6",children:"Popular Events Weâ€™ve Hosted With"}),e.jsx("p",{className:"text-base-content/70 text-center max-w-2xl mx-auto mb-12",children:"Weâ€™re proud to have supported some of Kenyaâ€™s most iconic festivals and live showsâ€”powering unforgettable experiences."}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10",children:Cn.map(t=>e.jsxs("div",{className:"card shadow-md bg-base-200 border border-base-300 hover:shadow-xl transition-transform hover:-translate-y-1 hover:scale-105",children:[e.jsx("figure",{className:"h-48 overflow-hidden",children:e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"card-body",children:[e.jsx("h3",{className:"card-title text-primary",children:t.title}),e.jsx("p",{className:"text-sm text-base-content/60",children:t.location}),e.jsx("p",{className:"text-sm text-base-content/50",children:t.date})]})]},t.id))})]})}),An=()=>e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx(Zt,{triggerOnce:!0,cascade:!0,damping:.1,children:e.jsx(jn,{})}),e.jsx(es,{triggerOnce:!0,direction:"left",duration:600,children:e.jsx(fn,{})}),e.jsx(es,{triggerOnce:!0,direction:"right",duration:600,children:e.jsx(In,{})}),e.jsx(Zt,{triggerOnce:!0,delay:200,children:e.jsx(Ke,{})})]}),Pn=()=>{const t=oe();return e.jsx("section",{className:"min-h-screen py-20 px-6 bg-base-200 text-base-content",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h1",{className:"text-4xl sm:text-5xl font-extrabold text-primary mb-4",children:"About TicketStream ðŸŽ«"}),e.jsxs("p",{className:"text-lg max-w-3xl mx-auto text-base-content/70",children:["At ",e.jsx("span",{className:"text-primary font-semibold",children:"TicketStream"}),", we connect people with unforgettable experiencesâ€”empowering organizers and guiding attendees to the best events and venues across Kenya and beyond."]})]}),e.jsxs("div",{className:"grid gap-12 md:grid-cols-2",children:[e.jsx("div",{className:"card bg-base-100 shadow-md border border-base-300",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title text-primary",children:"Our Mission"}),e.jsx("p",{children:"To revolutionize the way events are discovered, attended, and enjoyed in East Africaâ€”creating seamless experiences from ticketing to the final applause."})]})}),e.jsx("div",{className:"card bg-base-100 shadow-md border border-base-300",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title text-primary",children:"What We Offer"}),e.jsxs("ul",{className:"list-disc list-inside space-y-2 text-base-content/80",children:[e.jsx("li",{children:"Discover trending concerts, festivals, expos & shows"}),e.jsx("li",{children:"Access real-time event updates and notifications"}),e.jsx("li",{children:"Easy and secure ticket purchases"}),e.jsx("li",{children:"Tools for event organizers to manage and grow their audience"})]})]})}),e.jsx("div",{className:"card bg-base-100 shadow-md border border-base-300",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title text-primary",children:"Who We Work With"}),e.jsx("p",{children:"We proudly support local promoters, music festivals, corporate events, university shows, and charity galas. If it brings people together, weâ€™re there to help it shine."})]})}),e.jsx("div",{className:"card bg-base-100 shadow-md border border-base-300",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title text-primary",children:"Our Vision"}),e.jsx("p",{children:"To be East Africaâ€™s leading hub for discovering and managing live eventsâ€”bridging people, culture, and creativity through powerful digital experiences."})]})})]}),e.jsx("div",{className:"mt-24 card bg-base-100 shadow-lg border border-base-300",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary text-center mb-6",children:"Why Choose TicketStream?"}),e.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-8 text-base-content/80",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-2",children:"Effortless Ticketing"}),e.jsx("p",{children:"Purchase and scan tickets easily with QR technologyâ€”no stress or printouts."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-2",children:"Real-Time Event Updates"}),e.jsx("p",{children:"Stay informed with alerts, changes, and last-minute deals via mobile & web."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-primary mb-2",children:"Data-Driven Tools"}),e.jsx("p",{children:"Organizers get insights, analytics, and management tools to scale events efficiently."})]})]})]})}),e.jsxs("div",{className:"mt-20 text-center",children:[e.jsx("h3",{className:"text-2xl text-primary font-semibold mb-3",children:"Ready to Streamline Your Event?"}),e.jsx("p",{className:"text-base-content/70 mb-6",children:"Whether you're hosting or attendingâ€”weâ€™re here to make your experience seamless, exciting, and unforgettable."}),e.jsx("button",{onClick:()=>t("/events"),className:"btn btn-primary btn-wide",children:"Explore Upcoming Events"})]})]})})},Bn=()=>(x.useEffect(()=>{xe.success("Welcome to the About Page ðŸŽ‰")},[]),e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx(Pn,{}),e.jsx(Ke,{})]})),it=t=>{const s=ts(`${t.date} ${t.time}`),r=ts();return s.isBefore(r)?"past":s.isSame(r,"day")?"ongoing":"upcoming"},Tt=({event:t,isAuthenticated:s,navigate:r})=>{const{data:l=[]}=Re.useGetMediaByEventIdQuery(t.eventId),h=l.length>0?l[0].url:null,d=parseFloat(t.ticketPrice),T=it(t),N=T==="past",b=T==="past"?"Event Ended":T==="ongoing"?"Ongoing":"Upcoming",k=T==="past"?"bg-base-300 text-base-content":T==="ongoing"?"bg-warning text-black":"bg-success text-black";return e.jsxs("div",{className:"relative bg-base-200 border border-primary rounded-xl p-5 shadow-lg hover:shadow-xl transition hover:-translate-y-1 hover:scale-105 duration-300",children:[h&&e.jsx("img",{src:h,alt:t.title,className:"w-full h-48 object-cover rounded-lg mb-4 border border-primary/30"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-primary",children:t.title}),e.jsxs("p",{className:"text-lg font-semibold text-accent",children:["$",isNaN(d)?"0.00":d.toFixed(2)]})]}),e.jsx("p",{className:"text-base-content text-opacity-80 mb-4 line-clamp-3",children:t.description||"No description available."}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm text-base-content bg-base-100 border border-base-300 rounded-lg p-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col items-center text-center",children:["ðŸ“… ",e.jsx("span",{children:t.date})]}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:["â° ",e.jsx("span",{children:t.time})]}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:["ðŸŸï¸ ",e.jsx("span",{children:t.venue?.name||"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:["ðŸ“ ",e.jsx("span",{children:t.venue?.address||"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:["ðŸ‘¥ capapcity",e.jsx("span",{children:t.venue?.capacity??"N/A"})]}),e.jsxs("div",{className:"flex flex-col items-center text-center",children:["ðŸ·ï¸ ",e.jsx("span",{children:t.category||"Uncategorized"})]})]}),s?e.jsxs("button",{onClick:()=>!N&&r(`/events/${t.eventId}`),className:`btn w-full font-semibold ${N?"btn-disabled":"btn-primary"} flex items-center justify-center gap-2`,disabled:N,children:[e.jsx(ia,{className:"text-lg"}),N?"Event Ended":"Book Ticket"]}):e.jsxs("a",{href:"/login",className:"btn btn-primary w-full flex items-center justify-center gap-2",children:[e.jsx(la,{className:"text-lg"}),"Sign in to Book"]}),e.jsx("span",{className:`absolute top-3 right-3 text-xs font-bold px-3 py-1 rounded-full ${k}`,children:b})]})},Dn=()=>{const t=oe(),[s,r]=x.useState(""),[l,h]=x.useState(""),d=W(o=>o.auth.isAuthenticated),{data:T=[],isFetching:N}=Z.useGetEventsByTitleQuery(s,{skip:!s}),{data:b=[],isFetching:k}=Z.useGetEventsByCategoryQuery(l,{skip:!l}),{data:C=[],isLoading:E,error:P}=Z.useGetAllEventsQuery(void 0,{skip:!!s||!!l}),v=s?T:l?b:C,I=v.filter(o=>it(o)==="ongoing"),c=v.filter(o=>it(o)==="upcoming"),w=v.filter(o=>it(o)==="past");return e.jsx("section",{className:"min-h-screen py-16 px-6 bg-base-100 text-base-content",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h2",{className:"text-4xl font-extrabold text-primary text-center mb-10",children:"Browse Events"}),e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-center gap-4 mb-10",children:[e.jsx("input",{type:"text",placeholder:"Search by title...",className:"input input-bordered w-full md:w-1/3",value:s,onChange:o=>{r(o.target.value),h("")}}),e.jsx("input",{type:"text",placeholder:"Search by category...",className:"input input-bordered w-full md:w-1/3",value:l,onChange:o=>{h(o.target.value),r("")}}),(s||l)&&e.jsx("button",{onClick:()=>{r(""),h("")},className:"btn btn-error btn-sm",children:"Clear Filters"})]}),P?e.jsx("div",{className:"text-error text-center font-semibold",children:"Something went wrong. Please try again."}):E||N||k?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ge,{color:"#22d3ee"})}):v.length===0?e.jsx("div",{className:"text-center text-info text-lg",children:"No events found."}):e.jsxs(e.Fragment,{children:[I.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-2xl font-bold text-warning mb-2 mt-10",children:"Ongoing Events"}),e.jsx("p",{className:"text-base-content text-opacity-70 mb-6",children:"These events are currently taking place."}),e.jsx("div",{className:"grid gap-10 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:I.map(o=>e.jsx(Tt,{event:o,isAuthenticated:d,navigate:t},o.eventId))})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-2xl font-bold text-success mb-2 mt-10",children:"Upcoming Events"}),e.jsx("p",{className:"text-base-content text-opacity-70 mb-6",children:"Book your tickets now for future events!"}),e.jsx("div",{className:"grid gap-10 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:c.map(o=>e.jsx(Tt,{event:o,isAuthenticated:d,navigate:t},o.eventId))})]}),w.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-2xl font-bold text-base-content mb-2 mt-10",children:"Past Events"}),e.jsx("p",{className:"text-base-content text-opacity-50 mb-6",children:"These events have already concluded."}),e.jsx("div",{className:"grid gap-10 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3",children:w.map(o=>e.jsx(Tt,{event:o,isAuthenticated:d,navigate:t},o.eventId))})]})]})]})})},Fn=()=>(x.useEffect(()=>{xe.success("Welcome to the Events Page ðŸŽŸï¸")},[]),e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx(Dn,{}),e.jsx(Ke,{})]})),Rn="/assets/image-UqgNANsLtSGIkgMfhkxPvvVyfWIhWH-B_UaMQUs.png",Un=()=>{const{register:t,handleSubmit:s,formState:{errors:r}}=Ut(),[l,{isLoading:h}]=me.useLoginUserMutation(),d=oe(),T=dt(),[N,b]=x.useState(!1),k=async C=>{const E=Ie.loading("Logging In...");try{const P=await l(C).unwrap();Ie.success("âœ… Logged in successfully",{id:E}),T(sn(P)),d(P.role==="admin"?"/AdminDashboard/analytics":"/")}catch(P){const v=P?.data?.error?.error||P?.data?.error||P?.error||"âŒ Something went wrong. Please try again.";if(v.toLowerCase().includes("verify your email")){Ie.error("âŒ Login failed: Please verify your email first",{id:E}),d("/email-verification",{state:{email:C.email}});return}Ie.error(`Failed to login: ${v}`,{id:E})}};return e.jsxs(e.Fragment,{children:[e.jsx(js,{richColors:!0,position:"top-right"}),e.jsx(fe,{}),e.jsxs("div",{className:"min-h-screen grid grid-cols-1 md:grid-cols-2 bg-base-200 text-base-content transition-colors duration-300",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx("img",{src:Rn,alt:"Login Illustration",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-base-200 shadow-xl rounded-2xl p-8 w-full max-w-md border-2 border-blue-500",children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-center",children:"ðŸŽ“ TicketStream Login Portal"}),e.jsxs("form",{className:"space-y-5",onSubmit:s(k),children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"ðŸ“§ Email"}),e.jsx("input",{type:"email",className:"input input-bordered w-full",placeholder:"Enter your email",...t("email",{required:!0})}),r.email&&e.jsx("span",{className:"text-error text-sm mt-1 block",children:"Email is required."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"ðŸ” Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:N?"text":"password",className:"input input-bordered w-full pr-10",placeholder:"Enter your password",...t("password",{required:!0})}),e.jsx("button",{type:"button",onClick:()=>b(!N),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400 hover:text-primary",tabIndex:-1,children:N?e.jsx(Ns,{size:20}):e.jsx(ws,{size:20})})]}),r.password&&e.jsx("span",{className:"text-error text-sm mt-1 block",children:"Password is required."})]}),e.jsx("div",{className:"text-right",children:e.jsx(G,{to:"/forgot-password",className:"text-sm text-blue-600 hover:underline",children:"Forgot password?"})}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full mt-4 text-lg tracking-wide",disabled:h,children:h?"ðŸš€ Logging in...":"ðŸŽ¯ Login"})]}),e.jsxs("p",{className:"text-sm text-center mt-5",children:["Don't have an account?"," ",e.jsx(G,{to:"/register",className:"text-primary hover:underline",children:"Register here"})]})]})})]})]})},Ln="/assets/image-4TLovP5EoCnEpmnDaAcAiw2LIV7evw-CF6tH_Mi.png",St=t=>{let s=0;return t.length>=8&&s++,/[A-Z]/.test(t)&&s++,/[a-z]/.test(t)&&s++,/\d/.test(t)&&s++,/[@$!%*?&#^()\-_=+]/.test(t)&&s++,s<=2?{label:"Weak",color:"bg-error",percent:"33%"}:s===3||s===4?{label:"Medium",color:"bg-warning",percent:"66%"}:{label:"Strong",color:"bg-success",percent:"100%"}},Mn=()=>{const{register:t,handleSubmit:s,formState:{errors:r}}=Ut(),[l,{isLoading:h}]=me.useRegisterUserMutation(),d=oe(),[T,N]=x.useState(""),[b,k]=x.useState(!1),C=async E=>{const P={...E,nationalId:Number(E.nationalId)};if(isNaN(P.nationalId)){Ie.error("âŒ National ID must be a number.");return}try{const v=Ie.loading("ðŸš€ Creating Account..."),I=await l(E).unwrap();Ie.success(I?.message,{id:v}),d("/email-verification",{state:{email:E.email,message:I?.message||"Please verify your email to complete registration."}})}catch(v){const I=v?.data?.error||v?.error||"âŒ Something went wrong. Please try again.";Ie.error(`ðŸš« Failed to register: ${I}`)}};return e.jsxs(e.Fragment,{children:[e.jsx(js,{richColors:!0,position:"top-right"}),e.jsx(fe,{}),e.jsxs("div",{className:"min-h-screen grid grid-cols-1 md:grid-cols-2 bg-base-100 text-base-content",children:[e.jsx("div",{className:"hidden md:flex items-center justify-center",children:e.jsx("img",{src:Ln,alt:"Event Registration",className:"w-full h-full object-cover"})}),e.jsx("div",{className:"flex items-center justify-center p-8 mt-10",children:e.jsxs("div",{className:"bg-base-200 shadow-xl rounded-2xl p-8 w-full max-w-md border-2 border-blue-500",children:[e.jsx("h2",{className:"text-3xl font-bold text-center mb-6 text-primary",children:"ðŸ“ Create an Account"}),e.jsxs("form",{onSubmit:s(C),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label label-text font-medium",children:"First Name"}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Jane",...t("firstName",{required:!0})}),r.firstName&&e.jsx("p",{className:"text-error text-sm mt-1",children:"First name is required."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label label-text font-medium",children:"Last Name"}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"Doe",...t("lastName",{required:!0})}),r.lastName&&e.jsx("p",{className:"text-error text-sm mt-1",children:"Last name is required."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label label-text font-medium",children:"National ID"}),e.jsx("input",{type:"number",className:"input input-bordered w-full",placeholder:"1234567890",...t("nationalId",{required:!0,valueAsNumber:!0})}),r.nationalId&&e.jsx("p",{className:"text-error text-sm mt-1",children:"National ID is required."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label label-text font-medium",children:"Email"}),e.jsx("input",{type:"email",className:"input input-bordered w-full",placeholder:"jane@example.com",...t("email",{required:!0})}),r.email&&e.jsx("p",{className:"text-error text-sm mt-1",children:"Email is required."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label label-text font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:b?"text":"password",className:"input input-bordered w-full pr-10",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",...t("password",{required:!0}),value:T,onChange:E=>N(E.target.value)}),e.jsx("button",{type:"button",onClick:()=>k(!b),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-300",children:b?e.jsx(Ns,{size:20}):e.jsx(ws,{size:20})})]}),r.password&&e.jsx("p",{className:"text-error text-sm mt-1",children:"Password is required."}),T&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"h-2 w-full rounded bg-base-300 overflow-hidden",children:e.jsx("div",{className:`h-full ${St(T).color}`,style:{width:St(T).percent}})}),e.jsxs("p",{className:"text-sm mt-1 text-base-content",children:["Strength: ",e.jsx("span",{className:"capitalize",children:St(T).label})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label label-text font-medium",children:"Phone"}),e.jsx("input",{type:"text",className:"input input-bordered w-full",placeholder:"+254...",...t("contactPhone",{required:!0})}),r.contactPhone&&e.jsx("p",{className:"text-error text-sm mt-1",children:"Phone number is required."})]}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full mt-2",disabled:h,children:h?"ðŸš€ Creating...":"ðŸŽ¯ Create Account"}),e.jsxs("p",{className:"text-sm text-center mt-4 text-base-content",children:["Already have an account?"," ",e.jsx(G,{to:"/login",className:"text-primary hover:underline",children:"Login here"})]})]})]})})]})]})},qn=[{name:"Analytics",path:"analytics",icon:e.jsx(ca,{className:"text-indigo-400"})},{name:"Manage Users",path:"AllUsers",icon:e.jsx(bs,{className:"text-blue-400"})},{name:"Manage Bookings",path:"AllBookings",icon:e.jsx(ks,{className:"text-pink-500"})},{name:"Manage Venues",path:"Allvenues",icon:e.jsx(st,{className:"text-green-400"})},{name:"Manage Medias",path:"AllMedia",icon:e.jsx(da,{className:"text-yellow-400"})},{name:"Manage Events",path:"AllEvents",icon:e.jsx(Ts,{className:"text-orange-400"})},{name:"Manage Payments",path:"AllPayments",icon:e.jsx(Ss,{className:"text-yellow-900"})},{name:"Manage Support Tickets",path:"supportTickets",icon:e.jsx(ct,{className:"text-purple-400"})},{name:"Manage Ticket Types",path:"ticketTypes",icon:e.jsx(ua,{className:"text-teal-400"})},{name:"Sales Report",path:"SalesReports",icon:e.jsx(ot,{className:"text-red-400"})},{name:"My Profile",path:"adminprofile",icon:e.jsx(ot,{className:"text-purple-400"})},{name:"Logout",path:"#",icon:e.jsx(Rt,{className:"text-red-500"})}],rs=({onNavItemClick:t})=>{const s=dt(),r=()=>{s(zt()),t?.()};return e.jsxs("aside",{className:"h-full w-full p-4 bg-base-200 text-base-content space-y-2 overflow-y-auto rounded-lg shadow-md border border-blue-500 mt-17 border-r-2 border-b-4",children:[e.jsxs("h4",{className:"mt-1 mb-4 flex items-center justify-center text-xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 via-purple-500 to-yellow-500",children:[e.jsx("span",{className:"mr-2",children:"ðŸ› ï¸"}),"Admin Panel",e.jsx("span",{className:"ml-2",children:"ðŸ‘‘"})]}),qn.map((l,h)=>l.name==="Logout"?e.jsxs("button",{onClick:r,className:"flex items-center gap-3 px-4 py-2 rounded-lg hover:bg-base-300 transition w-full text-left","aria-label":"Logout",children:[l.icon,e.jsx("span",{className:"font-chewy",children:l.name})]},h):e.jsxs(oa,{to:l.path,onClick:t,className:({isActive:d})=>`flex items-center gap-3 px-4 py-2 rounded-lg transition hover:bg-base-300 ${d?"bg-base-300 font-semibold text-primary":""}`,"aria-label":`Go to ${l.name}`,children:[l.icon,e.jsx("span",{className:"font-chewy",children:l.name})]},h))]})},$n=()=>{const[t,s]=x.useState(!1);return e.jsxs("div",{className:"flex h-screen bg-base-100 text-base-content relative",children:[e.jsx("button",{onClick:()=>s(!0),className:"md:hidden fixed top-4 left-4 z-50 p-2 bg-base-300 text-base-content rounded-lg border border-blue-500 shadow-lg hover:bg-base-200 transition","aria-label":"Open Sidebar",children:e.jsx(Es,{size:24})}),e.jsx("aside",{className:"hidden md:block w-64 h-full fixed top-0 left-0 z-30 bg-base-200 border-r border-blue-500 shadow-xl",children:e.jsx(rs,{onNavItemClick:()=>{}})}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black/60 backdrop-blur-sm",onClick:()=>s(!1)}),e.jsx("aside",{className:"fixed top-0 left-0 z-50 w-64 h-full bg-base-200 text-base-content border-r border-blue-500 shadow-xl md:hidden",children:e.jsx(rs,{onNavItemClick:()=>s(!1)})})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:ml-64 bg-base-100 text-base-content transition-all duration-300",children:e.jsx(Lt,{})})]})},_n=()=>e.jsxs("div",{className:"h-screen mt-20",children:[e.jsx(fe,{}),e.jsx($n,{})]}),is=({onNavItemClick:t})=>{const s=dt(),r=oe(),l=()=>{s(zt()),r("/login"),t?.()};return e.jsxs("aside",{className:"min-h-full bg-base-200 text-base-content border rounded-xl shadow-lg p-4 mt-16",children:[e.jsx("h2",{className:"text-lg font-semibold flex items-center gap-2 mb-4 text-primary font-chewy",children:"ðŸš€ User Dashboard ðŸš€"}),e.jsxs("ul",{className:"menu gap-2 text-base-content",children:[e.jsx("li",{children:e.jsxs(G,{to:"me",onClick:t,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-primary hover:text-primary-content transition duration-300",children:[e.jsx(ot,{className:"text-primary"}),e.jsx("span",{className:"font-chewy",children:"My Profile"})]})}),e.jsx("li",{children:e.jsxs(G,{to:"MyBookings",onClick:t,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-secondary hover:text-secondary-content transition duration-300",children:[e.jsx(ma,{className:"text-secondary"}),e.jsx("span",{className:"font-chewy",children:"My Bookings"})]})}),e.jsx("li",{children:e.jsxs(G,{to:"Payments",onClick:t,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-accent hover:text-accent-content transition duration-300",children:[e.jsx(xa,{className:"text-warning"}),e.jsx("span",{className:"font-chewy",children:"Payments"})]})}),e.jsx("li",{children:e.jsxs(G,{to:"supportTickets",onClick:t,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-red-500 hover:text-accent-content transition duration-300",children:[e.jsx(ha,{className:"text-success"}),e.jsx("span",{className:"font-chewy",children:"Support Tickets"})]})}),e.jsx("li",{children:e.jsxs(G,{to:"MyTickets",onClick:t,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-accent hover:text-accent-content transition duration-300",children:[e.jsx(ct,{className:"text-success"}),e.jsx("span",{className:"font-chewy",children:"My Tickets"})]})}),e.jsx("li",{children:e.jsxs(G,{to:"/",onClick:t,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-accent hover:text-accent-content transition duration-300",children:[e.jsxs("svg",{className:"lucide lucide-house text-success",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}),e.jsx("path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"})]}),e.jsx("span",{className:"font-chewy",children:"Home"})]})}),e.jsx("li",{children:e.jsxs("button",{onClick:l,className:"flex items-center gap-3 p-3 rounded-lg hover:bg-error hover:text-error-content transition duration-300 w-full text-left",children:[e.jsx(Rt,{className:"text-error"}),e.jsx("span",{className:"font-chewy",children:"Logout"})]})})]})]})},zn=()=>{const[t,s]=x.useState(!1);return e.jsxs("div",{className:"flex h-screen bg-base-100 text-base-content",children:[e.jsx("button",{onClick:()=>s(!0),className:"md:hidden fixed top-4 left-4 z-50 p-2 bg-base-200 rounded shadow","aria-label":"Open Sidebar",children:e.jsx(Es,{size:24})}),e.jsx("aside",{className:"hidden md:block w-64 h-full bg-base-200 border-r border-base-300 fixed top-0 left-0 z-30",children:e.jsx(is,{})}),t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-40 bg-black bg-opacity-40 backdrop-blur-sm",onClick:()=>s(!1)}),e.jsx("aside",{className:"fixed top-0 left-0 z-50 w-64 h-full bg-base-200 border-r border-base-300 transform transition-transform duration-300 md:hidden translate-x-0",children:e.jsx(is,{onNavItemClick:()=>s(!1)})})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 md:ml-64",children:e.jsx(Lt,{})})]})},On=()=>e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx(zn,{})]}),ls=({children:t})=>{const{isAuthenticated:s}=W(r=>r.auth);return s?e.jsx(e.Fragment,{children:t}):e.jsx(pa,{to:"/login",replace:!0})};function Qe(){const t=ga();return e.jsx("div",{className:"py-10  bg:base-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-base font-semibold text-red-500",children:"404"}),e.jsx("h1",{className:"mt-2 text-3xl font-bold tracking-tight text-green-300 sm:text-5xl",children:"Page not found"}),e.jsx("p",{className:"mt-4 text-base leading-7 text-gray-600",children:"Sorry, we couldn&apos:t find the page you're looking for."}),e.jsx("p",{children:t?.statusText||t.message}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-x-3",children:[e.jsxs(G,{to:"/",className:"inline-flex items-center btn btn-sm btn-info text-sm font-semibold",children:[e.jsx(Cs,{size:16,className:"mr-2"}),"Go back"]}),e.jsx(G,{to:"/contact",className:"rounded-md btn btn-primary btn-sm  text-sm font-semibold",children:" Contact us"})]})]})})}const Gn=()=>{const t=W(g=>g.auth.user?.nationalId),{data:s,isLoading:r,refetch:l}=Ot(t,{skip:!t}),[h]=Fs(),[d,T]=x.useState(!1),[N,b]=x.useState({firstName:"",lastName:"",email:"",profileImageUrl:"",role:""}),[k,C]=x.useState(null),[E,P]=x.useState(""),[v,I]=x.useState(0),[c,w]=x.useState(()=>localStorage.getItem("theme")||"light"),[o,a]=x.useState(!1),y="dwibg4vvf",R="tickets_Profile";x.useEffect(()=>{document.documentElement.setAttribute("data-theme",c),localStorage.setItem("theme",c)},[c]),x.useEffect(()=>{s&&(b({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",profileImageUrl:s.profileImageUrl||"",role:s.role||""}),P(s.profileImageUrl||""))},[s]);const U=g=>{const{name:S,value:j}=g.target;b($=>({...$,[S]:j}))},F=g=>{const S=g.target.files?.[0];S&&(C(S),P(URL.createObjectURL(S)))},L=async()=>{if(!k)return N.profileImageUrl;const g=new FormData;g.append("file",k),g.append("upload_preset",R);try{return(await Mt.post(`https://api.cloudinary.com/v1_1/${y}/image/upload`,g,{onUploadProgress:j=>{const $=Math.round(j.loaded*100/(j.total||1));I($)}})).data.secure_url}catch(S){return console.error("Image upload failed:",S),_.fire("Error","Failed to upload profile image.","error"),null}},B=async g=>{g.preventDefault(),a(!0);const S=await L();try{await h({nationalId:t,...N,profileImageUrl:S||N.profileImageUrl}).unwrap(),_.fire({icon:"success",title:"Profile Updated!",text:"Your changes have been saved.",timer:2e3,showConfirmButton:!1}),T(!1),C(null),I(0),l()}catch(j){console.error("Update failed:",j),_.fire({icon:"error",title:"Update Failed",text:"Something went wrong. Please try again."})}finally{a(!1)}},i=()=>w(c==="light"?"dark":"light");return r||!s?e.jsx("div",{className:"text-center",children:"Loading user..."}):e.jsxs("div",{className:"max-w-xl mx-auto mt-10 p-6 rounded-xl shadow-lg bg-base-100 text-base-content",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"User Profile"}),e.jsx("button",{onClick:i,className:"btn btn-circle btn-ghost",children:c==="light"?e.jsx(Bt,{className:"h-5 w-5"}):e.jsx(Dt,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("img",{src:E||"/default-avatar.png",alt:"Profile",className:"w-32 h-32 rounded-full object-cover border"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:F,className:"mt-2"}),v>0&&e.jsx("div",{className:"w-full bg-gray-300 h-2 rounded",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded transition-all duration-300",style:{width:`${v}%`}})})]}),!d&&e.jsxs("h2",{className:"text-xl font-bold",children:[s.firstName," ",s.lastName]})]}),d?e.jsxs("form",{onSubmit:B,className:"mt-6 space-y-4",children:[e.jsx("input",{name:"firstName",placeholder:"First Name",value:N.firstName,onChange:U,className:"input input-bordered w-full",required:!0}),e.jsx("input",{name:"lastName",placeholder:"Last Name",value:N.lastName,onChange:U,className:"input input-bordered w-full",required:!0}),e.jsx("input",{name:"email",value:N.email,disabled:!0,className:"input input-bordered w-full bg-gray-100 cursor-not-allowed"}),e.jsx("input",{name:"role",value:N.role,disabled:!0,className:"input input-bordered w-full bg-gray-100 cursor-not-allowed"}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>T(!1),className:"btn btn-outline",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Saving...":"Save Changes"})]})]}):e.jsxs("div",{className:"mt-6 space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"National ID:"})," ",s.nationalId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",s.role||"user"]}),e.jsx("button",{onClick:()=>T(!0),className:"mt-4 btn btn-accent",children:"Edit Profile"})]})]})},Vn={hover:{scale:1.05},tap:{scale:.95}},os=["#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#FF6699","#33CCFF"],Qn=(t,s=7)=>{const r={},l=new Date;for(let h=s-1;h>=0;h--){const d=new Date(l);d.setDate(l.getDate()-h);const T=d.toISOString().slice(0,10);r[T]=0}return t.forEach(h=>{const d=h.createdAt.slice(0,10);d in r&&r[d]++}),Object.entries(r).map(([h,d])=>({name:h,value:d}))},Yn=t=>{const s=new Date,r={};for(let l=23;l>=0;l--){const h=new Date(s);h.setHours(s.getHours()-l,0,0,0);const d=h.toISOString().slice(0,13);r[d]=0}return t.forEach(l=>{const h=l.createdAt.slice(0,13);h in r&&r[h]++}),Object.entries(r).map(([l,h])=>({name:l.split("T")[1]+":00",value:h}))},cs=(t,s,r)=>{const l=new Date(t);return l>=s&&l<=r},Hn=()=>{const{isAuthenticated:t,user:s}=W(g=>g.auth),{data:r=[],isLoading:l}=me.useGetAllUsersProfilesQuery({skip:!t}),{data:h=[],isLoading:d}=Z.useGetAllEventsQuery({skip:!t}),T=r.length,N=h.length,b={};h.forEach(g=>{const S=g.venue?.name||"Unknown Venue";b[S]=(b[S]||0)+1});const k=Object.keys(b).length,C=k>0?(N/k).toFixed(2):"0",E=Object.entries(b).map(([g,S])=>({name:g,value:S})).sort((g,S)=>S.value-g.value).slice(0,5),P={};h.forEach(g=>{const S=g.category||"Unknown";P[S]=(P[S]||0)+1});const v=Object.entries(P).map(([g,S])=>({name:g,value:S})).sort((g,S)=>S.value-g.value).slice(0,5),I=h.reduce((g,S)=>g+(S.attendance||0),0),c=new Date,w=new Date(c);w.setDate(c.getDate()-c.getDay());const o=new Date(w);o.setDate(w.getDate()+6);const a=new Date(c.getFullYear(),c.getMonth(),1),y=new Date(c.getFullYear(),c.getMonth()+1,0),R=h.filter(g=>cs(g.date,w,o)).length,U=h.filter(g=>cs(g.date,a,y)).length,F=Qn(r,7),L=Yn(r),B=[{name:"Users",value:T},{name:"Events",value:N},{name:"Venues",value:k}],i=(()=>{const g=new Date().getHours();return g<12?`Good Morning, Admin ${s?.firstName||"Gajkenye"}!`:g<18?`Good Afternoon, Admin ${s?.firstName||"Gajkenye"}!`:`Good Evening, Admin ${s?.firstName||"Gajkenye"}!`})();return e.jsx("div",{className:"min-h-screen bg-base-200/90 py-12 px-6",children:e.jsxs("div",{className:"container mx-auto space-y-12",children:[e.jsx("div",{className:"w-full bg-base-300/70 text-base-content p-6 rounded-xl border border-base-content/20 shadow-md text-center",children:e.jsx("h1",{className:"text-2xl font-bold text-primary",children:i})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[{icon:e.jsx(fa,{size:40}),label:"Users",count:T,loading:l},{icon:e.jsx(ss,{size:40}),label:"Venues",count:k,loading:d},{icon:e.jsx(wt,{size:40}),label:"Events",count:N,loading:d},{icon:e.jsx(ss,{size:40}),label:"Avg Bookings per Venue",count:C,loading:!1},{icon:e.jsx(wt,{size:40}),label:"Events This Week",count:R,loading:d},{icon:e.jsx(wt,{size:40}),label:"Events This Month",count:U,loading:d}].map((g,S)=>e.jsx(ke.div,{variants:Vn,whileHover:"hover",whileTap:"tap",className:"w-full bg-base-300/70 text-base-content p-6 rounded-xl border border-base-content/20 shadow-md flex flex-col items-center justify-center text-center",children:g.loading?e.jsx(ge,{color:"var(--pf)",size:40}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-3",children:g.icon}),e.jsx("h2",{className:"text-xl font-semibold text-primary",children:g.label}),e.jsx("p",{className:"text-3xl font-extrabold",children:g.count})]})},S))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-10",children:[e.jsxs("div",{className:"bg-base-300/70 p-6 rounded-xl shadow-md border border-base-content/20",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-primary",children:"User, Event & Venue Distribution"}),e.jsx(Fe,{width:"100%",height:300,children:e.jsxs(Is,{children:[e.jsx(As,{data:B,dataKey:"value",nameKey:"name",outerRadius:100,fill:"#8884d8",label:!0,children:B.map((g,S)=>e.jsx(It,{fill:os[S%os.length]},`cell-${S}`))}),e.jsx($e,{})]})})]}),e.jsxs("div",{className:"bg-base-300/70 p-6 rounded-xl shadow-md border border-base-content/20",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-primary",children:"Top Event Categories"}),e.jsx(Fe,{width:"100%",height:300,children:e.jsxs(nt,{data:v,children:[e.jsx(Ze,{strokeDasharray:"3 3"}),e.jsx(Ye,{dataKey:"name"}),e.jsx(He,{}),e.jsx($e,{}),e.jsx(rt,{dataKey:"value",fill:"#00C49F"})]})})]}),e.jsxs("div",{className:"bg-base-300/70 p-6 rounded-xl shadow-md border border-base-content/20",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-primary",children:"New Users (Last 7 Days)"}),e.jsx(Fe,{width:"100%",height:300,children:e.jsxs(ba,{data:F,children:[e.jsx(Ze,{strokeDasharray:"3 3"}),e.jsx(Ye,{dataKey:"name"}),e.jsx(He,{}),e.jsx($e,{}),e.jsx(ya,{type:"monotone",dataKey:"value",stroke:"#FF8042"})]})})]}),e.jsxs("div",{className:"bg-base-300/70 p-6 rounded-xl shadow-md border border-base-content/20",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-primary",children:"Top Booked Venues"}),e.jsx(Fe,{width:"100%",height:300,children:e.jsxs(nt,{data:E,children:[e.jsx(Ze,{strokeDasharray:"3 3"}),e.jsx(Ye,{dataKey:"name"}),e.jsx(He,{}),e.jsx($e,{}),e.jsx(rt,{dataKey:"value",fill:"#8884d8"})]})})]}),e.jsxs("div",{className:"bg-base-300/70 p-6 rounded-xl shadow-md border border-base-content/20",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-primary",children:"Users Registered (Last 24 Hours)"}),e.jsx(Fe,{width:"100%",height:300,children:e.jsxs(nt,{data:L,children:[e.jsx(Ze,{strokeDasharray:"3 3"}),e.jsx(Ye,{dataKey:"name"}),e.jsx(He,{allowDecimals:!1}),e.jsx($e,{}),e.jsx(rt,{dataKey:"value",fill:"#33CCFF"})]})})]})]}),e.jsxs("div",{className:"bg-base-300/70 p-6 rounded-xl shadow-md border border-base-content/20 text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-primary",children:"Total Attendance Recorded"}),e.jsx("p",{className:"text-3xl font-extrabold mt-2",children:I})]})]})})},ve=xt(_),Xn=()=>{const{data:t=[],isLoading:s,error:r}=rn({pollingInterval:3e4}),[l]=on(),[h]=ln(),[d]=nn(),[T,N]=x.useState(""),[b,k]=x.useState(1),C=10,P=W(y=>y.auth.user)?.firstName||"Admin",v=t.filter(y=>{const R=T.toLowerCase();return y.firstName.toLowerCase().includes(R)||y.lastName.toLowerCase().includes(R)||y.nationalId.toString().includes(R)}),I=Math.ceil(v.length/C),c=v.slice((b-1)*C,b*C),w=async y=>{if((await ve.fire({title:"Are you sure?",text:"This user will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",customClass:{popup:"glass-modal"}})).isConfirmed)try{await l(y).unwrap(),ve.fire({title:"Deleted!",text:"User has been removed.",icon:"success",customClass:{popup:"glass-modal"}})}catch{ve.fire({title:"Error!",text:"Failed to delete user.",icon:"error",customClass:{popup:"glass-modal"}})}},o=async y=>{const{value:R}=await ve.fire({title:`Edit ${y.firstName} ${y.lastName}`,html:`
        <input id="swal-input1" class="swal2-input" placeholder="First Name" value="${y.firstName}">
        <input id="swal-input2" class="swal2-input" placeholder="Last Name" value="${y.lastName}">
        <input id="swal-input3" class="swal2-input" placeholder="Email" value="${y.email}">
        <input id="swal-input4" class="swal2-input" placeholder="New Password (optional)" type="password">
        <select id="swal-input5" class="swal2-input" style="background-color: #000; font-size: 1rem; padding: 0.5rem;">
          <option value="user" ${y.role==="user"?"selected":""}>ðŸ‘¤ User</option>
          <option value="admin" ${y.role==="admin"?"selected":""}>ðŸ›¡ï¸ Admin</option>
        </select>
      `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Update",customClass:{popup:"glass-modal"},preConfirm:()=>{const U=document.getElementById("swal-input1").value,F=document.getElementById("swal-input2").value,L=document.getElementById("swal-input3").value,B=document.getElementById("swal-input4").value,i=document.getElementById("swal-input5").value;if(!U||!F||!L||!i){_.showValidationMessage("All fields except password are required.");return}const g={nationalId:y.nationalId,firstName:U,lastName:F,email:L,role:i};return B&&(g.password=B),g}});if(R)try{await h(R).unwrap(),ve.fire({title:"Success!",text:"User updated successfully.",icon:"success",customClass:{popup:"glass-modal"}})}catch{ve.fire({title:"Error!",text:"Failed to update user.",icon:"error",customClass:{popup:"glass-modal"}})}},a=async()=>{const{value:y}=await ve.fire({title:"Add New User",html:`
        <input id="add-fname" class="swal2-input" placeholder="First Name">
        <input id="add-lname" class="swal2-input" placeholder="Last Name">
        <input id="add-email" class="swal2-input" placeholder="Email">
        <input id="add-password" class="swal2-input" placeholder="Password" type="password">
        <input id="add-id" class="swal2-input" placeholder="National ID" type="number">
        <input id="add-address" class="swal2-input" placeholder="Address">
      `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Create",customClass:{popup:"glass-modal"},preConfirm:()=>{const R=document.getElementById("add-fname").value,U=document.getElementById("add-lname").value,F=document.getElementById("add-email").value,L=document.getElementById("add-password").value,B=Number(document.getElementById("add-id").value),i=document.getElementById("add-address").value;if(!R||!U||!F||!L||!B||!i){_.showValidationMessage("Please fill in all fields.");return}return{firstName:R,lastName:U,email:F,password:L,nationalId:B,address:i}}});if(y)try{await d({...y}).unwrap(),ve.fire({title:"Success!",text:"User created successfully.",icon:"success",customClass:{popup:"glass-modal"}})}catch{ve.fire({title:"Error!",text:"Failed to create user.",icon:"error",customClass:{popup:"glass-modal"}})}};return e.jsxs("div",{className:"min-h-screen p-6 bg-base-100 text-base-content",children:[e.jsxs("div",{className:"mb-6 text-xl sm:text-2xl font-semibold text-primary",children:["ðŸ‘‹ Hey ",P,", welcome!"]}),e.jsxs("div",{className:"w-full max-w-7xl border border-base-300 bg-base-200 shadow-xl rounded-xl p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary",children:"All Users"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full sm:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Search by name or ID",className:"px-4 py-2 w-full sm:w-64 rounded-md bg-base-300 text-base-content placeholder:text-base-content/70 focus:outline-none focus:ring focus:ring-primary",value:T,onChange:y=>N(y.target.value)}),e.jsx("button",{onClick:a,className:"px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded",children:"âž• Add User"})]})]}),r?e.jsx("div",{className:"text-error text-center text-lg font-semibold",children:"Something went wrong. Please try again."}):s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ge,{color:"#22d3ee"})}):v.length===0?e.jsx("div",{className:"text-center text-base-content text-lg",children:"No matching users found."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-auto border-2 border-blue-500 rounded-lg shadow-xl bg-base-200/60 backdrop-blur-sm",children:e.jsxs("table",{className:"min-w-full text-sm text-base-content",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-base-300 text-primary uppercase text-xs tracking-wider",children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"First Name"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Last Name"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"National ID"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Created At"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:c.map((y,R)=>e.jsxs("tr",{className:"hover:bg-base-100 transition duration-200 border-b border-base-300",children:[e.jsx("td",{className:"px-4 py-2",children:y.firstName}),e.jsx("td",{className:"px-4 py-2",children:y.lastName}),e.jsx("td",{className:"px-4 py-2",children:y.email}),e.jsx("td",{className:"px-4 py-2",children:y.nationalId}),e.jsx("td",{className:"px-4 py-2",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-semibold ${y.role==="admin"?"bg-green-600 text-white":"bg-yellow-400 text-black"}`,children:y.role})}),e.jsx("td",{className:"px-4 py-2",children:new Date(y.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-2 space-x-2",children:[e.jsx("button",{onClick:()=>o(y),className:"px-3 py-1 bg-blue-500 hover:bg-blue-600 rounded text-white text-xs",children:e.jsx(ut,{})}),e.jsx("button",{onClick:()=>w(y.nationalId),className:"px-3 py-1 bg-red-500 hover:bg-red-600 rounded text-white text-xs",children:e.jsx(mt,{})})]})]},R))})]})}),e.jsxs("div",{className:"flex justify-center mt-6 gap-4 items-center",children:[e.jsx("button",{onClick:()=>k(y=>Math.max(y-1,1)),className:"px-4 py-2 bg-base-300 hover:bg-base-200 rounded disabled:opacity-50",disabled:b===1,children:"â—€ Previous"}),e.jsxs("span",{className:"text-base-content font-medium",children:["Page ",b," of ",I]}),e.jsx("button",{onClick:()=>k(y=>Math.min(y+1,I)),className:"px-4 py-2 bg-base-300 hover:bg-base-200 rounded disabled:opacity-50",disabled:b===I,children:"Next â–¶"})]})]})]})]})},we=he({reducerPath:"venueApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/",prepareHeaders:(t,{getState:s})=>{const r=s().auth.token;return r&&t.set("Authorization",`${r}`),t.set("Content-Type","application/json"),t}}),refetchOnReconnect:!0,refetchOnMountOrArgChange:!0,tagTypes:["venues","venue"],endpoints:t=>({createVenue:t.mutation({query:s=>({url:"venues",method:"POST",body:s}),invalidatesTags:[{type:"venues",id:"LIST"}]}),updateVenue:t.mutation({query:({venueId:s,...r})=>({url:`venues/${s}`,method:"PUT",body:r}),invalidatesTags:(s,r,{venueId:l})=>[{type:"venues",id:l},{type:"venues",id:"LIST"}]}),deleteVenue:t.mutation({query:s=>({url:`venues/${s}`,method:"DELETE"}),invalidatesTags:(s,r,l)=>[{type:"venues",id:l},{type:"venues",id:"LIST"}]}),getAllVenues:t.query({query:()=>"venues",providesTags:s=>s?[...s.map(r=>({type:"venues",id:r.venueId})),{type:"venues",id:"LIST"}]:[{type:"venues",id:"LIST"}]}),getVenueByName:t.query({query:s=>`venues/${s}`,providesTags:["venue"]})})}),Ce=xt(_),Kn=()=>{const{data:t=[],isLoading:s,error:r,refetch:l}=we.useGetAllVenuesQuery(void 0,{pollingInterval:6e4,refetchOnMountOrArgChange:!0}),[h]=we.useCreateVenueMutation(),[d]=we.useUpdateVenueMutation(),[T]=we.useDeleteVenueMutation(),N=W(c=>c.auth.user?.firstName),[b,k]=x.useState(""),C=t.filter(c=>c.name.toLowerCase().includes(b.toLowerCase())),E=c=>{const{status:w,...o}=c;return{...o,status:w}},P=async c=>{const{value:w}=await Ce.fire({title:c?"Edit Venue":"Add New Venue",html:`
        <input id="venue-name" class="swal2-input" placeholder="Venue Name" value="${c?.name??""}" />
        <input id="venue-address" class="swal2-input" placeholder="Address" value="${c?.address??""}" />
        <input id="venue-capacity" class="swal2-input" type="number" placeholder="Capacity" value="${c?.capacity??""}" />
        <select id="venue-status" class="swal2-input">
          <option value="available" ${c?.status==="available"?"selected":""}>âœ… Available</option>
          <option value="booked" ${c?.status==="booked"?"selected":""}>ðŸ“Œ Booked</option>
        </select>
      `,showCancelButton:!0,confirmButtonText:c?"Update":"Create",width:"600px",customClass:{popup:"glass-modal"},preConfirm:()=>{const o=document.getElementById("venue-name").value.trim(),a=document.getElementById("venue-address").value.trim(),y=Number(document.getElementById("venue-capacity").value),R=document.getElementById("venue-status").value||"available";if(!o||!a||!y){_.showValidationMessage("All fields are required.");return}const U={name:o,address:a,capacity:y,status:R};return c&&(U.venueId=c.venueId),U}});if(w)try{w.venueId?(await d(E(w)).unwrap(),Ce.fire("Updated!","Venue updated successfully.","success")):(await h(E(w)).unwrap(),Ce.fire("Created!","Venue created successfully.","success")),l()}catch(o){Ce.fire("Error",o?.data?.message||"Failed to save venue.","error")}},v=async(c,w)=>{if(c.status!==w)try{await d(E({venueId:c.venueId,status:w})).unwrap(),l()}catch(o){Ce.fire("Error",o?.data?.message||"Failed to update status.","error")}},I=async c=>{if((await Ce.fire({title:"Are you sure?",text:"This venue will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",customClass:{popup:"glass-modal"}})).isConfirmed)try{await T(c).unwrap(),Ce.fire("Deleted!","Venue has been removed.","success"),l()}catch(o){Ce.fire("Error!",o?.data?.message||"Failed to delete venue.","error")}};return e.jsxs("div",{className:"min-h-screen p-6 bg-base-100 text-base-content",children:[e.jsxs("div",{className:"mb-6 text-xl sm:text-2xl font-semibold text-primary",children:["ðŸ‘‹ Hey ",N,", welcome!"]}),e.jsxs("div",{className:"w-full max-w-6xl mx-auto bg-base-200 rounded-xl border border-base-300 shadow-lg p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary",children:"All Venues"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full sm:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Search by venue name",className:"input input-bordered w-full sm:w-64",value:b,onChange:c=>k(c.target.value)}),e.jsx("button",{onClick:()=>P(),className:"btn btn-success",children:"âž• Add Venue"})]})]}),r?e.jsx("div",{className:"text-error text-center text-lg font-semibold",children:"Something went wrong. Please try again."}):s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ge,{color:"#22d3ee"})}):C.length===0?e.jsx("div",{className:"text-center text-info text-lg",children:"No venues found."}):e.jsxs("table",{className:"table table-zebra text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content bg-primary text-xs uppercase",children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Capacity"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:C.map(c=>e.jsxs("tr",{children:[e.jsx("td",{children:c.name}),e.jsx("td",{children:c.address}),e.jsx("td",{children:c.capacity}),e.jsx("td",{children:e.jsxs("select",{className:`select select-xs ${c.status==="available"?"bg-green-500 text-white":"bg-yellow-500 text-white"}`,value:c.status,onChange:w=>v(c,w.target.value),children:[e.jsx("option",{value:"available",children:"âœ… Available"}),e.jsx("option",{value:"booked",children:"ðŸ“Œ Booked"})]})}),e.jsx("td",{children:new Date(c.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>P(c),className:"btn btn-xs btn-info",children:e.jsx(ut,{})}),e.jsx("button",{onClick:()=>I(c.venueId),className:"btn btn-xs btn-error",children:e.jsx(mt,{})})]})]},c.venueId))})]})]})]})},De=xt(_),Wn=["upcoming","in_progress","ended","cancelled"],Jn=()=>{const{data:t=[],isLoading:s,error:r,refetch:l}=Z.useGetAllEventsQuery({pollingInterval:3e4}),{data:h=[]}=we.useGetAllVenuesQuery({}),[d]=Z.useCreateEventMutation(),[T]=Z.useUpdateEventMutation(),[N]=Z.useDeleteEventMutation(),b=W(i=>i.auth.user?.firstName),[k,C]=x.useState(""),[E,P]=x.useState(""),[v,I]=x.useState(""),[c,w]=x.useState(1),o=10,a=Array.from(new Set(t.map(i=>i.category))),y=t.map(i=>{const g=new Date,S=new Date(`${i.date}T${i.time}`);return{...i,status:S<=g&&i.status!=="ended"&&i.status!=="cancelled"?"in_progress":i.status}}).filter(i=>i.title.toLowerCase().includes(k.toLowerCase())&&(E?i.category===E:!0)&&(v?i.date===v:!0)),R=Math.ceil(y.length/o),U=y.slice((c-1)*o,c*o),F=async i=>{const{value:g}=await De.fire({title:i?"Edit Event":"Add New Event",html:`
        <input id="title" class="swal2-input" placeholder="Title" value="${i?.title??""}">
        <input id="description" class="swal2-input" placeholder="Description" value="${i?.description??""}">
        <input id="category" class="swal2-input" placeholder="Category" value="${i?.category??""}">
        <input id="date" class="swal2-input" type="date" value="${i?.date??""}">
        <input id="time" class="swal2-input" type="time" value="${i?.time??""}">
        <input id="ticketPrice" class="swal2-input" type="number" placeholder="Ticket Price" value="${i?.ticketPrice??""}">
        <input id="ticketsTotal" class="swal2-input" type="number" placeholder="Tickets Total" value="${i?.ticketsTotal??""}">
        <select id="venueId" class="swal2-input">
          ${h.map(S=>`<option value="${S.venueId}" ${i?.venueId===S.venueId?"selected":""}>${S.name}</option>`).join("")}
        </select>
        <select id="status" class="swal2-input">
          ${Wn.map(S=>`<option value="${S}" ${i?.status===S?"selected":""}>${S.replace("_"," ")}</option>`).join("")}
        </select>
      `,showCancelButton:!0,confirmButtonText:i?"Update":"Create",width:"600px",customClass:{popup:"glass-modal"},preConfirm:()=>{const S=document.getElementById("title").value.trim(),j=document.getElementById("description").value.trim(),$=document.getElementById("category").value.trim(),f=document.getElementById("date").value,M=document.getElementById("time").value,q=Number(document.getElementById("ticketPrice").value),Y=Number(document.getElementById("ticketsTotal").value),H=Number(document.getElementById("venueId").value),p=document.getElementById("status").value;if(!S||!H||!f||!M||!q||!Y||!p){_.showValidationMessage("âš ï¸ Essential fields are required");return}return{eventId:i?.eventId,title:S,description:j,category:$,date:f,time:M,ticketPrice:q,ticketsTotal:Y,venueId:H,status:p}}});if(g)try{g.eventId?(await T(g).unwrap(),De.fire("Updated!","Event updated successfully.","success")):(await d(g).unwrap(),De.fire("Created!","Event created successfully.","success")),l()}catch(S){De.fire("Error",S?.data?.message||"Failed to save event.","error")}},L=async i=>{if((await De.fire({title:"Are you sure?",text:"This event will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, delete it!",customClass:{popup:"glass-modal"}})).isConfirmed)try{await N(i).unwrap(),De.fire("Deleted!","Event has been removed.","success"),l()}catch(S){De.fire("Error",S?.data?.message||"Failed to delete event.","error")}},B=i=>{const g={upcoming:"bg-blue-500",in_progress:"bg-yellow-500",ended:"bg-gray-500",cancelled:"bg-red-500"};return e.jsx("span",{className:`px-2 py-1 text-xs rounded text-white ${g[i]}`,children:i.replace("_"," ")})};return e.jsxs("div",{className:"min-h-screen p-6 bg-base-100 text-base-content",children:[e.jsxs("div",{className:"mb-6 text-xl sm:text-2xl font-semibold text-primary",children:["ðŸ‘‹ Hey ",b,", welcome!"]}),e.jsxs("div",{className:"w-full max-w-6xl mx-auto bg-base-200 rounded-xl border border-base-300 shadow-lg p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary",children:"All Events"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full sm:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Search by event title",className:"input input-bordered w-full sm:w-64",value:k,onChange:i=>C(i.target.value)}),e.jsxs("select",{className:"select select-bordered w-full sm:w-64",value:E,onChange:i=>P(i.target.value),children:[e.jsx("option",{value:"",children:"All Categories"}),a.map(i=>e.jsx("option",{value:i,children:i},i))]}),e.jsx("input",{type:"date",className:"input input-bordered w-full sm:w-64",value:v,onChange:i=>I(i.target.value)}),e.jsx("button",{onClick:()=>F(),className:"btn btn-success",children:"âž• Add Event"})]})]}),r?e.jsx("div",{className:"text-error text-center text-lg font-semibold",children:"Something went wrong. Please try again."}):s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ge,{color:"#22d3ee"})}):U.length===0?e.jsx("div",{className:"text-center text-info text-lg",children:"No events found."}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table table-zebra text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-primary-content bg-primary text-xs uppercase",children:[e.jsx("th",{children:"Title"}),e.jsx("th",{children:"Venue"}),e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:U.map(i=>e.jsxs("tr",{children:[e.jsx("td",{children:i.title}),e.jsx("td",{children:i.venue?.name}),e.jsx("td",{children:new Date(`${i.date}T${i.time}`).toLocaleDateString()}),e.jsx("td",{children:B(i.status)}),e.jsx("td",{children:new Date(i.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"space-x-2",children:[e.jsx("button",{onClick:()=>F(i),className:"btn btn-xs btn-info",children:e.jsx(ut,{})}),e.jsx("button",{onClick:()=>L(i.eventId),className:"btn btn-xs btn-error",children:e.jsx(mt,{})})]})]},i.eventId))})]}),e.jsxs("div",{className:"flex justify-center mt-6 gap-4 items-center",children:[e.jsx("button",{onClick:()=>w(i=>Math.max(i-1,1)),className:"px-4 py-2 bg-base-300 hover:bg-base-200 rounded disabled:opacity-50",disabled:c===1,children:"â—€ Previous"}),e.jsxs("span",{className:"text-base-content font-medium",children:["Page ",c," of ",R]}),e.jsx("button",{onClick:()=>w(i=>Math.min(i+1,R)),className:"px-4 py-2 bg-base-300 hover:bg-base-200 rounded disabled:opacity-50",disabled:c===R,children:"Next â–¶"})]})]})]})]})},ue=he({reducerPath:"bookingApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/",prepareHeaders:(t,{getState:s})=>{const r=s().auth.token;return r&&t.set("Authorization",`Bearer ${r}`),t.set("Content-Type","application/json"),t}}),refetchOnReconnect:!0,refetchOnMountOrArgChange:!0,tagTypes:["Bookings","Booking"],endpoints:t=>({getAllBookings:t.query({query:()=>"bookings",providesTags:["Bookings"]}),getBookingById:t.query({query:s=>`bookings/${s}`,providesTags:(s,r,l)=>[{type:"Booking",id:l}]}),getBookingsByUserNationalId:t.query({query:s=>`bookings/user/national-id/${s}`,providesTags:["Bookings"]}),getBookingsByEventId:t.query({query:s=>`bookings/event/${s}`,providesTags:["Bookings"]}),createBooking:t.mutation({query:s=>({url:"bookings",method:"POST",body:s}),invalidatesTags:["Bookings"]}),updateBooking:t.mutation({query:({bookingId:s,body:r})=>({url:`bookings/${s}`,method:"PUT",body:r}),invalidatesTags:(s,r,{bookingId:l})=>["Bookings",{type:"Booking",id:l}]}),updateBookingStatus:t.mutation({query:({bookingId:s,status:r})=>({url:`bookings/${s}/status`,method:"PATCH",body:{status:r}}),invalidatesTags:(s,r,{bookingId:l})=>["Bookings",{type:"Booking",id:l}]}),cancelBooking:t.mutation({query:s=>({url:`bookings/${s}/cancel`,method:"PATCH"}),invalidatesTags:(s,r,l)=>["Bookings",{type:"Booking",id:l}]}),deleteBooking:t.mutation({query:s=>({url:`bookings/${s}`,method:"DELETE"}),invalidatesTags:(s,r,l)=>["Bookings",{type:"Booking",id:l}]})})}),{useGetAllBookingsQuery:ni,useGetBookingByIdQuery:ri,useGetBookingsByUserNationalIdQuery:Zn,useGetBookingsByEventIdQuery:ii,useCreateBookingMutation:er,useUpdateBookingMutation:tr,useUpdateBookingStatusMutation:li,useCancelBookingMutation:sr,useDeleteBookingMutation:oi}=ue,Ae=he({reducerPath:"paymentApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/",prepareHeaders:(t,{getState:s})=>{const r=s().auth.token;return r&&t.set("Authorization",`${r}`),t.set("Content-Type","application/json"),t}}),tagTypes:["payments","payment"],endpoints:t=>({getAllPayments:t.query({query:()=>"payments",providesTags:["payments"]}),getPaymentById:t.query({query:s=>`payments/${s}`,providesTags:(s,r,l)=>[{type:"payment",id:l}]}),getPaymentsByBookingId:t.query({query:s=>`payments/booking/${s}`,providesTags:["payments"]}),getPaymentsByNationalId:t.query({query:s=>`payments/national-id/${s}`,providesTags:["payments"]}),getPaymentsByStatus:t.query({query:s=>`payments-status-search?status=${s}`,providesTags:["payments"]}),createPayment:t.mutation({query:s=>({url:"payments",method:"POST",body:s}),invalidatesTags:["payments"]}),updatePayment:t.mutation({query:({id:s,...r})=>({url:`payments/${s}`,method:"PUT",body:r}),invalidatesTags:["payments"]}),deletePayment:t.mutation({query:s=>({url:`payments/${s}`,method:"DELETE"}),invalidatesTags:["payments"]}),createCheckoutSession:t.mutation({query:s=>({url:"payments/create-session",method:"POST",body:s})})})}),ar=()=>{const{user:t}=W(j=>j.auth),[s,r]=x.useState(null),[l,h]=x.useState(""),[d,T]=x.useState(1),N=10,{data:b,error:k,isLoading:C,isSuccess:E}=Zn(s,{skip:s===null}),{data:P}=Z.useGetAllEventsQuery({}),{data:v}=Te.useGetAllTicketTypesQuery({}),{data:I}=Ae.useGetPaymentsByNationalIdQuery(t?.nationalId,{skip:!t?.nationalId}),[c]=tr(),[w]=sr(),[o]=Ae.useCreateCheckoutSessionMutation();x.useEffect(()=>{t?.nationalId&&r(t.nationalId)},[t]),x.useEffect(()=>{!b||!I||!t?.nationalId||b.forEach(j=>{I.find(f=>f.bookingId===j.bookingId&&f.paymentStatus==="Completed")&&j.bookingStatus==="Pending"&&c({bookingId:j.bookingId,body:{bookingStatus:"Confirmed",quantity:j.quantity,totalAmount:j.totalAmount,ticketTypeId:j.ticketTypeId,eventId:j.eventId,nationalId:t.nationalId}}).unwrap().then(()=>{le.success(`âœ… Booking #${j.bookingId} auto-confirmed!`,{duration:4e3,style:{background:"#1f2937",color:"#a7f3d0"}})}).catch(f=>{console.error(`Failed to confirm booking #${j.bookingId}`,f)})})},[b,I,c,t?.nationalId]);const a=async j=>{if(!v){_.fire("Error","Ticket types not loaded yet.","error");return}if(j.bookingStatus!=="Pending"){_.fire("Not Editable","Only pending bookings can be edited.","warning");return}const $=v.map(Y=>`<option value="${Y.ticketTypeId}" ${Y.ticketTypeId===j.ticketTypeId?"selected":""}>${Y.name}</option>`).join(""),{value:f}=await _.fire({title:"Edit Booking",html:`
        <input id="quantity" class="swal2-input" type="number" min="1" value="${j.quantity}">
        <select id="ticketTypeId" class="swal2-input">${$}</select>
      `,focusConfirm:!1,showCancelButton:!0,confirmButtonText:"Save Changes",preConfirm:()=>{const Y=Number(document.getElementById("quantity").value),H=Number(document.getElementById("ticketTypeId").value);if(!Y||Y<1){_.showValidationMessage("Quantity must be at least 1");return}return{quantity:Y,ticketTypeId:H}}});if(!f)return;const q=((v.find(Y=>Y.ticketTypeId===f.ticketTypeId)?.price||0)*f.quantity).toFixed(2);try{await c({bookingId:j.bookingId,body:{quantity:f.quantity,totalAmount:q,bookingStatus:j.bookingStatus,ticketTypeId:f.ticketTypeId,eventId:j.eventId,nationalId:t.nationalId}}).unwrap(),_.fire("Success","Booking updated.","success")}catch{_.fire("Error","Update failed.","error")}},y=async j=>{const $=b?.find(M=>M.bookingId===j);if(!$||$.bookingStatus!=="Pending"){_.fire("Not Allowed","Only pending bookings can be cancelled.","warning");return}if((await _.fire({title:"Cancel booking?",text:"This action cannot be undone.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, cancel it!"})).isConfirmed)try{await w(j).unwrap(),_.fire("Cancelled","Booking cancelled successfully.","success")}catch{_.fire("Error","Failed to cancel booking.","error")}},R=async j=>{if(!t?.nationalId){_.fire("Error","You must be logged in to pay.","error");return}const $=P?.find(q=>q.eventId===j.eventId),f=v?.find(q=>q.ticketTypeId===j.ticketTypeId);if((await _.fire({title:"Confirm Payment",html:`
        <p><strong>Event:</strong> ${$?.title??"Unknown"}</p>
        <p><strong>Ticket:</strong> ${f?.name??"Unknown"}</p>
        <p><strong>Total:</strong> KSH ${Number(j.totalAmount).toFixed(2)}</p>
        <p>You will be redirected to the secure payment page.</p>
      `,icon:"info",showCancelButton:!0,confirmButtonText:"Pay Now",cancelButtonText:"Cancel",confirmButtonColor:"#3b82f6",cancelButtonColor:"#6b7280"})).isConfirmed)try{const q={amount:Math.round(Number(j.totalAmount)*100),nationalId:Number(t.nationalId),bookingId:j.bookingId,currency:"kes",successUrl:`${window.location.origin}/success`,cancelUrl:`${window.location.origin}/cancel`},Y=await o(q).unwrap();Y.url?window.location.href=Y.url:_.fire("Error","Failed to initiate payment.","error")}catch(q){console.error("Payment initiation failed:",q),_.fire("Error","Payment failed to initiate.","error")}},U=()=>!k||!("status"in k)?null:k.data&&typeof k.data=="object"&&"error"in k.data?k.data.error:"Error loading bookings.",L=[...b||[]].sort((j,$)=>new Date($.createdAt).getTime()-new Date(j.createdAt).getTime()).filter(j=>P?.find(f=>f.eventId===j.eventId)?.title.toLowerCase().includes(l.toLowerCase())),B=d*N,i=B-N,g=L.slice(i,B),S=Math.ceil(L.length/N);return e.jsxs("div",{className:"min-h-screen p-6 bg-base-100 mt-20",children:[e.jsx(qt,{}),e.jsx("div",{className:"max-w-7xl mx-auto p-1 rounded-xl bg-gradient-to-r from-indigo-500 via-purple-500 to-blue-500 shadow-xl animate-fadeIn transition-all duration-700",children:e.jsxs("div",{className:"rounded-xl bg-base-100 p-6",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-primary mb-4",children:["Hey, ",t?.firstName||"there"," ðŸ‘‹"]}),e.jsx("h2",{className:"text-3xl font-bold text-secondary mb-4",children:"Your Bookings"}),e.jsx("input",{type:"text",placeholder:"Search by event title...",className:"input input-bordered w-full max-w-sm mb-4",value:l,onChange:j=>h(j.target.value)}),C&&e.jsx("div",{className:"flex justify-center items-center my-10 animate-fadeIn",children:e.jsx($t,{color:"#a855f7",size:60})}),U()&&e.jsx("p",{className:"text-error",children:U()}),E&&g.length?e.jsxs("div",{className:"overflow-x-auto rounded-lg my-4 animate-fadeIn transition-all duration-700",children:[e.jsxs("table",{className:"table table-zebra text-sm bg-base-100 rounded-lg",children:[e.jsx("thead",{className:"text-xs uppercase bg-base-200 text-primary font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Booking ID"}),e.jsx("th",{children:"Event"}),e.jsx("th",{children:"Ticket"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:g.map(j=>{const $=P?.find(q=>q.eventId===j.eventId),f=v?.find(q=>q.ticketTypeId===j.ticketTypeId),M=Number(f?.price)||0;return e.jsxs("tr",{className:"hover:bg-base-200",children:[e.jsx("td",{children:j.bookingId}),e.jsx("td",{children:$?.title??"Unknown"}),e.jsx("td",{children:f?.name??"Unknown"}),e.jsxs("td",{children:["KSH ",M.toFixed(2)]}),e.jsx("td",{children:j.quantity}),e.jsxs("td",{children:["KSH ",Number(j.totalAmount).toFixed(2)]}),e.jsx("td",{children:j.bookingStatus}),e.jsx("td",{children:new Date(j.createdAt).toLocaleString()}),e.jsxs("td",{className:"space-y-1 flex flex-col",children:[e.jsx("button",{onClick:()=>a(j),disabled:j.bookingStatus!=="Pending",className:`btn btn-xs ${j.bookingStatus!=="Pending"?"btn-disabled":"btn-warning"}`,children:"Edit"}),j.bookingStatus==="Pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>y(j.bookingId),className:"btn btn-xs btn-error",children:"Cancel"}),e.jsx("button",{onClick:()=>R(j),className:"btn btn-xs btn-primary",children:"Pay Now"})]})]})]},j.bookingId)})})]}),S>1&&e.jsxs("div",{className:"flex justify-center mt-4 gap-2",children:[e.jsx("button",{className:"btn btn-sm",onClick:()=>T(j=>Math.max(j-1,1)),disabled:d===1,children:"Prev"}),Array.from({length:S},(j,$)=>e.jsx("button",{onClick:()=>T($+1),className:`btn btn-sm ${d===$+1?"btn-active":""}`,children:$+1},$+1)),e.jsx("button",{className:"btn btn-sm",onClick:()=>T(j=>Math.min(j+1,S)),disabled:d===S,children:"Next"})]})]}):!C&&e.jsx("p",{className:"text-info",children:"No bookings found."})]})})]})},nr=()=>{const t=oe(),{isAuthenticated:s,role:r}=W(p=>p.auth),{data:l,error:h,isLoading:d,refetch:T}=mn({}),[N,{isLoading:b}]=gn(),[k,{isLoading:C}]=pn(),[E,{isLoading:P}]=hn(),[v,I]=x.useState({}),[c,w]=x.useState(!1),[o,a]=x.useState(null),[y,R]=x.useState({name:"",price:"",quantity:"",eventId:""}),[U,F]=x.useState(!1),[L,B]=x.useState({name:"",price:"",quantity:"",eventId:""}),[i,g]=x.useState(""),[S,j]=x.useState(""),{data:$,isLoading:f}=Z.useGetAllEventsQuery({});x.useEffect(()=>{(!s||r!=="admin")&&t("/login")},[s,r,t]),x.useEffect(()=>{if($){const p={};$.forEach(O=>{p[O.eventId]=O.title}),I(p)}},[$]);const M=async p=>{if((await _.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await N(p).unwrap(),_.fire({icon:"success",title:"Deleted!",text:"Ticket type deleted successfully.",timer:2e3,showConfirmButton:!1})}catch(te){console.error("Failed to delete ticket type:",te),_.fire("Error!","Failed to delete ticket type.","error")}},q=p=>{a(p),R({name:p.name,price:p.price,quantity:p.quantity,eventId:p.eventId.toString()}),w(!0)},Y=async p=>{if(p.preventDefault(),!o)return;const{name:O,price:te,quantity:ce,eventId:be}=y;if(!be||!O||!te||!ce){_.fire({icon:"warning",title:"Missing Fields",text:"Please fill in all fields before updating."});return}const ze={id:o.ticketTypeId,name:O,price:parseFloat(te),quantity:parseInt(ce),eventId:parseInt(be)};try{await k(ze).unwrap(),_.fire({icon:"success",title:"Updated!",text:"Ticket type updated successfully.",timer:2e3,showConfirmButton:!1}),w(!1),a(null)}catch(ee){console.error("Failed to update ticket type:",ee),_.fire("Error!","Failed to update ticket type.","error")}},H=async p=>{p.preventDefault();const{name:O,price:te,quantity:ce,eventId:be}=L;if(!be||!O||!te||!ce){_.fire({icon:"warning",title:"Missing Fields",text:"Please fill in all fields before submitting."});return}const ze={name:O,price:parseFloat(te),quantity:parseInt(ce),eventId:parseInt(be)};try{await E(ze).unwrap(),_.fire({icon:"success",title:"Created!",text:"New ticket type created successfully.",timer:2e3,showConfirmButton:!1}),F(!1),B({name:"",price:"",quantity:"",eventId:""}),T()}catch(ee){console.error("Failed to create ticket type:",ee),_.fire("Error!","Failed to create ticket type.","error")}};return e.jsxs("div",{className:"min-h-screen text-white py-10 px-5 bg-gray-900",children:[e.jsxs("div",{className:"max-w-4xl mx-auto rounded-lg shadow-lg p-5 bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-orange-500",children:"Ticket Types"}),e.jsx("button",{className:"btn bg-green-600 text-white hover:bg-green-700",onClick:()=>F(!0),children:"+ New Ticket Type"})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row items-center gap-4",children:[e.jsx("input",{type:"text",placeholder:"Search by ticket name...",value:i,onChange:p=>g(p.target.value),className:"input input-bordered w-full md:w-1/2 bg-gray-700 text-white"}),e.jsxs("select",{value:S,onChange:p=>j(p.target.value),className:"select select-bordered w-full md:w-1/3 bg-gray-700 text-white",children:[e.jsx("option",{value:"",children:"All Events"}),$?.map(p=>e.jsx("option",{value:p.eventId,children:p.title},p.eventId))]})]}),d||f?e.jsx("p",{className:"text-gray-400",children:"Loading ticket types..."}):h?e.jsx("p",{className:"text-red-500",children:"Failed to load ticket types"}):e.jsx("div",{className:"space-y-4",children:l?.filter(p=>{const O=p.name.toLowerCase().includes(i.toLowerCase()),te=S?p.eventId===parseInt(S):!0;return O&&te}).map(p=>{const O=v[p.eventId]||"Unknown Event";return e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl border border-orange-400/20 p-4 rounded-xl shadow-xl transition-all duration-300 hover:shadow-2xl hover:border-orange-400",children:[e.jsx("h4",{className:"text-xl font-bold text-orange-400",children:p.name}),e.jsxs("p",{className:"text-gray-300",children:["Price: $",p.price]}),e.jsxs("p",{className:"text-gray-300",children:["Quantity Available: ",p.quantity]}),e.jsxs("p",{className:"text-gray-400 font-semibold italic",children:["Event Name: ",O]}),e.jsxs("div",{className:"mt-4 flex space-x-4",children:[e.jsx("button",{onClick:()=>q(p),className:"btn bg-orange-500 text-white hover:bg-orange-600",children:"Edit"}),e.jsx("button",{onClick:()=>M(p.ticketTypeId),className:"btn bg-red-500 text-white hover:bg-red-600",disabled:b,children:b?"Deleting...":"Delete"})]})]},p.ticketTypeId)})})]}),c&&e.jsx("dialog",{id:"edit_ticket_modal",className:"modal modal-open",children:e.jsxs("div",{className:"modal-box bg-gray-800 text-white",children:[e.jsx("h3",{className:"font-bold text-lg text-orange-400",children:"Edit Ticket Type"}),e.jsxs("form",{onSubmit:Y,className:"py-4 space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text text-gray-400",children:"Event"})}),e.jsxs("select",{className:"select select-bordered w-full bg-gray-700 text-white",value:y.eventId,onChange:p=>R({...y,eventId:p.target.value}),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select an Event"}),$?.map(p=>e.jsx("option",{value:p.eventId,children:p.title},p.eventId))]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text text-gray-400",children:"Ticket Name"})}),e.jsx("input",{type:"text",className:"input input-bordered w-full bg-gray-700 text-white",value:y.name,onChange:p=>R({...y,name:p.target.value}),required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text text-gray-400",children:"Price ($)"})}),e.jsx("input",{type:"number",step:"0.01",className:"input input-bordered w-full bg-gray-700 text-white",value:y.price,onChange:p=>R({...y,price:p.target.value}),required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text text-gray-400",children:"Quantity"})}),e.jsx("input",{type:"number",className:"input input-bordered w-full bg-gray-700 text-white",value:y.quantity,onChange:p=>R({...y,quantity:p.target.value}),required:!0})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"submit",className:"btn btn-warning",disabled:C,children:C?"Updating...":"Update Ticket"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>{w(!1),a(null)},disabled:C,children:"Cancel"})]})]})]})}),U&&e.jsx("dialog",{id:"create_ticket_modal",className:"modal modal-open",children:e.jsxs("div",{className:"modal-box bg-gray-800 text-white",children:[e.jsx("h3",{className:"font-bold text-lg text-green-400",children:"Create New Ticket Type"}),e.jsxs("form",{onSubmit:H,className:"py-4 space-y-4",children:[e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text text-gray-400",children:"Event"})}),e.jsxs("select",{className:"select select-bordered w-full bg-gray-700 text-white",value:L.eventId,onChange:p=>B({...L,eventId:p.target.value}),required:!0,children:[e.jsx("option",{value:"",disabled:!0,children:"Select an Event"}),$?.map(p=>e.jsx("option",{value:p.eventId,children:p.title},p.eventId))]})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text text-gray-400",children:"Ticket Name"})}),e.jsx("input",{type:"text",className:"input input-bordered w-full bg-gray-700 text-white",value:L.name,onChange:p=>B({...L,name:p.target.value}),required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text text-gray-400",children:"Price ($)"})}),e.jsx("input",{type:"number",step:"0.01",className:"input input-bordered w-full bg-gray-700 text-white",value:L.price,onChange:p=>B({...L,price:p.target.value}),required:!0})]}),e.jsxs("div",{className:"form-control",children:[e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text text-gray-400",children:"Quantity"})}),e.jsx("input",{type:"number",className:"input input-bordered w-full bg-gray-700 text-white",value:L.quantity,onChange:p=>B({...L,quantity:p.target.value}),required:!0})]}),e.jsxs("div",{className:"modal-action",children:[e.jsx("button",{type:"submit",className:"btn btn-success",disabled:P,children:P?"Creating...":"Create Ticket"}),e.jsx("button",{type:"button",className:"btn",onClick:()=>F(!1),disabled:P,children:"Cancel"})]})]})]})})]})},je=xt(_),ds=["Pending","Confirmed","Cancelled"],rr=()=>{const{data:t=[],isLoading:s,error:r}=ue.useGetAllBookingsQuery(void 0,{pollingInterval:3e4}),{data:l=[]}=Z.useGetAllEventsQuery(void 0),[h]=ue.useUpdateBookingStatusMutation(),[d]=ue.useCancelBookingMutation(),[T]=ue.useDeleteBookingMutation(),[N,b]=x.useState(""),[k,C]=x.useState(""),[E,P]=x.useState(""),[v,I]=x.useState(1),c=10,w=new Map(l.map(i=>[i.eventId,i.title])),o=W(i=>i.auth.user?.firstName),a=t.filter(i=>{const g=w.get(i.eventId)??"";return(!N||i.bookingId.toString().includes(N)||i.nationalId.toString().includes(N))&&(!k||i.bookingStatus===k)&&(!E||g.toLowerCase().includes(E.toLowerCase()))}),y=Math.ceil(a.length/c),R=a.slice((v-1)*c,v*c),U=async i=>{const{value:g}=await je.fire({title:`Update status for Booking #${i.bookingId}`,input:"select",inputOptions:ds.reduce((S,j)=>(S[j]=j,S),{}),inputValue:i.bookingStatus,showCancelButton:!0,confirmButtonText:"Update",customClass:{popup:"glass-modal"}});if(g&&g!==i.bookingStatus)try{await h({bookingId:i.bookingId,status:g}).unwrap(),je.fire("Success","Booking status updated.","success")}catch{je.fire("Error","Failed to update status.","error")}},F=async i=>{if((await je.fire({title:"Cancel booking?",text:"This will mark the booking as Cancelled and refund tickets.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Yes, cancel it!"})).isConfirmed)try{await d(i).unwrap(),je.fire("Cancelled!","Booking has been cancelled.","success")}catch{je.fire("Error","Failed to cancel booking.","error")}},L=async i=>{if((await je.fire({title:"Delete booking?",text:"This booking will be permanently removed.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:"Delete"})).isConfirmed)try{await T(i).unwrap(),je.fire("Deleted!","Booking has been removed.","success")}catch{je.fire("Error","Failed to delete booking.","error")}},B=i=>{const g={Pending:"bg-yellow-500",Confirmed:"bg-green-500",Cancelled:"bg-red-500"};return e.jsx("span",{className:`px-2 py-1 text-xs rounded text-white ${g[i]}`,children:i})};return s?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(ge,{color:"#14b8a6"})}):r?e.jsx("div",{className:"text-center text-red-400",children:"Error loading bookings."}):e.jsxs("div",{className:"min-h-screen p-6 bg-base-100 text-base-content",children:[e.jsxs("div",{className:"mb-6 text-xl sm:text-2xl font-semibold text-primary",children:["ðŸ‘‹ Hey ",o,", welcome!"]}),e.jsxs("div",{className:"w-full max-w-7xl mx-auto bg-base-200 border border-base-content/10 shadow-xl rounded-xl p-6 overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary",children:"All Bookings"}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-3 w-full sm:w-auto",children:[e.jsx("input",{type:"text",placeholder:"Search Booking / National ID",className:"px-4 py-2 w-full sm:w-48 rounded-md bg-base-300 text-base-content placeholder:text-base-content/50",value:N,onChange:i=>b(i.target.value)}),e.jsxs("select",{value:k,onChange:i=>C(i.target.value),className:"px-4 py-2 rounded bg-base-300 text-base-content",children:[e.jsx("option",{value:"",children:"All Statuses"}),ds.map(i=>e.jsx("option",{value:i,children:i},i))]}),e.jsx("input",{type:"text",placeholder:"Filter by Event Name",className:"px-4 py-2 w-full sm:w-48 rounded-md bg-base-300 text-base-content placeholder:text-base-content/50",value:E,onChange:i=>P(i.target.value)})]})]}),a.length===0?e.jsx("div",{className:"text-center text-base-content/70",children:"No bookings match your filters."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto rounded-md border border-base-content/10 shadow-md",children:e.jsxs("table",{className:"min-w-full text-sm text-base-content border border-base-content/20",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-base-300 text-primary uppercase text-xs border-b border-base-content/10",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"Booking ID"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"National ID"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Event"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Quantity"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Total"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Status"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Created"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:R.map(i=>e.jsxs("tr",{className:"border-b border-base-content/10 hover:bg-base-300",children:[e.jsx("td",{className:"px-4 py-2",children:i.bookingId}),e.jsx("td",{className:"px-4 py-2",children:i.nationalId}),e.jsx("td",{className:"px-4 py-2",children:w.get(i.eventId)??"Unknown"}),e.jsx("td",{className:"px-4 py-2",children:i.quantity}),e.jsxs("td",{className:"px-4 py-2",children:["$",Number(i.totalAmount).toFixed(2)]}),e.jsx("td",{className:"px-4 py-2",children:B(i.bookingStatus)}),e.jsx("td",{className:"px-4 py-2",children:new Date(i.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-4 py-2 space-x-2",children:[e.jsx("button",{onClick:()=>U(i),className:"text-xs px-2 py-1 bg-blue-600 rounded hover:bg-blue-700",children:e.jsx(ut,{})}),e.jsx("button",{onClick:()=>F(i.bookingId),className:"text-xs px-2 py-1 bg-yellow-600 rounded hover:bg-yellow-700",children:e.jsx(va,{})}),e.jsx("button",{onClick:()=>L(i.bookingId),className:"text-xs px-2 py-1 bg-red-600 rounded hover:bg-red-700",children:e.jsx(mt,{})})]})]},i.bookingId))})]})}),e.jsxs("div",{className:"flex justify-center items-center gap-4 mt-6",children:[e.jsx("button",{onClick:()=>I(i=>Math.max(i-1,1)),className:"px-4 py-2 bg-base-300 hover:bg-base-200 rounded disabled:opacity-50",disabled:v===1,children:"â—€ Previous"}),e.jsxs("span",{className:"text-base-content",children:["Page ",v," of ",y]}),e.jsx("button",{onClick:()=>I(i=>Math.min(i+1,y)),className:"px-4 py-2 bg-base-300 hover:bg-base-200 rounded disabled:opacity-50",disabled:v===y,children:"Next â–¶"})]})]})]})]})},Et=t=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:2}).format(t),ir=()=>{const{id:t}=Ps(),s=oe(),r=Ft(),{isAuthenticated:l,user:h}=W(F=>F.auth),{data:d,isLoading:T,error:N}=Z.useGetEventByIdQuery(t),{data:b}=xn(t),{data:k}=Re.useGetMediaByEventIdQuery(t),[C,{isLoading:E}]=er(),[P]=Ae.useCreateCheckoutSessionMutation(),[v,I]=x.useState(1),[c,w]=x.useState(""),o=Array.isArray(b)&&b.length>0;x.useEffect(()=>{w(o?b[0].name:"")},[b,o]);const a=async()=>{if(!l){le.error("You must be logged in to book tickets."),s("/login",{state:{from:r}});return}if(!o){le.error("No ticket types available.");return}if(!h?.nationalId||v<1){le.error("Invalid National ID or quantity");return}const F=b?.find(i=>i.name===c);if(!F){le.error("Invalid ticket type selected");return}const L=v*Number(F.price);if(L<.5){le.error("Total amount must be at least KSh 0.50.");return}const B={nationalId:Number(h.nationalId),eventId:Number(t),ticketTypeId:F.id,ticketTypeName:F.name,quantity:v,totalAmount:L.toString()};try{const i=await C(B).unwrap();le.success("Booking created successfully!");const g=i.booking?.[0]?.bookingId;if(!g){le.error("Booking ID not found.");return}const S={amount:Math.round(L*100),nationalId:Number(h.nationalId),bookingId:g,currency:"kes",successUrl:`${window.location.origin}/success`,cancelUrl:`${window.location.origin}/cancel`},j=await P(S).unwrap();j.url?window.location.href=j.url:le.error("Stripe session creation failed.")}catch(i){console.error(i),le.error("Booking or payment failed.")}};if(T)return e.jsx("div",{className:"flex justify-center items-center min-h-screen bg-base-200",children:e.jsx(ge,{color:"#6366f1",size:80})});if(N||!d)return e.jsx("p",{className:"text-error text-center mt-10 text-xl",children:"Event not found."});const R=b?.find(F=>F.name===c)?.price??0,U=v*R;return e.jsxs(e.Fragment,{children:[e.jsx(fe,{}),e.jsx("div",{className:"mt-20 min-h-screen bg-base-200 py-12 px-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto bg-base-100 shadow-lg rounded-2xl border border-base-300 p-8 text-base-content",children:[e.jsxs("button",{onClick:()=>s(-1),className:"btn btn-sm btn-outline mb-6",children:[e.jsx(Cs,{size:18}),"Go Back"]}),e.jsx("h1",{className:"text-4xl font-bold mb-2 text-center",children:d.title}),e.jsx("p",{className:"text-center text-base-content/80 mb-6",children:d.description}),k?.length>0&&e.jsx(ja.Carousel,{showThumbs:!1,infiniteLoop:!0,autoPlay:!0,children:k.map(F=>e.jsx("div",{children:F.type==="image"?e.jsx("img",{src:F.url,alt:"event media",className:"object-cover h-96 w-full rounded-lg"}):e.jsx("video",{controls:!0,className:"h-96 w-full rounded-lg bg-black",children:e.jsx("source",{src:F.url,type:"video/mp4"})})},F.mediaId))}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8 mt-10",children:[e.jsxs("div",{className:"flex-1 space-y-4 border border-base-300 rounded-xl p-4",children:[e.jsx(qe,{icon:e.jsx(ys,{}),label:"Category",value:d.category}),e.jsx(qe,{icon:e.jsx(Ts,{}),label:"Date",value:d.date}),e.jsx(qe,{icon:e.jsx(gs,{}),label:"Time",value:d.time}),e.jsx(qe,{icon:e.jsx(fs,{}),label:"Venue",value:d.venue?.name??"Unknown"}),e.jsx(qe,{icon:e.jsx(Ss,{}),label:"Base Price",value:`KSh ${d.ticketPrice}`}),e.jsx(qe,{icon:d.status==="Active"?e.jsx(Na,{className:"text-success"}):e.jsx(wa,{className:"text-error"}),label:"Status",value:d.status})]}),e.jsxs("div",{className:"flex-1 border border-base-300 rounded-xl p-6 space-y-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Book Your Ticket"}),!l&&e.jsxs("div",{className:"text-warning text-sm bg-warning/10 p-3 rounded-lg border border-warning mb-2",children:["Please"," ",e.jsx("span",{className:"underline cursor-pointer",onClick:()=>s("/login",{state:{from:r}}),children:"log in"})," ","to book tickets."]}),e.jsx("input",{type:"text",value:h?.nationalId||"",className:"input input-bordered w-full",readOnly:!0,disabled:!0}),e.jsx("input",{type:"number",min:1,className:"input input-bordered w-full",value:v,onChange:F=>I(Number(F.target.value)),disabled:!l}),o?e.jsx("select",{className:"select select-bordered w-full",value:c,onChange:F=>w(F.target.value),disabled:!l,children:b.map(F=>e.jsxs("option",{value:F.name,children:[F.name," - ",Et(F.price)]},F.id))}):e.jsx("p",{className:"text-sm text-base-content/60 bg-base-200 p-4 rounded-lg border border-base-300",children:"No ticket types available."}),o&&e.jsxs("div",{className:"bg-base-200 border border-base-300 rounded-lg p-4 text-sm space-y-2",children:[e.jsxs("p",{children:["ðŸ’µ ",e.jsx("strong",{children:"Ticket:"})," ",Et(R)]}),e.jsxs("p",{children:["#ï¸âƒ£ ",e.jsx("strong",{children:"Quantity:"})," ",v]}),e.jsxs("p",{children:["ðŸ§® ",e.jsx("strong",{children:"Total:"})," ",Et(U)]})]}),e.jsxs("button",{onClick:()=>{l?a():s("/login",{state:{from:r}})},className:"btn btn-primary w-full flex items-center justify-center gap-2 disabled:opacity-50",disabled:E||!o,children:[e.jsx(vs,{size:18}),l?o?E?"Processing...":"Book & Pay Now":"No ticket types available":"Please Login to Book"]})]})]})]})}),e.jsx(Ke,{})]})},qe=({icon:t,label:s,value:r})=>e.jsxs("div",{className:"flex items-center gap-3 text-base",children:[e.jsx("div",{className:"text-primary",children:t}),e.jsxs("span",{children:[e.jsxs("strong",{children:[s,":"]})," ",r]})]}),lr=()=>{const{data:t,isLoading:s,isError:r}=dn(void 0),{data:l=[]}=Z.useGetAllEventsQuery({}),[h,{isLoading:d}]=cn(),[T]=un(),N="dwibg4vvf",b="tickets",[k,C]=x.useState(""),[E,P]=x.useState("image"),[v,I]=x.useState(null),[c,w]=x.useState(0),[o,a]=x.useState(!1),y=W(B=>B.auth.user.firstName),R=async B=>{if(B.preventDefault(),!v||!k||!E){_.fire("Missing Info","Please provide all required fields.","warning");return}const i=new FormData;i.append("file",v),i.append("upload_preset",b);try{const S=(await Mt.post(`https://api.cloudinary.com/v1_1/${N}/${E}/upload`,i,{onUploadProgress:j=>{const $=Math.round(j.loaded*100/(j.total||1));w($)}})).data.secure_url;await h({eventId:Number(k),type:E,url:S}).unwrap(),C(""),P("image"),I(null),w(0),a(!1),_.fire("Success","Media uploaded successfully!","success")}catch(g){console.error(g),_.fire("Error","Failed to upload media.","error")}},U=async B=>{if((await _.fire({title:"Are you sure?",text:"This media will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#e53e3e",confirmButtonText:"Yes, delete it!"})).isConfirmed)try{await T(B).unwrap(),_.fire("Deleted!","Media has been deleted.","success")}catch(g){console.error(g),_.fire("Error","Failed to delete media.","error")}},F=B=>l.find(g=>g.eventId===B)?.title||`Event ${B}`,L=B=>{const i=new Date(B),g=i.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),S=i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});return`${g} @ ${S}`};return e.jsxs("div",{className:"min-h-screen p-6 bg-base-100 text-base-content",children:[e.jsxs("div",{className:"mb-6 text-xl sm:text-2xl font-semibold text-primary",children:["ðŸ‘‹ Hey ",y,", welcome!"]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary",children:"ðŸ“¸ All Media"}),e.jsxs("button",{onClick:()=>a(!0),className:"btn btn-success flex items-center gap-2",children:[e.jsx(ka,{size:18}),"Add Media"]})]}),s?e.jsx("p",{className:"text-info",children:"Loading media..."}):r?e.jsx("p",{className:"text-error",children:"âŒ Failed to load media."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:t?.map(B=>e.jsxs("div",{className:"bg-base-200 border border-base-300 rounded-xl shadow p-4",children:[B.type==="image"?e.jsx("img",{src:B.url,alt:B.altText||"Media",className:"w-full h-48 object-cover rounded"}):e.jsxs("video",{controls:!0,className:"w-full h-48 rounded",children:[e.jsx("source",{src:B.url,type:"video/mp4"}),"Your browser does not support the video tag."]}),e.jsxs("div",{className:"mt-3 text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-base-content",children:"ðŸ“½ï¸ Type:"})," ",e.jsx("span",{className:"capitalize text-warning",children:B.type})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-base-content",children:"ðŸŽŸï¸ Event:"})," ",e.jsx("span",{className:"text-info",children:F(B.eventId)})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold text-base-content",children:"â° Uploaded:"})," ",e.jsx("span",{className:"text-sm text-base-content/70",children:L(B.uploadedAt)})]})]}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsx("button",{className:"btn btn-warning btn-sm",title:"Edit (Not implemented)",children:e.jsx(_t,{size:16})}),e.jsx("button",{onClick:()=>U(B.mediaId),className:"btn btn-error btn-sm",title:"Delete",children:e.jsx(Bs,{size:16})})]})]},B.mediaId))}),o&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-base-200 border border-base-300 rounded-xl shadow-lg w-full max-w-lg p-6 relative",children:[e.jsx("button",{onClick:()=>a(!1),className:"absolute top-2 right-3 text-error hover:scale-110 transition",children:"âœ–"}),e.jsx("h3",{className:"text-xl font-semibold mb-4 text-primary",children:"Upload New Media"}),e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("select",{value:k,onChange:B=>C(B.target.value),className:"select select-bordered w-full",required:!0,children:[e.jsx("option",{value:"",children:"Select Event"}),l.map(B=>e.jsx("option",{value:B.eventId,children:B.title},B.eventId))]}),e.jsxs("select",{value:E,onChange:B=>P(B.target.value),className:"select select-bordered w-full",required:!0,children:[e.jsx("option",{value:"image",children:"Image"}),e.jsx("option",{value:"video",children:"Video"})]}),e.jsx("input",{type:"file",accept:E==="image"?"image/*":"video/*",onChange:B=>I(B.target.files?.[0]||null),className:"file-input file-input-bordered w-full",required:!0}),c>0&&e.jsxs("progress",{className:"progress progress-info w-full",value:c,max:100,children:[c,"%"]}),e.jsx("button",{type:"submit",disabled:d,className:"btn btn-primary w-full",children:d?"Uploading...":"Upload Media"})]})]})})]})},lt=he({reducerPath:"supportTicketApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/",prepareHeaders:(t,{getState:s})=>{const r=s().auth.token;return r&&t.set("Authorization",`${r}`),t.set("Content-Type","application/json"),t}}),refetchOnReconnect:!0,refetchOnMountOrArgChange:!0,tagTypes:["supportTickets","supportTicket"],endpoints:t=>({createSupportTicket:t.mutation({query:s=>({url:"tickets",method:"POST",body:s}),invalidatesTags:["supportTickets"]}),updateSupportTicket:t.mutation({query:({ticketId:s,...r})=>({url:`tickets/${s}`,method:"PUT",body:r}),invalidatesTags:["supportTickets"]}),getAllSupportTickets:t.query({query:()=>"tickets",providesTags:["supportTickets"]}),getSupportTicketById:t.query({query:s=>`tickets/${s}`,providesTags:["supportTicket"]}),getSupportTicketByIdDetails:t.query({query:s=>`tickets/${s}/details`,providesTags:["supportTicket"]}),getSupportTicketsByNationalId:t.query({query:s=>`tickets/user/${s}`,providesTags:["supportTickets"]}),deleteSupportTicket:t.mutation({query:s=>({url:`tickets/${s}`,method:"DELETE"}),invalidatesTags:["supportTickets"]})})}),{useCreateSupportTicketMutation:or,useUpdateSupportTicketMutation:Rs,useGetAllSupportTicketsQuery:cr,useGetSupportTicketByIdQuery:ci,useGetSupportTicketByIdDetailsQuery:di,useGetSupportTicketsByNationalIdQuery:dr,useDeleteSupportTicketMutation:ur}=lt,_e=he({reducerPath:"adminResponseApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/",prepareHeaders:(t,{getState:s})=>{const r=s().auth.token;return r&&t.set("Authorization",`Bearer ${r}`),t.set("Content-Type","application/json"),t}}),tagTypes:["AdminResponses","AdminResponse"],endpoints:t=>({getResponsesByTicket:t.query({query:s=>`responses/ticket/${s}`,providesTags:(s,r,l)=>[{type:"AdminResponses",id:l}]}),createAdminResponse:t.mutation({query:s=>({url:"responses",method:"POST",body:s}),invalidatesTags:(s,r,{ticketId:l})=>[{type:"AdminResponses",id:l}]}),updateAdminResponse:t.mutation({query:({responseId:s,body:r})=>({url:`responses/${s}`,method:"PUT",body:r}),invalidatesTags:["AdminResponses"]}),deleteAdminResponse:t.mutation({query:s=>({url:`responses/${s}`,method:"DELETE"}),invalidatesTags:["AdminResponses"]})})}),mr=({ticketId:t})=>{const{data:s=[],isLoading:r}=_e.useGetResponsesByTicketQuery(t);return r||s.length===0?null:e.jsxs("div",{className:"mt-4 bg-base-200 p-4 rounded-lg shadow-inner border border-base-300",children:[e.jsxs("h4",{className:"text-base font-semibold text-base-content mb-3 flex items-center gap-2",children:[e.jsx(Ta,{size:18,className:"opacity-70"}),"Admin Responses"]}),e.jsx("ul",{className:"space-y-3",children:s.map(l=>e.jsxs("li",{className:"bg-base-300 p-3 rounded-md text-sm border border-base-300 hover:bg-base-100 transition",children:[e.jsx("p",{className:"text-base-content leading-relaxed",children:l.message}),e.jsx("p",{className:"text-xs opacity-60 mt-2 italic",children:new Date(l.createdAt).toLocaleString()})]},l.responseId))})]})},xr={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10}},hr=()=>{const t=W(f=>f.auth.user?.nationalId),{data:s=[],refetch:r,isLoading:l}=dr(t),[h,{isLoading:d}]=or(),[T]=Rs(),[N]=ur(),[b,k]=x.useState({subject:"",description:"",priority:"Medium"}),[C,E]=x.useState(null),[P,v]=x.useState(!1),I=C!==null,[c,w]=x.useState(""),[o,a]=x.useState("All"),[y,R]=x.useState(1),U=5,F=()=>{k({subject:"",description:"",priority:"Medium"}),E(null),v(!1)},L=f=>{k(M=>({...M,[f.target.name]:f.target.value}))},B=async f=>{f.preventDefault();const M={...b,nationalId:t,...I&&{ticketId:C}};try{I?(await T(M).unwrap(),Ne.success("Ticket updated successfully!")):(await h(M).unwrap(),Ne.success("Ticket created successfully!")),F(),r()}catch{Ne.error("Failed to submit ticket")}},i=f=>{k({subject:f.subject,description:f.description,priority:f.priority}),E(f.ticketId),v(!0)},g=async f=>{if((await _.fire({title:"Delete this ticket?",text:"This action cannot be undone!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!",background:"#1f2937",color:"#fff"})).isConfirmed)try{await N(f).unwrap(),Ne.success("Ticket deleted successfully"),r()}catch{Ne.error("Failed to delete ticket")}},S=s.filter(f=>{const M=f.status?.toLowerCase(),q=o==="All"||o==="Pending"&&M==="open"||o==="Completed"&&["resolved","closed"].includes(M),Y=f.subject.toLowerCase().includes(c.toLowerCase())||f.description.toLowerCase().includes(c.toLowerCase());return q&&Y}),j=Math.ceil(S.length/U),$=S.slice((y-1)*U,y*U);return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-6 mt-15",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-base-content underline",children:"Support Tickets"}),e.jsx("button",{onClick:()=>v(!0),className:"btn btn-primary",children:"+ New Ticket"})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-6",children:[e.jsx("input",{type:"text",placeholder:"Search tickets...",className:"input input-bordered w-full md:max-w-xs",value:c,onChange:f=>{w(f.target.value),R(1)}}),e.jsxs("select",{className:"select select-bordered w-full md:max-w-xs",value:o,onChange:f=>{a(f.target.value),R(1)},children:[e.jsx("option",{value:"All",children:"All Tickets"}),e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Completed",children:"Completed"})]})]}),l?e.jsx("p",{className:"flex justify-center items-center min-h-screen",children:e.jsx(ge,{})}):S.length===0?e.jsx("p",{className:"text-base-content/60 text-center mt-8",children:"No matching tickets found."}):e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"space-y-6",children:e.jsx(At,{children:$.map(f=>{const M=f.status?.toLowerCase(),q=M==="open",Y=["open","closed","resolved"].includes(M);return e.jsx(ke.li,{variants:xr,initial:"hidden",animate:"visible",exit:"exit",layout:!0,transition:{duration:.3},className:"bg-base-100 border border-base-300 rounded-lg shadow p-4 text-base-content",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-lg font-semibold",children:f.subject}),e.jsx("p",{className:"mt-1",children:f.description}),e.jsxs("p",{className:"text-sm mt-2 opacity-70",children:[e.jsx("span",{className:"font-medium",children:"Priority:"})," ",f.priority," |"," ",e.jsx("span",{className:"font-medium",children:"Status:"})," ",f.status," |"," ",e.jsx("span",{className:"font-bold",children:"Created At:"})," ",f.createdAt?new Date(f.createdAt).toLocaleString():"N/A"]}),e.jsx(mr,{ticketId:f.ticketId})]}),e.jsxs("div",{className:"flex gap-2 pl-4",children:[e.jsx("button",{onClick:()=>q&&i(f),className:`btn btn-circle btn-ghost ${q?"text-warning":"text-base-300 cursor-not-allowed"}`,disabled:!q,title:q?"Edit Ticket":"Only open tickets can be edited",children:e.jsx(_t,{size:18})}),e.jsx("button",{onClick:()=>Y&&g(f.ticketId),className:`btn btn-circle btn-ghost ${Y?"text-error":"text-base-300 cursor-not-allowed"}`,disabled:!Y,title:"Delete Ticket",children:e.jsx(Bs,{size:18})})]})]})},f.ticketId)})})}),j>1&&e.jsx("div",{className:"flex justify-center mt-6 gap-2 flex-wrap",children:[...Array(j)].map((f,M)=>{const q=M+1;return e.jsx("button",{className:`btn btn-sm ${y===q?"btn-primary":"btn-outline"}`,onClick:()=>R(q),disabled:y===q,children:q},q)})})]}),e.jsx(At,{children:P&&e.jsx(ke.div,{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:e.jsxs(ke.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},transition:{type:"spring",stiffness:300,damping:25},className:"bg-base-100 text-base-content w-full max-w-xl p-6 rounded-xl shadow-xl relative border border-base-300",children:[e.jsx("button",{onClick:F,className:"absolute top-3 right-4 text-base-content hover:text-error text-2xl font-bold",children:"Ã—"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:I?"Edit Ticket":"New Support Ticket"}),e.jsxs("form",{onSubmit:B,children:[e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Subject"}),e.jsx("input",{name:"subject",value:b.subject,onChange:L,required:!0,className:"input input-bordered w-full mb-4",placeholder:"Enter subject"}),e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Description"}),e.jsx("textarea",{name:"description",value:b.description,onChange:L,rows:4,required:!0,className:"textarea textarea-bordered w-full mb-4",placeholder:"Describe your issue..."}),e.jsx("label",{className:"block mb-1 text-sm font-medium",children:"Priority"}),e.jsxs("select",{name:"priority",value:b.priority,onChange:L,className:"select select-bordered w-full mb-6",children:[e.jsx("option",{children:"Low"}),e.jsx("option",{children:"Medium"}),e.jsx("option",{children:"High"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"submit",disabled:d,className:"btn btn-primary",children:I?"Update":"Submit"}),e.jsx("button",{type:"button",onClick:F,className:"btn btn-ghost",children:"Cancel"})]})]})]})})})]})},pr={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:10}},us=["Open","In Progress","Resolved","Closed"],gr=["Low","Medium","High"],Ct=6,fr=t=>{switch(t){case"High":return"bg-red-500";case"Medium":return"bg-yellow-500";case"Low":return"bg-green-500";default:return"bg-gray-400"}},br=t=>{switch(t){case"Open":return"bg-red-500";case"In Progress":return"bg-yellow-500";case"Resolved":return"bg-green-500";case"Closed":return"bg-gray-500";default:return"bg-gray-300"}},yr=()=>{const{data:t=[],refetch:s,isLoading:r}=cr({}),[l]=Rs(),[h]=_e.useCreateAdminResponseMutation(),[d,T]=x.useState(null),[N,b]=x.useState("Open"),[k,C]=x.useState(null),[E,P]=x.useState(""),[v,I]=x.useState(null),[c,w]=x.useState(""),[o,a]=x.useState(""),[y,R]=x.useState(""),[U,F]=x.useState(1),L=W(p=>p.auth.user),{data:B=[],refetch:i,isFetching:g}=_e.useGetResponsesByTicketQuery(v??-1,{skip:v===null}),S=(p,O)=>{T(p),b(O)},j=async()=>{if(d)try{await l({ticketId:d,status:N}).unwrap(),Ne.success("Ticket status updated!"),T(null),s()}catch{Ne.error("Failed to update status.")}},$=p=>{C(p),document.getElementById("response_modal")?.showModal()},f=async()=>{if(!k||!E||!L?.nationalId){Ne.error("Missing required data.");return}try{await h({ticketId:k,nationalId:L.nationalId,message:E}).unwrap(),P(""),document.getElementById("response_modal")?.close(),await i(),_.fire({icon:"success",title:"Response Sent",text:"Your response has been submitted successfully.",confirmButtonColor:"#4ade80"})}catch{Ne.error("Failed to send response.")}},M=p=>t.filter(O=>O.status===p).length,q=x.useMemo(()=>t.filter(p=>{const O=p.subject.toLowerCase().includes(c.toLowerCase())||p.description.toLowerCase().includes(c.toLowerCase())||p.nationalId.toString().includes(c),te=!o||p.status===o,ce=!y||p.priority===y;return O&&te&&ce}),[t,c,o,y]),Y=x.useMemo(()=>{const p=(U-1)*Ct;return q.slice(p,p+Ct)},[q,U]),H=Math.ceil(q.length/Ct);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-10 p-6 bg-base-100 text-base-content transition-colors duration-300",children:[e.jsx("h1",{className:"text-4xl font-bold text-base-content mb-8",children:"Admin - Support Tickets"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 mb-10",children:[{label:"Total",count:t.length,color:"from-indigo-500 to-purple-500",icon:e.jsx(ks,{className:"w-5 h-5 inline-block mr-2"})},{label:"Resolved",count:M("Resolved"),color:"from-green-500 to-emerald-500",icon:e.jsx(Sa,{className:"w-5 h-5 inline-block mr-2"})},{label:"In Progress",count:M("In Progress"),color:"from-yellow-500 to-orange-500",icon:e.jsx(Ea,{className:"w-5 h-5 inline-block mr-2 animate-spin"})},{label:"Open",count:M("Open"),color:"from-rose-500 to-red-500",icon:e.jsx(Ca,{className:"w-5 h-5 inline-block mr-2"})}].map(({label:p,count:O,color:te,icon:ce},be)=>e.jsxs(ke.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:be*.1,duration:.5},className:`rounded-2xl shadow-lg text-white p-6 bg-gradient-to-br ${te} hover:scale-[1.03] transition-all duration-300`,children:[e.jsxs("div",{className:"text-sm uppercase tracking-wide font-medium flex items-center",children:[ce,p]}),e.jsx("div",{className:"text-3xl font-bold mt-2",children:O})]},p))}),e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ia,{className:"w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Search by subject, description, or NID",value:c,onChange:p=>w(p.target.value),className:"input input-bordered w-64"})]}),e.jsxs("select",{className:"select select-bordered",value:o,onChange:p=>a(p.target.value),children:[e.jsx("option",{value:"",children:"All Statuses"}),us.map(p=>e.jsx("option",{value:p,children:p},p))]}),e.jsxs("select",{className:"select select-bordered",value:y,onChange:p=>R(p.target.value),children:[e.jsx("option",{value:"",children:"All Priorities"}),gr.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),H>1&&e.jsx("div",{className:"mb-4 flex justify-center gap-2",children:Array.from({length:H}).map((p,O)=>e.jsx("button",{onClick:()=>F(O+1),className:`btn ${U===O+1?"btn-primary":"btn-ghost"}`,children:O+1},O))}),r?e.jsx("p",{className:"text-base-content/70",children:"Loading tickets..."}):Y.length===0?e.jsx("p",{className:"text-base-content/70",children:"No tickets found."}):e.jsx("div",{className:"flex flex-wrap gap-6",children:e.jsx(At,{children:Y.map(p=>e.jsx(ke.div,{variants:pr,initial:"hidden",animate:"visible",exit:"exit",layout:!0,transition:{duration:.3},className:"w-full md:w-[48%] lg:w-[32%] bg-base-200 border border-base-300 text-base-content hover:shadow-xl transition-all duration-300 rounded-xl p-6",children:e.jsxs("div",{className:"flex flex-col justify-between h-full",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:p.subject}),e.jsx("p",{className:"mt-1",children:p.description}),e.jsxs("div",{className:"text-sm mt-3 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Priority:"})," ",e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full text-xs font-semibold text-white ${fr(p.priority)}`,children:p.priority})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Status:"})," ",d===p.ticketId?e.jsx("select",{className:"mt-1 select select-bordered",value:N,onChange:O=>b(O.target.value),children:us.map(O=>e.jsx("option",{value:O,children:O},O))}):e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full text-xs font-semibold text-white ${br(p.status)}`,children:p.status})]})]}),e.jsxs("button",{onClick:()=>I(v===p.ticketId?null:p.ticketId),className:"text-sm mt-2 underline flex items-center gap-1",children:[v===p.ticketId?e.jsx(Aa,{size:14}):e.jsx(ps,{size:14}),v===p.ticketId?"Hide":"Show"," Responses"]}),v===p.ticketId&&e.jsx("div",{className:"mt-2 bg-base-300 p-2 rounded text-sm border border-base-200",children:g?e.jsx("p",{children:"Loading responses..."}):B.length>0?B.map(O=>e.jsxs("div",{className:"border-b border-base-200 py-1",children:[e.jsx("div",{className:"font-medium",children:O.message}),e.jsx("div",{className:"text-xs opacity-70",children:new Date(O.createdAt).toLocaleString()})]},O.responseId)):e.jsx("p",{children:"No responses yet."})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:d===p.ticketId?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:j,className:"btn btn-success",children:[e.jsx(Pa,{size:16})," Save"]}),e.jsxs("button",{onClick:()=>T(null),className:"btn",children:[e.jsx(as,{size:16})," Cancel"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>S(p.ticketId,p.status),className:"btn btn-primary",children:[e.jsx(_t,{size:16})," Change Status"]}),e.jsxs("button",{onClick:()=>$(p.ticketId),className:"btn btn-accent",children:[e.jsx(Ba,{size:16})," Respond"]})]})})]})},p.ticketId))})}),e.jsx("dialog",{id:"response_modal",className:"modal",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("h3",{className:"font-bold text-lg mb-4",children:"Respond to Support Ticket"}),e.jsx("textarea",{value:E,onChange:p=>P(p.target.value),placeholder:"Type your response here...",className:"textarea textarea-bordered w-full h-32"}),e.jsx("div",{className:"modal-action",children:e.jsxs("form",{method:"dialog",className:"flex gap-2",children:[e.jsxs("button",{className:"btn",type:"submit",children:[e.jsx(as,{size:16})," Cancel"]}),e.jsxs("button",{type:"button",onClick:f,className:"btn btn-primary",children:[e.jsx(Da,{size:16})," Send Response"]})]})})]})})]})};function vr(){return{id:-1,texcoordX:0,texcoordY:0,prevTexcoordX:0,prevTexcoordY:0,deltaX:0,deltaY:0,down:!1,moved:!1,color:{r:0,g:0,b:0}}}function jr({SIM_RESOLUTION:t=128,DYE_RESOLUTION:s=1440,CAPTURE_RESOLUTION:r=512,DENSITY_DISSIPATION:l=3.5,VELOCITY_DISSIPATION:h=2,PRESSURE:d=.1,PRESSURE_ITERATIONS:T=20,CURL:N=3,SPLAT_RADIUS:b=.2,SPLAT_FORCE:k=6e3,SHADING:C=!0,COLOR_UPDATE_SPEED:E=10,BACK_COLOR:P={r:.5,g:0,b:0},TRANSPARENT:v=!0}){const I=x.useRef(null);return x.useEffect(()=>{const c=I.current;if(!c)return;let w=[vr()],o={SIM_RESOLUTION:t,DYE_RESOLUTION:s,DENSITY_DISSIPATION:l,VELOCITY_DISSIPATION:h,PRESSURE:d,PRESSURE_ITERATIONS:T,CURL:N,SPLAT_RADIUS:b,SPLAT_FORCE:k,SHADING:C,COLOR_UPDATE_SPEED:E};const{gl:a,ext:y}=R(c);if(!a||!y)return;y.supportLinearFiltering||(o.DYE_RESOLUTION=256,o.SHADING=!1);function R(n){const m={alpha:!0,depth:!1,stencil:!1,antialias:!1,preserveDrawingBuffer:!1};let u=n.getContext("webgl2",m);if(u||(u=n.getContext("webgl",m)||n.getContext("experimental-webgl",m)),!u)throw new Error("Unable to initialize WebGL.");const A="drawBuffers"in u;let D=!1,z=null;A?(u.getExtension("EXT_color_buffer_float"),D=!!u.getExtension("OES_texture_float_linear")):(z=u.getExtension("OES_texture_half_float"),D=!!u.getExtension("OES_texture_half_float_linear")),u.clearColor(0,0,0,1);const Q=A?u.HALF_FLOAT:z&&z.HALF_FLOAT_OES||0;let ne,re,ye;return A?(ne=U(u,u.RGBA16F,u.RGBA,Q),re=U(u,u.RG16F,u.RG,Q),ye=U(u,u.R16F,u.RED,Q)):(ne=U(u,u.RGBA,u.RGBA,Q),re=U(u,u.RGBA,u.RGBA,Q),ye=U(u,u.RGBA,u.RGBA,Q)),{gl:u,ext:{formatRGBA:ne,formatRG:re,formatR:ye,halfFloatTexType:Q,supportLinearFiltering:D}}}function U(n,m,u,A){if(!F(n,m,u,A)){if("drawBuffers"in n){const D=n;switch(m){case D.R16F:return U(D,D.RG16F,D.RG,A);case D.RG16F:return U(D,D.RGBA16F,D.RGBA,A);default:return null}}return null}return{internalFormat:m,format:u}}function F(n,m,u,A){const D=n.createTexture();if(!D)return!1;n.bindTexture(n.TEXTURE_2D,D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,m,4,4,0,u,A,null);const z=n.createFramebuffer();return z?(n.bindFramebuffer(n.FRAMEBUFFER,z),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,D,0),n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE):!1}function L(n){if(!n.length)return 0;let m=0;for(let u=0;u<n.length;u++)m=(m<<5)-m+n.charCodeAt(u),m|=0;return m}function B(n,m){if(!m)return n;let u="";for(const A of m)u+=`#define ${A}
`;return u+n}function i(n,m,u=null){const A=B(m,u),D=a.createShader(n);return D?(a.shaderSource(D,A),a.compileShader(D),a.getShaderParameter(D,a.COMPILE_STATUS)||console.trace(a.getShaderInfoLog(D)),D):null}function g(n,m){if(!n||!m)return null;const u=a.createProgram();return u?(a.attachShader(u,n),a.attachShader(u,m),a.linkProgram(u),a.getProgramParameter(u,a.LINK_STATUS)||console.trace(a.getProgramInfoLog(u)),u):null}function S(n){let m={};const u=a.getProgramParameter(n,a.ACTIVE_UNIFORMS);for(let A=0;A<u;A++){const D=a.getActiveUniform(n,A);D&&(m[D.name]=a.getUniformLocation(n,D.name))}return m}class j{program;uniforms;constructor(m,u){this.program=g(m,u),this.uniforms=this.program?S(this.program):{}}bind(){this.program&&a.useProgram(this.program)}}class ${vertexShader;fragmentShaderSource;programs;activeProgram;uniforms;constructor(m,u){this.vertexShader=m,this.fragmentShaderSource=u,this.programs={},this.activeProgram=null,this.uniforms={}}setKeywords(m){let u=0;for(const D of m)u+=L(D);let A=this.programs[u];if(A==null){const D=i(a.FRAGMENT_SHADER,this.fragmentShaderSource,m);A=g(this.vertexShader,D),this.programs[u]=A}A!==this.activeProgram&&(A&&(this.uniforms=S(A)),this.activeProgram=A)}bind(){this.activeProgram&&a.useProgram(this.activeProgram)}}const f=i(a.VERTEX_SHADER,`
      precision highp float;
      attribute vec2 aPosition;
      varying vec2 vUv;
      varying vec2 vL;
      varying vec2 vR;
      varying vec2 vT;
      varying vec2 vB;
      uniform vec2 texelSize;

      void main () {
        vUv = aPosition * 0.5 + 0.5;
        vL = vUv - vec2(texelSize.x, 0.0);
        vR = vUv + vec2(texelSize.x, 0.0);
        vT = vUv + vec2(0.0, texelSize.y);
        vB = vUv - vec2(0.0, texelSize.y);
        gl_Position = vec4(aPosition, 0.0, 1.0);
      }
    `),M=i(a.FRAGMENT_SHADER,`
      precision mediump float;
      precision mediump sampler2D;
      varying highp vec2 vUv;
      uniform sampler2D uTexture;

      void main () {
          gl_FragColor = texture2D(uTexture, vUv);
      }
    `),q=i(a.FRAGMENT_SHADER,`
      precision mediump float;
      precision mediump sampler2D;
      varying highp vec2 vUv;
      uniform sampler2D uTexture;
      uniform float value;

      void main () {
          gl_FragColor = value * texture2D(uTexture, vUv);
      }
    `),Y=`
      precision highp float;
      precision highp sampler2D;
      varying vec2 vUv;
      varying vec2 vL;
      varying vec2 vR;
      varying vec2 vT;
      varying vec2 vB;
      uniform sampler2D uTexture;
      uniform sampler2D uDithering;
      uniform vec2 ditherScale;
      uniform vec2 texelSize;

      vec3 linearToGamma (vec3 color) {
          color = max(color, vec3(0));
          return max(1.055 * pow(color, vec3(0.416666667)) - 0.055, vec3(0));
      }

      void main () {
          vec3 c = texture2D(uTexture, vUv).rgb;
          #ifdef SHADING
              vec3 lc = texture2D(uTexture, vL).rgb;
              vec3 rc = texture2D(uTexture, vR).rgb;
              vec3 tc = texture2D(uTexture, vT).rgb;
              vec3 bc = texture2D(uTexture, vB).rgb;

              float dx = length(rc) - length(lc);
              float dy = length(tc) - length(bc);

              vec3 n = normalize(vec3(dx, dy, length(texelSize)));
              vec3 l = vec3(0.0, 0.0, 1.0);

              float diffuse = clamp(dot(n, l) + 0.7, 0.7, 1.0);
              c *= diffuse;
          #endif

          float a = max(c.r, max(c.g, c.b));
          gl_FragColor = vec4(c, a);
      }
    `,H=i(a.FRAGMENT_SHADER,`
      precision highp float;
      precision highp sampler2D;
      varying vec2 vUv;
      uniform sampler2D uTarget;
      uniform float aspectRatio;
      uniform vec3 color;
      uniform vec2 point;
      uniform float radius;

      void main () {
          vec2 p = vUv - point.xy;
          p.x *= aspectRatio;
          vec3 splat = exp(-dot(p, p) / radius) * color;
          vec3 base = texture2D(uTarget, vUv).xyz;
          gl_FragColor = vec4(base + splat, 1.0);
      }
    `),p=i(a.FRAGMENT_SHADER,`
      precision highp float;
      precision highp sampler2D;
      varying vec2 vUv;
      uniform sampler2D uVelocity;
      uniform sampler2D uSource;
      uniform vec2 texelSize;
      uniform vec2 dyeTexelSize;
      uniform float dt;
      uniform float dissipation;

      vec4 bilerp (sampler2D sam, vec2 uv, vec2 tsize) {
          vec2 st = uv / tsize - 0.5;
          vec2 iuv = floor(st);
          vec2 fuv = fract(st);

          vec4 a = texture2D(sam, (iuv + vec2(0.5, 0.5)) * tsize);
          vec4 b = texture2D(sam, (iuv + vec2(1.5, 0.5)) * tsize);
          vec4 c = texture2D(sam, (iuv + vec2(0.5, 1.5)) * tsize);
          vec4 d = texture2D(sam, (iuv + vec2(1.5, 1.5)) * tsize);

          return mix(mix(a, b, fuv.x), mix(c, d, fuv.x), fuv.y);
      }

      void main () {
          #ifdef MANUAL_FILTERING
              vec2 coord = vUv - dt * bilerp(uVelocity, vUv, texelSize).xy * texelSize;
              vec4 result = bilerp(uSource, coord, dyeTexelSize);
          #else
              vec2 coord = vUv - dt * texture2D(uVelocity, vUv).xy * texelSize;
              vec4 result = texture2D(uSource, coord);
          #endif
          float decay = 1.0 + dissipation * dt;
          gl_FragColor = result / decay;
      }
    `,y.supportLinearFiltering?null:["MANUAL_FILTERING"]),O=i(a.FRAGMENT_SHADER,`
      precision mediump float;
      precision mediump sampler2D;
      varying highp vec2 vUv;
      varying highp vec2 vL;
      varying highp vec2 vR;
      varying highp vec2 vT;
      varying highp vec2 vB;
      uniform sampler2D uVelocity;

      void main () {
          float L = texture2D(uVelocity, vL).x;
          float R = texture2D(uVelocity, vR).x;
          float T = texture2D(uVelocity, vT).y;
          float B = texture2D(uVelocity, vB).y;

          vec2 C = texture2D(uVelocity, vUv).xy;
          if (vL.x < 0.0) { L = -C.x; }
          if (vR.x > 1.0) { R = -C.x; }
          if (vT.y > 1.0) { T = -C.y; }
          if (vB.y < 0.0) { B = -C.y; }

          float div = 0.5 * (R - L + T - B);
          gl_FragColor = vec4(div, 0.0, 0.0, 1.0);
      }
    `),te=i(a.FRAGMENT_SHADER,`
      precision mediump float;
      precision mediump sampler2D;
      varying highp vec2 vUv;
      varying highp vec2 vL;
      varying highp vec2 vR;
      varying highp vec2 vT;
      varying highp vec2 vB;
      uniform sampler2D uVelocity;

      void main () {
          float L = texture2D(uVelocity, vL).y;
          float R = texture2D(uVelocity, vR).y;
          float T = texture2D(uVelocity, vT).x;
          float B = texture2D(uVelocity, vB).x;
          float vorticity = R - L - T + B;
          gl_FragColor = vec4(0.5 * vorticity, 0.0, 0.0, 1.0);
      }
    `),ce=i(a.FRAGMENT_SHADER,`
      precision highp float;
      precision highp sampler2D;
      varying vec2 vUv;
      varying vec2 vL;
      varying vec2 vR;
      varying vec2 vT;
      varying vec2 vB;
      uniform sampler2D uVelocity;
      uniform sampler2D uCurl;
      uniform float curl;
      uniform float dt;

      void main () {
          float L = texture2D(uCurl, vL).x;
          float R = texture2D(uCurl, vR).x;
          float T = texture2D(uCurl, vT).x;
          float B = texture2D(uCurl, vB).x;
          float C = texture2D(uCurl, vUv).x;

          vec2 force = 0.5 * vec2(abs(T) - abs(B), abs(R) - abs(L));
          force /= length(force) + 0.0001;
          force *= curl * C;
          force.y *= -1.0;

          vec2 velocity = texture2D(uVelocity, vUv).xy;
          velocity += force * dt;
          velocity = min(max(velocity, -1000.0), 1000.0);
          gl_FragColor = vec4(velocity, 0.0, 1.0);
      }
    `),be=i(a.FRAGMENT_SHADER,`
      precision mediump float;
      precision mediump sampler2D;
      varying highp vec2 vUv;
      varying highp vec2 vL;
      varying highp vec2 vR;
      varying highp vec2 vT;
      varying highp vec2 vB;
      uniform sampler2D uPressure;
      uniform sampler2D uDivergence;

      void main () {
          float L = texture2D(uPressure, vL).x;
          float R = texture2D(uPressure, vR).x;
          float T = texture2D(uPressure, vT).x;
          float B = texture2D(uPressure, vB).x;
          float C = texture2D(uPressure, vUv).x;
          float divergence = texture2D(uDivergence, vUv).x;
          float pressure = (L + R + B + T - divergence) * 0.25;
          gl_FragColor = vec4(pressure, 0.0, 0.0, 1.0);
      }
    `),ze=i(a.FRAGMENT_SHADER,`
      precision mediump float;
      precision mediump sampler2D;
      varying highp vec2 vUv;
      varying highp vec2 vL;
      varying highp vec2 vR;
      varying highp vec2 vT;
      varying highp vec2 vB;
      uniform sampler2D uPressure;
      uniform sampler2D uVelocity;

      void main () {
          float L = texture2D(uPressure, vL).x;
          float R = texture2D(uPressure, vR).x;
          float T = texture2D(uPressure, vT).x;
          float B = texture2D(uPressure, vB).x;
          vec2 velocity = texture2D(uVelocity, vUv).xy;
          velocity.xy -= vec2(R - L, T - B);
          gl_FragColor = vec4(velocity, 0.0, 1.0);
      }
    `),ee=(()=>{const n=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,n),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),a.STATIC_DRAW);const m=a.createBuffer();return a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,m),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,0,2,3]),a.STATIC_DRAW),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.enableVertexAttribArray(0),(u,A=!1)=>{a&&(u?(a.viewport(0,0,u.width,u.height),a.bindFramebuffer(a.FRAMEBUFFER,u.fbo)):(a.viewport(0,0,a.drawingBufferWidth,a.drawingBufferHeight),a.bindFramebuffer(a.FRAMEBUFFER,null)),A&&(a.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT)),a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0))}})();let ie,V,ht,pt,Se;const gt=new j(f,M),Oe=new j(f,q),se=new j(f,H),J=new j(f,p),Ge=new j(f,O),Ve=new j(f,te),de=new j(f,ce),Pe=new j(f,be),Be=new j(f,ze),Ue=new $(f,Y);function Le(n,m,u,A,D,z){a.activeTexture(a.TEXTURE0);const Q=a.createTexture();a.bindTexture(a.TEXTURE_2D,Q),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,z),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,z),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,u,n,m,0,A,D,null);const ne=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,ne),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,Q,0),a.viewport(0,0,n,m),a.clear(a.COLOR_BUFFER_BIT);const re=1/n,ye=1/m;return{texture:Q,fbo:ne,width:n,height:m,texelSizeX:re,texelSizeY:ye,attach(Me){return a.activeTexture(a.TEXTURE0+Me),a.bindTexture(a.TEXTURE_2D,Q),Me}}}function ft(n,m,u,A,D,z){const Q=Le(n,m,u,A,D,z),ne=Le(n,m,u,A,D,z);return{width:n,height:m,texelSizeX:Q.texelSizeX,texelSizeY:Q.texelSizeY,read:Q,write:ne,swap(){const re=this.read;this.read=this.write,this.write=re}}}function Ls(n,m,u,A,D,z,Q){const ne=Le(m,u,A,D,z,Q);return gt.bind(),gt.uniforms.uTexture&&a.uniform1i(gt.uniforms.uTexture,n.attach(0)),ee(ne,!1),ne}function Gt(n,m,u,A,D,z,Q){return n.width===m&&n.height===u||(n.read=Ls(n.read,m,u,A,D,z,Q),n.write=Le(m,u,A,D,z,Q),n.width=m,n.height=u,n.texelSizeX=1/m,n.texelSizeY=1/u),n}function Vt(){const n=Qt(o.SIM_RESOLUTION),m=Qt(o.DYE_RESOLUTION),u=y.halfFloatTexType,A=y.formatRGBA,D=y.formatRG,z=y.formatR,Q=y.supportLinearFiltering?a.LINEAR:a.NEAREST;a.disable(a.BLEND),ie?ie=Gt(ie,m.width,m.height,A.internalFormat,A.format,u,Q):ie=ft(m.width,m.height,A.internalFormat,A.format,u,Q),V?V=Gt(V,n.width,n.height,D.internalFormat,D.format,u,Q):V=ft(n.width,n.height,D.internalFormat,D.format,u,Q),ht=Le(n.width,n.height,z.internalFormat,z.format,u,a.NEAREST),pt=Le(n.width,n.height,z.internalFormat,z.format,u,a.NEAREST),Se=ft(n.width,n.height,z.internalFormat,z.format,u,a.NEAREST)}function Ms(){const n=[];o.SHADING&&n.push("SHADING"),Ue.setKeywords(n)}function Qt(n){const m=a.drawingBufferWidth,u=a.drawingBufferHeight,A=m/u;let D=A<1?1/A:A;const z=Math.round(n),Q=Math.round(n*D);return m>u?{width:Q,height:z}:{width:z,height:Q}}function ae(n){const m=window.devicePixelRatio||1;return Math.floor(n*m)}Ms(),Vt();let Yt=Date.now(),We=0;function bt(){const n=qs();$s()&&Vt(),_s(n),zs(),Os(n),Gs(null),requestAnimationFrame(bt)}function qs(){const n=Date.now();let m=(n-Yt)/1e3;return m=Math.min(m,.016666),Yt=n,m}function $s(){const n=ae(c.clientWidth),m=ae(c.clientHeight);return c.width!==n||c.height!==m?(c.width=n,c.height=m,!0):!1}function _s(n){We+=n*o.COLOR_UPDATE_SPEED,We>=1&&(We=Zs(We,0,1),w.forEach(m=>{m.color=Je()}))}function zs(){for(const n of w)n.moved&&(n.moved=!1,Qs(n))}function Os(n){a.disable(a.BLEND),Ve.bind(),Ve.uniforms.texelSize&&a.uniform2f(Ve.uniforms.texelSize,V.texelSizeX,V.texelSizeY),Ve.uniforms.uVelocity&&a.uniform1i(Ve.uniforms.uVelocity,V.read.attach(0)),ee(pt),de.bind(),de.uniforms.texelSize&&a.uniform2f(de.uniforms.texelSize,V.texelSizeX,V.texelSizeY),de.uniforms.uVelocity&&a.uniform1i(de.uniforms.uVelocity,V.read.attach(0)),de.uniforms.uCurl&&a.uniform1i(de.uniforms.uCurl,pt.attach(1)),de.uniforms.curl&&a.uniform1f(de.uniforms.curl,o.CURL),de.uniforms.dt&&a.uniform1f(de.uniforms.dt,n),ee(V.write),V.swap(),Ge.bind(),Ge.uniforms.texelSize&&a.uniform2f(Ge.uniforms.texelSize,V.texelSizeX,V.texelSizeY),Ge.uniforms.uVelocity&&a.uniform1i(Ge.uniforms.uVelocity,V.read.attach(0)),ee(ht),Oe.bind(),Oe.uniforms.uTexture&&a.uniform1i(Oe.uniforms.uTexture,Se.read.attach(0)),Oe.uniforms.value&&a.uniform1f(Oe.uniforms.value,o.PRESSURE),ee(Se.write),Se.swap(),Pe.bind(),Pe.uniforms.texelSize&&a.uniform2f(Pe.uniforms.texelSize,V.texelSizeX,V.texelSizeY),Pe.uniforms.uDivergence&&a.uniform1i(Pe.uniforms.uDivergence,ht.attach(0));for(let u=0;u<o.PRESSURE_ITERATIONS;u++)Pe.uniforms.uPressure&&a.uniform1i(Pe.uniforms.uPressure,Se.read.attach(1)),ee(Se.write),Se.swap();Be.bind(),Be.uniforms.texelSize&&a.uniform2f(Be.uniforms.texelSize,V.texelSizeX,V.texelSizeY),Be.uniforms.uPressure&&a.uniform1i(Be.uniforms.uPressure,Se.read.attach(0)),Be.uniforms.uVelocity&&a.uniform1i(Be.uniforms.uVelocity,V.read.attach(1)),ee(V.write),V.swap(),J.bind(),J.uniforms.texelSize&&a.uniform2f(J.uniforms.texelSize,V.texelSizeX,V.texelSizeY),!y.supportLinearFiltering&&J.uniforms.dyeTexelSize&&a.uniform2f(J.uniforms.dyeTexelSize,V.texelSizeX,V.texelSizeY);const m=V.read.attach(0);J.uniforms.uVelocity&&a.uniform1i(J.uniforms.uVelocity,m),J.uniforms.uSource&&a.uniform1i(J.uniforms.uSource,m),J.uniforms.dt&&a.uniform1f(J.uniforms.dt,n),J.uniforms.dissipation&&a.uniform1f(J.uniforms.dissipation,o.VELOCITY_DISSIPATION),ee(V.write),V.swap(),!y.supportLinearFiltering&&J.uniforms.dyeTexelSize&&a.uniform2f(J.uniforms.dyeTexelSize,ie.texelSizeX,ie.texelSizeY),J.uniforms.uVelocity&&a.uniform1i(J.uniforms.uVelocity,V.read.attach(0)),J.uniforms.uSource&&a.uniform1i(J.uniforms.uSource,ie.read.attach(1)),J.uniforms.dissipation&&a.uniform1f(J.uniforms.dissipation,o.DENSITY_DISSIPATION),ee(ie.write),ie.swap()}function Gs(n){a.blendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.enable(a.BLEND),Vs(n)}function Vs(n){const m=a.drawingBufferWidth,u=a.drawingBufferHeight;Ue.bind(),o.SHADING&&Ue.uniforms.texelSize&&a.uniform2f(Ue.uniforms.texelSize,1/m,1/u),Ue.uniforms.uTexture&&a.uniform1i(Ue.uniforms.uTexture,ie.read.attach(0)),ee(n,!1)}function Qs(n){const m=n.deltaX*o.SPLAT_FORCE,u=n.deltaY*o.SPLAT_FORCE;Ht(n.texcoordX,n.texcoordY,m,u,n.color)}function Ys(n){const m=Je();m.r*=10,m.g*=10,m.b*=10;const u=10*(Math.random()-.5),A=30*(Math.random()-.5);Ht(n.texcoordX,n.texcoordY,u,A,m)}function Ht(n,m,u,A,D){se.bind(),se.uniforms.uTarget&&a.uniform1i(se.uniforms.uTarget,V.read.attach(0)),se.uniforms.aspectRatio&&a.uniform1f(se.uniforms.aspectRatio,c.width/c.height),se.uniforms.point&&a.uniform2f(se.uniforms.point,n,m),se.uniforms.color&&a.uniform3f(se.uniforms.color,u,A,0),se.uniforms.radius&&a.uniform1f(se.uniforms.radius,Hs(o.SPLAT_RADIUS/100)),ee(V.write),V.swap(),se.uniforms.uTarget&&a.uniform1i(se.uniforms.uTarget,ie.read.attach(0)),se.uniforms.color&&a.uniform3f(se.uniforms.color,D.r,D.g,D.b),ee(ie.write),ie.swap()}function Hs(n){const m=c.width/c.height;return m>1&&(n*=m),n}function yt(n,m,u,A){n.id=m,n.down=!0,n.moved=!1,n.texcoordX=u/c.width,n.texcoordY=1-A/c.height,n.prevTexcoordX=n.texcoordX,n.prevTexcoordY=n.texcoordY,n.deltaX=0,n.deltaY=0,n.color=Je()}function vt(n,m,u,A){n.prevTexcoordX=n.texcoordX,n.prevTexcoordY=n.texcoordY,n.texcoordX=m/c.width,n.texcoordY=1-u/c.height,n.deltaX=Ks(n.texcoordX-n.prevTexcoordX),n.deltaY=Ws(n.texcoordY-n.prevTexcoordY),n.moved=Math.abs(n.deltaX)>0||Math.abs(n.deltaY)>0,n.color=A}function Xs(n){n.down=!1}function Ks(n){const m=c.width/c.height;return m<1&&(n*=m),n}function Ws(n){const m=c.width/c.height;return m>1&&(n/=m),n}function Je(){const n=Js(Math.random(),1,1);return n.r*=.15,n.g*=.15,n.b*=.15,n}function Js(n,m,u){let A=0,D=0,z=0;const Q=Math.floor(n*6),ne=n*6-Q,re=u*(1-m),ye=u*(1-ne*m),Me=u*(1-(1-ne)*m);switch(Q%6){case 0:A=u,D=Me,z=re;break;case 1:A=ye,D=u,z=re;break;case 2:A=re,D=u,z=Me;break;case 3:A=re,D=ye,z=u;break;case 4:A=Me,D=re,z=u;break;case 5:A=u,D=re,z=ye;break}return{r:A,g:D,b:z}}function Zs(n,m,u){const A=u-m;return(n-m)%A+m}window.addEventListener("mousedown",n=>{const m=w[0],u=ae(n.clientX),A=ae(n.clientY);yt(m,-1,u,A),Ys(m)});function Xt(n){const m=w[0],u=ae(n.clientX),A=ae(n.clientY),D=Je();bt(),vt(m,u,A,D),document.body.removeEventListener("mousemove",Xt)}document.body.addEventListener("mousemove",Xt),window.addEventListener("mousemove",n=>{const m=w[0],u=ae(n.clientX),A=ae(n.clientY),D=m.color;vt(m,u,A,D)});function Kt(n){const m=n.targetTouches,u=w[0];for(let A=0;A<m.length;A++){const D=ae(m[A].clientX),z=ae(m[A].clientY);bt(),yt(u,m[A].identifier,D,z)}document.body.removeEventListener("touchstart",Kt)}document.body.addEventListener("touchstart",Kt),window.addEventListener("touchstart",n=>{const m=n.targetTouches,u=w[0];for(let A=0;A<m.length;A++){const D=ae(m[A].clientX),z=ae(m[A].clientY);yt(u,m[A].identifier,D,z)}},!1),window.addEventListener("touchmove",n=>{const m=n.targetTouches,u=w[0];for(let A=0;A<m.length;A++){const D=ae(m[A].clientX),z=ae(m[A].clientY);vt(u,D,z,u.color)}},!1),window.addEventListener("touchend",n=>{const m=n.changedTouches,u=w[0];for(let A=0;A<m.length;A++)Xs(u)})},[t,s,r,l,h,d,T,N,b,k,C,E,P,v]),e.jsx("div",{className:"fixed top-0 left-0 z-50 pointer-events-none w-full h-full",children:e.jsx("canvas",{ref:I,id:"fluid",className:"w-screen h-screen block"})})}const Nr="service_36rahuf",wr="template_t7k2dxh",kr="mSrGC2dXclojT6ci1",Tr=()=>{const t=x.useRef(null),s=async r=>{r.preventDefault(),t.current&&le.promise(Ua.sendForm(Nr,wr,t.current,kr),{loading:"Sending your message...",success:()=>(t.current?.reset(),"âœ… Message sent successfully!"),error:"âŒ Failed to send. Try again."}).catch(l=>{console.error("EmailJS error:",l),le.error("Unexpected error occurred.")})};return e.jsxs(e.Fragment,{children:[e.jsx(jr,{}),e.jsx(fe,{}),e.jsxs("section",{className:"min-h-screen flex items-center justify-center bg-base-100 text-base-content px-4 py-16",children:[e.jsx(qt,{position:"top-right"}),e.jsxs("div",{className:"w-full max-w-6xl rounded-2xl shadow-xl border border-base-300 p-6 md:p-10 grid grid-cols-1 md:grid-cols-2 gap-10 bg-base-100",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-4",children:"ðŸŽ« Manage Support Like a Pro"}),e.jsxs("p",{className:"mb-3 leading-relaxed",children:["Our ",e.jsx("span",{className:"font-semibold",children:"Ticket Stream Management System"})," helps you track, manage, and resolve issues in real time."]}),e.jsx("p",{className:"mb-6",children:"Boost productivity. Improve response time. Keep customers happy."}),e.jsx("img",{src:"https://images.unsplash.com/photo-1603791440384-56cd371ee9a7?auto=format&fit=crop&w=800&q=80",alt:"Product",className:"rounded-xl mb-6 shadow-md"}),e.jsxs("div",{className:"flex gap-4 text-xl",children:[e.jsx(et,{href:"https://instagram.com",children:e.jsx(xs,{})}),e.jsx(et,{href:"https://twitter.com",children:e.jsx(ms,{})}),e.jsx(et,{href:"https://linkedin.com",children:e.jsx(Fa,{})}),e.jsx(et,{href:"https://github.com",children:e.jsx(Ra,{})})]})]}),e.jsxs("form",{ref:t,onSubmit:s,className:"flex flex-col gap-4",children:[e.jsx("h3",{className:"text-2xl font-bold mb-2",children:"Contact Us"}),e.jsx("input",{name:"from_name",type:"text",placeholder:"Your Name",className:"input input-bordered w-full",required:!0}),e.jsx("input",{name:"from_email",type:"email",placeholder:"Your Email",className:"input input-bordered w-full",required:!0}),e.jsx("textarea",{name:"message",placeholder:"Your Message",className:"textarea textarea-bordered w-full h-32",required:!0}),e.jsx("button",{type:"submit",className:"btn btn-primary w-full",children:"ðŸ“© Send Message"})]})]})]})]})},et=({href:t,children:s})=>e.jsx("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary transition-colors",children:s}),Sr=()=>{const t=W(o=>o.auth.user?.nationalId),s=W(o=>o.auth.user?.firstName),{data:r,isLoading:l,isError:h,error:d}=Ae.useGetPaymentsByNationalIdQuery(t,{skip:!t}),[T,N]=kt.useState(1),[b,k]=kt.useState("All"),C=10,P=[...r?r.filter(o=>b==="All"?!0:b==="Completed"?o.paymentStatus==="Completed":b==="Pending"?o.paymentStatus==="Pending":!1):[]].sort((o,a)=>new Date(a.paymentDate).getTime()-new Date(o.paymentDate).getTime()),v=T*C,I=v-C,c=P.slice(I,v),w=Math.ceil(P.length/C);return kt.useEffect(()=>{N(1)},[b]),e.jsx(ke.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"min-h-screen mt-20 px-4",children:e.jsx("div",{className:"max-w-6xl mx-auto bg-gradient-to-r from-indigo-500 via-purple-500 to-blue-500 p-1 rounded-2xl shadow-xl mb-20",children:e.jsxs("div",{className:"rounded-2xl bg-base-100 p-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-primary mb-2 text-center",children:["ðŸ‘‹ Hey ",s||"there",", welcome back!"]}),e.jsx("h2",{className:"text-3xl font-bold mb-4 text-primary text-center",children:"ðŸ’³ My Payments"}),e.jsx("div",{className:"flex justify-center mb-6",children:e.jsxs("select",{className:"select select-bordered max-w-xs",value:b,onChange:o=>k(o.target.value),children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"Completed",children:"Completed"}),e.jsx("option",{value:"Pending",children:"Pending"})]})}),l&&e.jsx("p",{className:"text-center text-base-content",children:"Loading your payments..."}),h&&e.jsxs("p",{className:"text-center text-error",children:["Error: ",d?.data?.error||"Something went wrong."]}),r&&P.length>0?e.jsxs("div",{className:"overflow-x-auto animate-fadeIn",children:[e.jsxs("table",{className:"min-w-full text-sm text-left text-base-content border-separate border-spacing-y-2",children:[e.jsx("thead",{className:"text-xs uppercase bg-base-200 text-primary font-semibold",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-2",children:"Transaction ID"}),e.jsx("th",{className:"px-4 py-2",children:"Booking ID"}),e.jsx("th",{className:"px-4 py-2",children:"Amount"}),e.jsx("th",{className:"px-4 py-2",children:"Status"}),e.jsx("th",{className:"px-4 py-2",children:"Method"}),e.jsx("th",{className:"px-4 py-2",children:"Date"})]})}),e.jsx("tbody",{children:c.map(o=>e.jsxs(ke.tr,{whileHover:{scale:1.01},transition:{type:"spring",stiffness:300},className:"bg-base-100 hover:bg-base-200 transition duration-200 shadow rounded-xl",children:[e.jsx("td",{className:"px-4 py-3 rounded-l-xl",children:o.transactionId||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:o.bookingId}),e.jsxs("td",{className:"px-4 py-3",children:["KSH ",(o.amount/100).toFixed(2)]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${o.paymentStatus==="PAID"?"bg-green-100 text-green-800":o.paymentStatus==="FAILED"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:o.paymentStatus})}),e.jsx("td",{className:"px-4 py-3",children:o.paymentMethod||"N/A"}),e.jsx("td",{className:"px-4 py-3 rounded-r-xl",children:new Date(o.paymentDate).toLocaleString()})]},o.paymentId))})]}),w>1&&e.jsxs("div",{className:"flex justify-center mt-4 gap-2",children:[e.jsx("button",{className:"btn btn-sm",onClick:()=>N(o=>Math.max(o-1,1)),disabled:T===1,children:"Prev"}),Array.from({length:w},(o,a)=>e.jsx("button",{onClick:()=>N(a+1),className:`btn btn-sm ${T===a+1?"btn-active":""}`,children:a+1},a+1)),e.jsx("button",{className:"btn btn-sm",onClick:()=>N(o=>Math.min(o+1,w)),disabled:T===w,children:"Next"})]})]}):!l&&e.jsx("p",{className:"text-center text-slate-500 mt-4",children:"No payments found for selected status."})]})})})},Er=()=>{const{data:t=[],isLoading:s}=Ae.useGetAllPaymentsQuery({}),{data:r=[]}=ue.useGetAllBookingsQuery(),{data:l=[]}=Z.useGetAllEventsQuery({}),{data:h=[]}=Te.useGetAllTicketTypesQuery({}),[d,T]=x.useState(""),[N,b]=x.useState(""),[k,C]=x.useState(""),[E,P]=x.useState(""),[v,I]=x.useState(1),c=5,w=x.useMemo(()=>t.map(f=>{const M=r.find(H=>H.bookingId===f.bookingId),q=l.find(H=>M?.eventId===H.eventId),Y=h.find(H=>M?.ticketTypeId===H.ticketTypeId);return{...f,eventName:q?.title??"N/A",ticketTypeName:Y?.name??"N/A"}}),[t,r,l,h]),o=x.useMemo(()=>w.filter(M=>{const q=new Date(M.paymentDate);return!(d&&M.paymentStatus!==d||N&&M.paymentMethod!==N||k&&q<new Date(k)||E&&q>new Date(E))}).sort((M,q)=>new Date(q.paymentDate).getTime()-new Date(M.paymentDate).getTime()),[w,d,N,k,E]),a=Math.ceil(o.length/c),y=x.useMemo(()=>{const f=(v-1)*c;return o.slice(f,f+c)},[o,v]),R=f=>o.filter(M=>f(new Date(M.paymentDate))).reduce((M,q)=>M+Number(q.amount),0)/100,U=new Date,F=new Date(U.getFullYear(),U.getMonth(),U.getDate()),L=new Date(F);L.setDate(F.getDate()-F.getDay());const B=new Date(U.getFullYear(),U.getMonth(),1),i=o.reduce((f,M)=>f+Number(M.amount),0)/100,g=R(f=>f>=F),S=R(f=>f>=L),j=R(f=>f>=B),$=()=>{const f=["Txn ID","Booking ID","Event","Ticket Type","Amount (KES)","Status","Method","Date"],M=o.map(H=>[H.transactionId,H.bookingId,H.eventName,H.ticketTypeName,(H.amount/100).toFixed(2),H.paymentStatus,H.paymentMethod,new Date(H.paymentDate).toLocaleString()]),q=[f,...M].map(H=>H.join(",")).join(`
`),Y=new Blob([q],{type:"text/csv;charset=utf-8;"});La.saveAs(Y,"payments.csv")};return e.jsxs("div",{className:"p-6 space-y-6 min-h-screen bg-base-100 text-base-content",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"ðŸ’³ Payments Analytics"}),s?e.jsx("div",{className:"flex justify-center",children:e.jsx(ge,{})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-base-200 p-4 rounded shadow border border-base-300",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Total Revenue"}),e.jsxs("p",{className:"text-2xl font-bold",children:["KES ",i.toFixed(2)]})]}),e.jsxs("div",{className:"bg-base-200 p-4 rounded shadow border border-base-300",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Today"}),e.jsxs("p",{className:"text-2xl font-bold",children:["KES ",g.toFixed(2)]})]}),e.jsxs("div",{className:"bg-base-200 p-4 rounded shadow border border-base-300",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"This Week"}),e.jsxs("p",{className:"text-2xl font-bold",children:["KES ",S.toFixed(2)]})]}),e.jsxs("div",{className:"bg-base-200 p-4 rounded shadow border border-base-300",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"This Month"}),e.jsxs("p",{className:"text-2xl font-bold",children:["KES ",j.toFixed(2)]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-end",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Status:"}),e.jsxs("select",{value:d,onChange:f=>T(f.target.value),className:"select select-bordered",children:[e.jsx("option",{value:"",children:"All"}),e.jsx("option",{children:"Completed"}),e.jsx("option",{children:"Pending"}),e.jsx("option",{children:"Failed"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"Method:"}),e.jsx("input",{type:"text",placeholder:"e.g. Mpesa",value:N,onChange:f=>b(f.target.value),className:"input input-bordered"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"From:"}),e.jsx("input",{type:"date",value:k,onChange:f=>C(f.target.value),className:"input input-bordered"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1",children:"To:"}),e.jsx("input",{type:"date",value:E,onChange:f=>P(f.target.value),className:"input input-bordered"})]}),e.jsx("button",{onClick:$,className:"btn btn-primary mt-4",children:"Export CSV"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table table-zebra w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-base-300 text-base-content",children:[e.jsx("th",{children:"Txn ID"}),e.jsx("th",{children:"Booking ID"}),e.jsx("th",{children:"Event"}),e.jsx("th",{children:"Ticket Type"}),e.jsx("th",{children:"Amount (KES)"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Method"}),e.jsx("th",{children:"Date"})]})}),e.jsx("tbody",{children:y.map(f=>e.jsxs("tr",{children:[e.jsx("td",{children:f.transactionId}),e.jsx("td",{children:f.bookingId}),e.jsx("td",{children:f.eventName}),e.jsx("td",{children:f.ticketTypeName}),e.jsx("td",{children:(f.amount/100).toFixed(2)}),e.jsx("td",{children:f.paymentStatus}),e.jsx("td",{children:f.paymentMethod}),e.jsx("td",{children:new Date(f.paymentDate).toLocaleString()})]},f.paymentId))})]})}),e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsx("button",{onClick:()=>I(f=>Math.max(f-1,1)),className:"btn btn-sm btn-outline",disabled:v===1,children:"Previous"}),e.jsxs("span",{className:"font-semibold",children:["Page ",v," of ",a]}),e.jsx("button",{onClick:()=>I(f=>Math.min(f+1,a)),className:"btn btn-sm btn-outline",disabled:v===a,children:"Next"})]})]})]})},Cr=()=>{const t=oe();return x.useEffect(()=>{const s=()=>{try{const l=localStorage.getItem("user");if(!l)return;const d=JSON.parse(l)?.exp;if(!d)return;Math.floor(Date.now()/1e3)>=d&&(alert("Your session has expired. Please log in again."),localStorage.clear(),t("/login"))}catch(l){console.error("Error checking token expiration:",l)}};s();const r=setInterval(s,60*1e3);return()=>clearInterval(r)},[t]),null},Ir=()=>e.jsxs(e.Fragment,{children:[e.jsx(Cr,{}),e.jsx(Lt,{})]}),Xe=he({reducerPath:"emailApi",baseQuery:pe({baseUrl:"https://ticket-backend-xv5a.onrender.com/api/"}),endpoints:t=>({sendTicketEmail:t.mutation({query:s=>({url:"/send-ticket-email",method:"POST",body:s})})})}),{useSendTicketEmailMutation:Ar}=Xe,X=$a.create({page:{padding:40,fontFamily:"Helvetica",backgroundColor:"#f9f9f9"},header:{fontSize:26,marginBottom:20,textAlign:"center",color:"#4f46e5"},eventName:{fontSize:20,marginBottom:10,textAlign:"center",fontWeight:"bold",color:"#111827"},section:{marginBottom:12,paddingHorizontal:10},row:{marginBottom:6},label:{fontWeight:700,color:"#374151"},value:{color:"#111827"},footer:{marginTop:30,fontSize:12,textAlign:"center",color:"gray"}}),Pr=({user:t,event:s,ticketType:r,booking:l,total:h,paymentStatus:d})=>e.jsx(Ma,{children:e.jsxs(qa,{size:"A4",style:X.page,children:[e.jsx(K,{style:X.header,children:"ðŸŽ« TicketStream Events"}),e.jsxs(K,{style:X.eventName,children:["Event: ",s.title]}),e.jsxs(Ee,{style:X.section,children:[e.jsx(Ee,{style:X.row,children:e.jsxs(K,{children:[e.jsx(K,{style:X.label,children:"Name: "}),e.jsxs(K,{style:X.value,children:[t.firstName," ",t.lastName]})]})}),e.jsx(Ee,{style:X.row,children:e.jsxs(K,{children:[e.jsx(K,{style:X.label,children:"National ID: "}),e.jsx(K,{style:X.value,children:t.nationalId})]})}),e.jsx(Ee,{style:X.row,children:e.jsxs(K,{children:[e.jsx(K,{style:X.label,children:"Ticket Type: "}),e.jsx(K,{style:X.value,children:r.name})]})}),e.jsx(Ee,{style:X.row,children:e.jsxs(K,{children:[e.jsx(K,{style:X.label,children:"Quantity: "}),e.jsx(K,{style:X.value,children:l.quantity})]})}),e.jsx(Ee,{style:X.row,children:e.jsxs(K,{children:[e.jsx(K,{style:X.label,children:"Total: "}),e.jsxs(K,{style:X.value,children:["$",h.toFixed(2)]})]})}),e.jsx(Ee,{style:X.row,children:e.jsxs(K,{children:[e.jsx(K,{style:X.label,children:"Payment Status: "}),e.jsx(K,{style:X.value,children:d})]})}),e.jsx(Ee,{style:X.row,children:e.jsxs(K,{children:[e.jsx(K,{style:X.label,children:"Booking Date: "}),e.jsx(K,{style:X.value,children:new Date(l.createdAt).toLocaleString()})]})})]}),e.jsx(K,{style:X.footer,children:"âœ… Thank you for booking with TicketStream Events!"})]})}),Br=({booking:t,user:s})=>{const[r,{isLoading:l}]=Ar(),[h,d]=x.useState(!1),T=parseFloat(t.ticketType.price),N=T*t.quantity,b=t.paymentStatus,k=async()=>{try{await r({bookings:[{bookingId:t.bookingId.toString(),event:{title:t.eventName},ticketType:t.ticketType,quantity:t.quantity,paymentStatus:b,createdAt:t.createdAt}],user:s}).unwrap(),d(!0),setTimeout(()=>d(!1),4e3)}catch(C){console.error("Failed to email ticket",C),alert("Failed to send ticket email.")}};return e.jsxs("div",{className:"card bg-base-100 text-base-content border-2 border-purple-500 shadow-md rounded-box p-6",children:[e.jsxs("h2",{className:"text-2xl font-bold text-primary mb-3",children:["ðŸŽŸ ",t.eventName]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.firstName," ",s.lastName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"National ID:"})," ",s.nationalId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ticket Type:"})," ",t.ticketType.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Quantity:"})," ",t.quantity]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Price per ticket:"})," $",T.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total:"})," $",N.toFixed(2)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Status:"})," ",b]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Booking Date:"})," ",new Date(t.createdAt).toLocaleString()]})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[e.jsx(_a,{document:e.jsx(Pr,{user:s,event:{title:t.eventName},ticketType:t.ticketType,booking:{bookingId:t.bookingId,eventId:0,ticketTypeId:0,quantity:t.quantity,createdAt:t.createdAt},total:N,paymentStatus:b}),fileName:`ticket-${t.bookingId}.pdf`,children:({loading:C})=>C?e.jsx("button",{className:"btn btn-outline btn-disabled loading",children:"Preparing ticket..."}):e.jsx("button",{className:"btn btn-primary",children:"Download Ticket PDF"})}),e.jsx("button",{onClick:k,disabled:l,className:`btn ${l?"btn-disabled loading":h?"btn-success":"btn-accent"}`,children:l?"Sending...":h?"Sent âœ”ï¸":"Email This Ticket"})]})]})},Dr=()=>{const t=W(i=>i.auth.user?.nationalId),{data:s,isLoading:r}=ue.useGetBookingsByUserNationalIdQuery(t,{skip:!t}),{data:l,isLoading:h}=me.useGetUserByNationalIdQuery(t,{skip:!t}),{data:d,isLoading:T}=Z.useGetAllEventsQuery({}),{data:N,isLoading:b}=Te.useGetAllTicketTypesQuery({}),[k,{isLoading:C}]=Xe.useSendTicketEmailMutation(),[E,P]=x.useState(""),[v,I]=x.useState(""),[c,w]=x.useState(1),o=6,a=r||h||T||b,R=s?.map(i=>{const g=d?.find(j=>j.eventId===i.eventId),S=N?.find(j=>j.ticketTypeId===i.ticketTypeId);return{bookingId:i.bookingId,eventName:g?.title||"Unknown Event",ticketType:{name:S?.name||"Unknown",price:S?.price||"0"},quantity:i.quantity,paymentStatus:i.bookingStatus||"Unknown",createdAt:i.createdAt}})?.filter(i=>{const g=i.eventName.toLowerCase().includes(E.toLowerCase()),S=v?new Date(i.createdAt).toISOString().slice(0,10)===v:!0;return g&&S}).sort((i,g)=>new Date(g.createdAt).getTime()-new Date(i.createdAt).getTime()),U=Math.ceil((R?.length||0)/o),F=R?.slice((c-1)*o,c*o),L=async()=>{if(!(!R||!l))try{await k({bookings:R,user:l}).unwrap(),alert("Ticket details sent to your email!")}catch(i){console.error("Error sending email:",i),alert("Failed to send email. Please try again later.")}},B=()=>{I(""),P(""),w(1)};return a?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-base-100",children:e.jsx($t,{size:80,color:"#4f46e5"})}):!s||s.length===0?e.jsx("div",{className:"text-center text-base-content mt-10 text-lg",children:"No bookings found for this user."}):e.jsxs("div",{className:"p-6 space-y-8 max-w-7xl mx-auto mt-20 bg-base-100 text-base-content rounded-box shadow",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 w-full",children:[e.jsx("input",{type:"text",placeholder:"Search by Event Name",value:E,onChange:i=>{P(i.target.value),w(1)},className:"input input-bordered w-full sm:max-w-xs"}),e.jsx("input",{type:"date",value:v,onChange:i=>{I(i.target.value),w(1)},className:"input input-bordered w-full sm:max-w-xs"})]}),e.jsx("button",{onClick:B,className:"btn btn-outline btn-sm mt-2 md:mt-0",children:"Clear Filters"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:L,disabled:C,className:`btn btn-primary ${C?"btn-disabled loading":""}`,children:C?"Sending...":"Email My Tickets"})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[F?.length===0&&e.jsx("p",{className:"col-span-full text-center text-base-content",children:"No tickets match your search."}),F?.map(i=>e.jsx(Br,{booking:i,user:l},i.bookingId))]}),e.jsxs("div",{className:"flex justify-center mt-8 gap-2",children:[e.jsx("button",{onClick:()=>w(i=>Math.max(i-1,1)),disabled:c===1,className:"btn btn-sm",children:"Prev"}),e.jsxs("span",{className:"text-sm text-base-content mt-1",children:["Page ",c," of ",U]}),e.jsx("button",{onClick:()=>w(i=>Math.min(i+1,U)),disabled:c===U,className:"btn btn-sm",children:"Next"})]})]})},Pt=({label:t,type:s,placeholder:r,icon:l,name:h,value:d,onChange:T,register:N,error:b})=>e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:t}),e.jsxs("div",{className:"relative flex items-center border border-gray-300 rounded-lg px-3 py-2 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500",children:[e.jsx("span",{className:"text-blue-800 mr-2",children:l}),e.jsx("input",{type:s,placeholder:r,name:h,value:d,onChange:T,...N,className:"flex-1 outline-none bg-transparent"})]}),b&&e.jsx("p",{className:"text-sm mt-1 text-red-600",children:b})]}),Fr=()=>{const t=Ft(),s=oe(),r=t.state?.email||"",[l,h]=x.useState(r),[d,T]=x.useState(""),[N,{isLoading:b}]=me.useVerifyEmailMutation();x.useEffect(()=>{r||(xe.error("No email provided. Please register first."),s("/register"))},[r,s]);const k=async C=>{C.preventDefault();const E=xe.loading("Verifying...");try{const P=await N({email:l,confirmationCode:d}).unwrap();xe.success(P.message||"Email verified successfully",{id:E}),setTimeout(()=>s("/login"),1500)}catch(P){xe.error(P?.data?.error||"Verification failed",{id:E})}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4 transition-colors duration-300",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-lg rounded-2xl p-8 max-w-md w-full border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-2xl font-semibold text-blue-700 dark:text-blue-400 text-center mb-6",children:"Email Verification"}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsx(Pt,{label:"Email",type:"email",placeholder:"Enter your email",value:l,onChange:C=>h(C.target.value),icon:void 0,name:""}),e.jsx(Pt,{label:"Confirmation Code",type:"text",placeholder:"Enter your OTP",value:d,onChange:C=>T(C.target.value),icon:void 0,name:""}),e.jsx("button",{type:"submit",className:`w-full py-3 px-4 rounded-md font-semibold text-white transition-all duration-200 ${b?"bg-gray-400 cursor-not-allowed":"bg-blue-700 hover:bg-blue-800 dark:bg-blue-500 dark:hover:bg-blue-600 hover:shadow-lg transform hover:-translate-y-0.5"}`,disabled:b,children:b?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Verifying..."})]}):"Verify Email"})]})]})})},Rr=()=>{const t=oe(),[s]=me.useRequestPasswordResetMutation(),{register:r,handleSubmit:l,formState:{errors:h,isSubmitting:d,isValid:T}}=Ut({mode:"onChange"}),N=async b=>{const k=xe.loading("Sending reset link...");try{const C=await s(b).unwrap();xe.success(C?.message||"Reset link sent!",{id:k})}catch(C){const E=C?.data?.error||C?.data?.message||"Something went wrong.";xe.error(E,{id:k})}};return e.jsxs("div",{children:[e.jsx(fe,{}),e.jsx("div",{className:"flex items-center justify-center pt-12 pb-20 px-4",children:e.jsx("div",{className:"w-full max-w-xl",children:e.jsx("div",{className:"bg-white rounded-3xl shadow-md overflow-hidden",children:e.jsxs("div",{className:"p-8 lg:p-12",children:[e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("h2",{className:"text-3xl font-bold text-blue-800 mb-2",children:"Forgot Password"}),e.jsx("p",{className:"text-gray-600",children:"Enter your email and weâ€™ll send you a link to reset your password."})]}),e.jsxs("form",{className:"space-y-6",onSubmit:l(N),children:[e.jsx(Pt,{label:"Email Address",type:"email",placeholder:"you@example.com",icon:e.jsx(za,{}),name:"email",register:r("email",{required:"Email is required",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"Invalid email address"}}),error:h.email?.message}),e.jsx("button",{type:"submit",disabled:!T||d,className:`w-full py-3 px-4 rounded-md font-semibold text-white transition-all duration-200 ${!T||d?"bg-gray-400 cursor-not-allowed":"bg-[#093FB4] hover:bg-blue-700 hover:shadow-lg transform hover:-translate-y-0.5"}`,children:d?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Sending..."})]}):"Send Reset Link"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Remember your password?"," ",e.jsx("span",{onClick:()=>t("/login"),className:"text-[#093FB4] hover:text-blue-700 font-medium cursor-pointer",children:"Back to Login"})]})})]})})})}),e.jsx(Ke,{})]})},Ur=()=>{const{token:t}=Ps(),[s,r]=x.useState(""),[l,h]=x.useState(""),[d]=x.useState(!1),T=oe(),[N]=me.useUpdateUserMutation(),b=async k=>{if(k.preventDefault(),s!==l)return alert("Passwords do not match");try{await N({token:t,password:s}).unwrap(),xe.success("Password reset successfully. Please login."),T("/login")}catch(C){alert(C?.data?.error||"Reset failed")}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4 bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-md bg-white p-6 rounded-xl shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"Reset Password"}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsx("input",{type:"password",placeholder:"New Password",value:s,onChange:k=>r(k.target.value),required:!0,className:"w-full p-3 border border-gray-300 rounded"}),e.jsx("input",{type:"password",placeholder:"Confirm New Password",value:l,onChange:k=>h(k.target.value),required:!0,className:"w-full p-3 border border-gray-300 rounded"}),e.jsx("button",{type:"submit",disabled:d,className:`w-full py-3 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700 transition ${d?"opacity-50 cursor-not-allowed":""}`,children:d?"Resetting...":"Reset Password"})]})]})})},tt=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6"],Lr=()=>{const{data:t,isLoading:s,error:r}=Z.useGetAllEventsQuery({}),{data:l,error:h}=we.useGetAllVenuesQuery({}),[d]=ue.useLazyGetBookingsByEventIdQuery(),[T]=Te.useLazyGetTicketTypesByEventIdQuery(),[N,b]=x.useState([]),[k,C]=x.useState(!0),[E,P]=x.useState(!1);x.useEffect(()=>{(async()=>{if(!(!t||!l)){C(!0),P(!1);try{const o=[];for(const a of t)try{const y=l.find(g=>g.venueId===a.venueId),R=await d(a.eventId).unwrap(),U=await T(a.eventId).unwrap(),F=R.filter(g=>g.bookingStatus==="Confirmed");if(F.length===0){o.push({eventId:a.eventId,eventName:a?.name?.trim()||`Untitled Event #${a.eventId}`,venueName:y?.name||"Unknown Venue",ticketBreakdown:[],totalTickets:0,totalRevenue:0,hasBookings:!1});continue}const L=U.map(g=>{const j=F.filter(f=>f.ticketTypeId===g.ticketTypeId).reduce((f,M)=>f+M.quantity,0),$=j*parseFloat(g.price);return{ticketTypeName:g.name,quantity:j,revenue:$}}),B=L.reduce((g,S)=>g+S.quantity,0),i=L.reduce((g,S)=>g+S.revenue,0);o.push({eventId:a.eventId,eventName:a?.name?.trim()||`Untitled Event #${a.eventId}`,venueName:y?.name||"Unknown Venue",ticketBreakdown:L,totalTickets:B,totalRevenue:i,hasBookings:!0})}catch(y){if(y?.status===401||y?.originalStatus===401){P(!0);break}console.warn(`Skipping event ${a.eventId} due to error:`,y)}b(o)}catch(o){o?.status===401||o?.originalStatus===401?P(!0):console.error("Unexpected error while fetching report:",o)}finally{C(!1)}}})()},[t,l]);const v=w=>{const o=new Oa;o.setFontSize(16),o.text(`${w.eventName} â€” ${w.venueName}`,14,20),w.ticketBreakdown.length===0?(o.setFontSize(12),o.text("No confirmed bookings.",14,30)):Ga(o,{head:[["Ticket Type","Quantity","Revenue"]],body:w.ticketBreakdown.map(a=>[a.ticketTypeName,a.quantity.toString(),`KES ${a.revenue.toFixed(2)}`]),startY:30}),o.save(`${w.eventName.replace(/\s+/g,"_")}_Report.pdf`)},I=N.reduce((w,o)=>w+o.totalTickets,0),c=N.reduce((w,o)=>w+o.totalRevenue,0);return E?e.jsxs("div",{className:"p-6 text-red-600 dark:text-red-400",children:["ðŸ”’ Session expired. Please ",e.jsx("a",{href:"/login",className:"underline",children:"log in"})," again."]}):k||s?e.jsx("div",{className:"flex justify-center items-center h-[50vh]",children:e.jsx($t,{color:"#3B82F6",size:60})}):r||h?e.jsx("div",{className:"p-6 text-red-600 dark:text-red-400",children:"âŒ Failed to load events or venues. Please try again later."}):e.jsxs("div",{className:"p-6 space-y-6 bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-100",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"ðŸŽŸï¸ Ticket Sales Report"}),N.map(w=>e.jsxs("div",{className:"border border-blue-300 dark:border-blue-600 bg-gray-50 dark:bg-gray-800 shadow rounded-xl p-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-2xl font-semibold",children:["ðŸ“Œ ",w.eventName]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-300",children:["ðŸ“ ",w.venueName]})]}),e.jsx("button",{onClick:()=>v(w),className:"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 text-sm",children:"Download PDF"})]}),w.hasBookings?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-blue-100 dark:bg-blue-900 text-left",children:[e.jsx("th",{className:"p-2",children:"Ticket Type"}),e.jsx("th",{className:"p-2",children:"Quantity"}),e.jsx("th",{className:"p-2",children:"Revenue"})]})}),e.jsx("tbody",{children:w.ticketBreakdown.map((o,a)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:o.ticketTypeName}),e.jsx("td",{className:"p-2",children:o.quantity}),e.jsxs("td",{className:"p-2 text-green-600 dark:text-green-400",children:["KES ",o.revenue.toFixed(2)]})]},a))})]})}),e.jsxs("div",{className:"flex gap-6 mt-4 flex-col md:flex-row",children:[e.jsx("div",{className:"w-full md:w-1/2 h-64",children:e.jsx(Fe,{width:"100%",height:"100%",children:e.jsx(Is,{children:e.jsx(As,{data:w.ticketBreakdown,dataKey:"quantity",nameKey:"ticketTypeName",cx:"50%",cy:"50%",outerRadius:60,label:!0,children:w.ticketBreakdown.map((o,a)=>e.jsx(It,{fill:tt[a%tt.length]},a))})})})}),e.jsx("div",{className:"w-full md:w-1/2 h-64",children:e.jsx(Fe,{width:"100%",height:"100%",children:e.jsxs(nt,{data:w.ticketBreakdown,children:[e.jsx(Ye,{dataKey:"ticketTypeName"}),e.jsx(He,{allowDecimals:!1}),e.jsx($e,{}),e.jsx(rt,{dataKey:"quantity",children:w.ticketBreakdown.map((o,a)=>e.jsx(It,{fill:tt[a%tt.length]},a))})]})})})]}),e.jsxs("p",{className:"text-sm font-medium pt-2",children:["ðŸŽ« Total: ",e.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-bold",children:w.totalTickets})," tickets /",e.jsxs("span",{className:"text-green-600 dark:text-green-400 font-bold",children:[" KES ",w.totalRevenue.toFixed(2)]})]})]}):e.jsx("p",{className:"text-sm text-gray-500 italic",children:"âŒ No confirmed bookings for this event."})]},w.eventId)),e.jsx("div",{className:"flex items-center justify-between bg-gray-100 dark:bg-gray-800 p-4 rounded-xl",children:e.jsxs("div",{className:"text-lg font-medium",children:["ðŸ§¾ Grand Total:"," ",e.jsxs("span",{className:"text-blue-700 dark:text-blue-300 font-semibold",children:[I," tickets"]})," /",e.jsxs("span",{className:"text-green-700 dark:text-green-300 font-semibold",children:[" KES ",c.toFixed(2)]})]})})]})},Mr=()=>{const t=W(g=>g.auth.user?.nationalId),{data:s,isLoading:r,refetch:l}=Ot(t,{skip:!t}),[h]=Fs(),[d,T]=x.useState(!1),[N,b]=x.useState({firstName:"",lastName:"",email:"",profileImageUrl:"",role:""}),[k,C]=x.useState(null),[E,P]=x.useState(""),[v,I]=x.useState(0),[c,w]=x.useState(()=>localStorage.getItem("theme")||"light"),[o,a]=x.useState(!1),y="dwibg4vvf",R="tickets_Profile";x.useEffect(()=>{document.documentElement.setAttribute("data-theme",c),localStorage.setItem("theme",c)},[c]),x.useEffect(()=>{s&&(b({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",profileImageUrl:s.profileImageUrl||"",role:s.role||""}),P(s.profileImageUrl||""))},[s]);const U=g=>{const{name:S,value:j}=g.target;b($=>({...$,[S]:j}))},F=g=>{const S=g.target.files?.[0];S&&(C(S),P(URL.createObjectURL(S)))},L=async()=>{if(!k)return N.profileImageUrl;const g=new FormData;g.append("file",k),g.append("upload_preset",R);try{return(await Mt.post(`https://api.cloudinary.com/v1_1/${y}/image/upload`,g,{onUploadProgress:j=>{const $=Math.round(j.loaded*100/(j.total||1));I($)}})).data.secure_url}catch(S){return console.error("Image upload failed:",S),_.fire("Error","Failed to upload profile image.","error"),null}},B=async g=>{g.preventDefault(),a(!0);let S=N.profileImageUrl;if(k){const j=await L();j&&(S=j)}try{await h({nationalId:t,...N,profileImageUrl:S}).unwrap(),_.fire({icon:"success",title:"Profile Updated!",text:"Your changes have been saved.",timer:2e3,showConfirmButton:!1}),T(!1),C(null),I(0),l()}catch(j){console.error("Update failed:",j),_.fire({icon:"error",title:"Update Failed",text:"Something went wrong. Please try again."})}finally{a(!1)}},i=()=>w(c==="light"?"dark":"light");return r||!s?e.jsx("div",{className:"text-center",children:"Loading user..."}):e.jsxs("div",{className:"max-w-xl mx-auto mt-10 p-6 rounded-xl shadow-lg bg-base-100 text-base-content",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"User Profile"}),e.jsx("button",{onClick:i,className:"btn btn-circle btn-ghost",children:c==="light"?e.jsx(Bt,{className:"h-5 w-5"}):e.jsx(Dt,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("img",{src:E||"/default-avatar.png",alt:"Profile",className:"w-32 h-32 rounded-full object-cover border"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:"image/*",onChange:F,className:"mt-2"}),v>0&&e.jsx("div",{className:"w-full bg-gray-300 h-2 rounded",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded transition-all duration-300",style:{width:`${v}%`}})})]}),!d&&e.jsxs("h2",{className:"text-xl font-bold",children:[s.firstName," ",s.lastName]})]}),d?e.jsxs("form",{onSubmit:B,className:"mt-6 space-y-4",children:[e.jsx("input",{name:"firstName",placeholder:"First Name",value:N.firstName,onChange:U,className:"input input-bordered w-full",required:!0}),e.jsx("input",{name:"lastName",placeholder:"Last Name",value:N.lastName,onChange:U,className:"input input-bordered w-full",required:!0}),e.jsx("input",{name:"email",value:N.email,disabled:!0,className:"input input-bordered w-full bg-gray-100 cursor-not-allowed"}),e.jsx("input",{name:"role",value:N.role,disabled:!0,className:"input input-bordered w-full bg-gray-100 cursor-not-allowed"}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>T(!1),className:"btn btn-outline",disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?"Saving...":"Save Changes"})]})]}):e.jsxs("div",{className:"mt-6 space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"National ID:"})," ",s.nationalId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",s.role||"user"]}),e.jsx("button",{onClick:()=>T(!0),className:"mt-4 btn btn-accent",children:"Edit Profile"})]})]})};function qr(){const t=Va([{path:"/",element:e.jsx(Ir,{}),children:[{path:"/",element:e.jsx(An,{})},{path:"/about",element:e.jsx(Bn,{})},{path:"/events",element:e.jsx(Fn,{})},{path:"/events/:id",element:e.jsx(ir,{})},{path:"/login",element:e.jsx(Un,{})},{path:"/register",element:e.jsx(Mn,{})},{path:"/contact",element:e.jsx(Tr,{})},{path:"/email-verification",element:e.jsx(Fr,{}),errorElement:e.jsx(Qe,{})},{path:"/forgot-password",element:e.jsx(Rr,{}),errorElement:e.jsx(Qe,{})},{path:"/reset-password/:token",element:e.jsx(Ur,{}),errorElement:e.jsx(Qe,{})}]},{path:"dashboard",element:e.jsx(ls,{children:e.jsx(On,{})}),errorElement:e.jsx(Qe,{}),children:[{path:"me",element:e.jsx(Gn,{})},{path:"MyBookings",element:e.jsx(ar,{})},{path:"supportTickets",element:e.jsx(hr,{})},{path:"Payments",element:e.jsx(Sr,{})},{path:"MyTickets",element:e.jsx(Dr,{})}]},{path:"admindashboard",element:e.jsx(ls,{children:e.jsx(_n,{})}),errorElement:e.jsx(Qe,{}),children:[{path:"analytics",element:e.jsx(Hn,{})},{path:"AllMedia",element:e.jsx(lr,{})},{path:"AllBookings",element:e.jsx(rr,{})},{path:"supportTickets",element:e.jsx(yr,{})},{path:"allusers",element:e.jsx(Xn,{})},{path:"AllVenues",element:e.jsx(Kn,{})},{path:"AllEvents",element:e.jsx(Jn,{})},{path:"ticketTypes",element:e.jsx(nr,{})},{path:"AllPayments",element:e.jsx(Er,{})},{path:"adminprofile",element:e.jsx(Mr,{})},{path:"SalesReports",element:e.jsx(Lr,{})}]}]);return e.jsxs(e.Fragment,{children:[e.jsx(qt,{position:"top-right",reverseOrder:!1}),e.jsx(Qa,{router:t})]})}const $r={key:"auth",storage:Ka,whitelist:["user","token","isAuthenticated","role"]},_r=Xa($r,an),Us=Ya({reducer:{[me.reducerPath]:me.reducer,[Z.reducerPath]:Z.reducer,[we.reducerPath]:we.reducer,[ue.reducerPath]:ue.reducer,[Te.reducerPath]:Te.reducer,[Re.reducerPath]:Re.reducer,[lt.reducerPath]:lt.reducer,[_e.reducerPath]:_e.reducer,[Ae.reducerPath]:Ae.reducer,[Xe.reducerPath]:Xe.reducer,auth:_r},middleware:t=>t({serializableCheck:!1}).concat(me.middleware,Z.middleware,we.middleware,ue.middleware,Te.middleware,Re.middleware,lt.middleware,_e.middleware,Ae.middleware,Xe.middleware)}),zr=Ha(Us);function Or(t={}){const{immediate:s=!1,onNeedRefresh:r,onOfflineReady:l,onRegistered:h,onRegisteredSW:d,onRegisterError:T}=t;let N,b;const k=async(E=!0)=>{await b};async function C(){if("serviceWorker"in navigator){if(N=await Wa(async()=>{const{Workbox:E}=await import("./vendor-_JZ7sh_e.js").then(P=>P.bc);return{Workbox:E}},__vite__mapDeps([0,1])).then(({Workbox:E})=>new E("/sw.js",{scope:"/",type:"classic"})).catch(E=>{T?.(E)}),!N)return;N.addEventListener("activated",E=>{(E.isUpdate||E.isExternal)&&window.location.reload()}),N.addEventListener("installed",E=>{E.isUpdate||l?.()}),N.register({immediate:s}).then(E=>{d?d("/sw.js",E):h?.(E)}).catch(E=>{T?.(E)})}}return b=C(),k}Or({immediate:!0,onNeedRefresh(){console.log("New content available, refresh to update.")},onOfflineReady(){console.log("App is ready to work offline.")}});Ja.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(Za,{store:Us,children:e.jsx(en,{loading:null,persistor:zr,children:e.jsx(qr,{})})})}));
